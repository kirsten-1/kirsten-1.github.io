---
layout: post
title: "åŠ›æ‰£ 30å¤©pandasæŒ‘æˆ˜"
subtitle: "33é¢˜  é¢˜ç›®+æµ‹è¯•æ•°æ®+å®ŒæˆæŒ‘æˆ˜"
date: 2025-03-03
author: "Hilda"
header-img: "img/post-bg-2015.jpg"
tags:
- åŠ›æ‰£
---


<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG">
</script>


NumPy åšå®¢æ€»ç»“ï¼š

[ã€ŠPythonæ•°æ®åˆ†æåŸºç¡€æ•™ç¨‹ï¼šNumPyå­¦ä¹ æŒ‡å—ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹æ‰€æœ‰ç« èŠ‚é˜…è¯»ç¬”è®°+ä»£ç ](https://kirsten-1.github.io/2025/02/14/NumPy%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97(%E7%AC%AC2%E7%89%88)%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93/)

[70é“NumPy é¢è¯•é¢˜(é¢˜ç›®+ç­”æ¡ˆ)](https://kirsten-1.github.io/2025/02/21/NumPy70%E9%A2%98/)

pandasåšå®¢æ€»ç»“ï¼š

[pandas(1)æ•°æ®é¢„å¤„ç†](https://kirsten-1.github.io/2025/02/21/Pandas(1)%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/)

[pandas(2)æ•°æ®åˆ†æ](https://kirsten-1.github.io/2025/02/24/Pandas(2)%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/)

[pandas(3)å¸¸ç”¨å‡½æ•°æ“ä½œ](https://kirsten-1.github.io/2025/02/24/pandas(3)%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C/)

[pandas(4)å¤§æ•°æ®å¤„ç†æŠ€å·§](https://kirsten-1.github.io/2025/02/25/Pandas(4)%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8A%80%E5%B7%A7/)

[ã€åŠ›æ‰£ã€‘pandaså…¥é—¨15é¢˜](https://kirsten-1.github.io/2025/02/25/%E5%8A%9B%E6%89%A3pandas%E5%85%A5%E9%97%A815%E9%A2%98/)

[è¿”å›ä¸è¾“å…¥ç»„å…·æœ‰ç›¸åŒå½¢çŠ¶çš„ç»“æœçš„transformå‡½æ•°](https://kirsten-1.github.io/2025/02/28/pandas%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0transform/)

[meltå‡½æ•°-dfé•¿å®½å˜å½¢å¤§å¸ˆ - meltçš„é‡å¡‘ç¥åŠŸã€meltå‡½æ•°çš„ä»‹ç»ä¸ç»ƒä¹ ã€‘](https://kirsten-1.github.io/2025/02/28/%E8%BD%AC%E6%8D%A2%E4%B8%8E%E9%87%8D%E5%A1%91df-melt%E5%87%BD%E6%95%B0/)

----

æœ¬ç¯‡åšå®¢æ˜¯åŠ›æ‰£çš„â€œ30å¤©pandasæŒ‘æˆ˜â€ã€‚-----ä¸€å…±30é¢˜

# ç¬¬ä¸€ç±»ï¼šæ¡ä»¶ç­›é€‰



## 595. å¤§çš„å›½å®¶

[595. å¤§çš„å›½å®¶](https://leetcode.cn/problems/big-countries/)

`World` è¡¨ï¼š

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| name        | varchar |
| continent   | varchar |
| area        | int     |
| population  | int     |
| gdp         | bigint  |
+-------------+---------+
name æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæä¾›ï¼šå›½å®¶åç§°ã€æ‰€å±å¤§é™†ã€é¢ç§¯ã€äººå£å’Œ GDP å€¼ã€‚
```



å¦‚æœä¸€ä¸ªå›½å®¶æ»¡è¶³ä¸‹è¿°ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œåˆ™è®¤ä¸ºè¯¥å›½æ˜¯ **å¤§å›½** ï¼š

- é¢ç§¯è‡³å°‘ä¸º 300 ä¸‡å¹³æ–¹å…¬é‡Œï¼ˆå³ï¼Œ`3000000 km2`ï¼‰ï¼Œæˆ–è€…
- äººå£è‡³å°‘ä¸º 2500 ä¸‡ï¼ˆå³ `25000000`ï¼‰

ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º **å¤§å›½** çš„å›½å®¶åç§°ã€äººå£å’Œé¢ç§¯ã€‚

æŒ‰ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ï¼š**

```
è¾“å…¥ï¼š
World è¡¨ï¼š
+-------------+-----------+---------+------------+--------------+
| name        | continent | area    | population | gdp          |
+-------------+-----------+---------+------------+--------------+
| Afghanistan | Asia      | 652230  | 25500100   | 20343000000  |
| Albania     | Europe    | 28748   | 2831741    | 12960000000  |
| Algeria     | Africa    | 2381741 | 37100000   | 188681000000 |
| Andorra     | Europe    | 468     | 78115      | 3712000000   |
| Angola      | Africa    | 1246700 | 20609294   | 100990000000 |
+-------------+-----------+---------+------------+--------------+
è¾“å‡ºï¼š
+-------------+------------+---------+
| name        | population | area    |
+-------------+------------+---------+
| Afghanistan | 25500100   | 652230  |
| Algeria     | 37100000   | 2381741 |
+-------------+------------+---------+
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def big_countries(world: pd.DataFrame) -> pd.DataFrame:
    return world[(world['area'] >= 3000000) | (world['population'] >= 25000000)][['name','population', 'area']]
```

## 1757. å¯å›æ”¶ä¸”ä½è„‚çš„äº§å“

[1757. å¯å›æ”¶ä¸”ä½è„‚çš„äº§å“](https://leetcode.cn/problems/recyclable-and-low-fat-products/)



è¡¨ï¼š`Products`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| product_id  | int     |
| low_fats    | enum    |
| recyclable  | enum    |
+-------------+---------+
product_id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
low_fats æ˜¯æšä¸¾ç±»å‹ï¼Œå–å€¼ä¸ºä»¥ä¸‹ä¸¤ç§ ('Y', 'N')ï¼Œå…¶ä¸­ 'Y' è¡¨ç¤ºè¯¥äº§å“æ˜¯ä½è„‚äº§å“ï¼Œ'N' è¡¨ç¤ºä¸æ˜¯ä½è„‚äº§å“ã€‚
recyclable æ˜¯æšä¸¾ç±»å‹ï¼Œå–å€¼ä¸ºä»¥ä¸‹ä¸¤ç§ ('Y', 'N')ï¼Œå…¶ä¸­ 'Y' è¡¨ç¤ºè¯¥äº§å“å¯å›æ”¶ï¼Œè€Œ 'N' è¡¨ç¤ºä¸å¯å›æ”¶ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºæ—¢æ˜¯ä½è„‚åˆæ˜¯å¯å›æ”¶çš„äº§å“ç¼–å·ã€‚

è¿”å›ç»“æœ **æ— é¡ºåºè¦æ±‚** ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Products è¡¨ï¼š
+-------------+----------+------------+
| product_id  | low_fats | recyclable |
+-------------+----------+------------+
| 0           | Y        | N          |
| 1           | Y        | Y          |
| 2           | N        | Y          |
| 3           | Y        | Y          |
| 4           | N        | N          |
+-------------+----------+------------+
è¾“å‡ºï¼š
+-------------+
| product_id  |
+-------------+
| 1           |
| 3           |
+-------------+
è§£é‡Šï¼š
åªæœ‰äº§å“ id ä¸º 1 å’Œ 3 çš„äº§å“ï¼Œæ—¢æ˜¯ä½è„‚åˆæ˜¯å¯å›æ”¶çš„äº§å“ã€‚
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def find_products(products: pd.DataFrame) -> pd.DataFrame:
    return products[(products['low_fats']=="Y") & (products['recyclable']=="Y")][['product_id']]
```



## ğŸŒŸ183. ä»ä¸è®¢è´­çš„å®¢æˆ·

[183. ä»ä¸è®¢è´­çš„å®¢æˆ·](https://leetcode.cn/problems/customers-who-never-order/)

`Customers` è¡¨ï¼š

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå®¢æˆ·çš„ ID å’Œåç§°ã€‚
```

`Orders` è¡¨ï¼š

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| customerId  | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
customerId æ˜¯ Customers è¡¨ä¸­ ID çš„å¤–é”®( Pandas ä¸­çš„è¿æ¥é”®)ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºè®¢å•çš„ ID å’Œè®¢è´­è¯¥è®¢å•çš„å®¢æˆ·çš„ IDã€‚
```



æ‰¾å‡ºæ‰€æœ‰ä»ä¸ç‚¹ä»»ä½•ä¸œè¥¿çš„é¡¾å®¢ã€‚

ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Customers table:
+----+-------+
| id | name  |
+----+-------+
| 1  | Joe   |
| 2  | Henry |
| 3  | Sam   |
| 4  | Max   |
+----+-------+
Orders table:
+----+------------+
| id | customerId |
+----+------------+
| 1  | 3          |
| 2  | 1          |
+----+------------+
è¾“å‡ºï¼š
+-----------+
| Customers |
+-----------+
| Henry     |
| Max       |
+-----------+
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def find_customers(customers: pd.DataFrame, orders: pd.DataFrame) -> pd.DataFrame:
    merged_df = pd.merge(customers, orders, left_index=True, right_on='customerId', how='left')
    res = merged_df[~merged_df.index.isnull()][['name']]
    res.columns = ["Customers"]
    return res
```

æ˜¯ä¸€æ­¥ä¸€æ­¥è°ƒè¯•å‡ºæ¥çš„ï¼Œå‚è€ƒä¸‹é¢ä»£ç ï¼š

```python
# Customers è¡¨çš„æ•°æ®
customers_data = {'id': [1, 2, 3, 4],
                  'name': ['Joe', 'Henry', 'Sam', 'Max']}

# Orders è¡¨çš„æ•°æ®
orders_data = {'id': [1, 2],
               'customerId': [3, 1]}

# åˆ›å»º Customers DataFrame
customers = pd.DataFrame(customers_data)
customers = customers.set_index('id') # è®¾ç½® id åˆ—ä¸ºä¸»é”®ï¼ˆç´¢å¼•ï¼‰

# åˆ›å»º Orders DataFrame
orders = pd.DataFrame(orders_data)
orders = orders.set_index('id')  # è®¾ç½® id åˆ—ä¸ºä¸»é”®ï¼ˆç´¢å¼•ï¼‰

display(orders)
display(customers)

merged_df = pd.merge(customers, orders, left_index=True, right_on='customerId', how='left')

display(merged_df)


res = merged_df[merged_df.index.isnull()][['name']]
res.columns = ["Customers"]
res
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250225164429895.png" alt="image-20250225164429895" style="zoom:50%;" />

ä½†æ˜¯è¿è¡Œè¿‡äº†ï¼Œæäº¤å°±æœ‰é”™ã€‚

æ›´ç®€å•çš„æ–¹æ³•ï¼š

```python
import pandas as pd

def find_customers(customers: pd.DataFrame, orders: pd.DataFrame) -> pd.DataFrame:
    res = customers[~customers['id'].isin(orders['customerId'])][['name']]
    res.columns = ["Customers"]
    return res
```

## 1148. æ–‡ç« æµè§ˆ I

[1148. æ–‡ç« æµè§ˆ I](https://leetcode.cn/problems/article-views-i/)

`Views` è¡¨ï¼š

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| article_id    | int     |
| author_id     | int     |
| viewer_id     | int     |
| view_date     | date    |
+---------------+---------+
æ­¤è¡¨å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨ SQL ä¸­è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼‰
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚
è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚
```



è¯·æŸ¥è¯¢å‡ºæ‰€æœ‰æµè§ˆè¿‡è‡ªå·±æ–‡ç« çš„ä½œè€…

ç»“æœæŒ‰ç…§ `id` å‡åºæ’åˆ—ã€‚

æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Views è¡¨ï¼š
+------------+-----------+-----------+------------+
| article_id | author_id | viewer_id | view_date  |
+------------+-----------+-----------+------------+
| 1          | 3         | 5         | 2019-08-01 |
| 1          | 3         | 6         | 2019-08-02 |
| 2          | 7         | 7         | 2019-08-01 |
| 2          | 7         | 6         | 2019-08-02 |
| 4          | 7         | 1         | 2019-07-22 |
| 3          | 4         | 4         | 2019-07-21 |
| 3          | 4         | 4         | 2019-07-21 |
+------------+-----------+-----------+------------+

è¾“å‡ºï¼š
+------+
| id   |
+------+
| 4    |
| 7    |
+------+
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def article_views(views: pd.DataFrame) -> pd.DataFrame:
    res = views[views['author_id'] == views['viewer_id']][['author_id']].drop_duplicates()
    res.columns = ["id"]
    res = res.sort_values(by='id', ascending=True)
    return res
```

# ç¬¬äºŒç±»ï¼šå­—ç¬¦ä¸²å‡½æ•°

## 1683. æ— æ•ˆçš„æ¨æ–‡

[1683. æ— æ•ˆçš„æ¨æ–‡](https://leetcode.cn/problems/invalid-tweets/)

è¡¨ï¼š`Tweets`

```
+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| tweet_id       | int     |
| content        | varchar |
+----------------+---------+
åœ¨ SQL ä¸­ï¼Œtweet_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
content åªåŒ…å«ç¾å¼é”®ç›˜ä¸Šçš„å­—ç¬¦ï¼Œä¸åŒ…å«å…¶å®ƒç‰¹æ®Šå­—ç¬¦ã€‚
è¿™ä¸ªè¡¨åŒ…å«æŸç¤¾äº¤åª’ä½“ App ä¸­æ‰€æœ‰çš„æ¨æ–‡ã€‚
```



æŸ¥è¯¢æ‰€æœ‰æ— æ•ˆæ¨æ–‡çš„ç¼–å·ï¼ˆIDï¼‰ã€‚å½“æ¨æ–‡å†…å®¹ä¸­çš„å­—ç¬¦æ•°**ä¸¥æ ¼å¤§äº** `15` æ—¶ï¼Œè¯¥æ¨æ–‡æ˜¯æ— æ•ˆçš„ã€‚

ä»¥**ä»»æ„é¡ºåº**è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Tweets è¡¨ï¼š
+----------+----------------------------------+
| tweet_id | content                          |
+----------+----------------------------------+
| 1        | Vote for Biden                   |
| 2        | Let us make America great again! |
+----------+----------------------------------+

è¾“å‡ºï¼š
+----------+
| tweet_id |
+----------+
| 2        |
+----------+
è§£é‡Šï¼š
æ¨æ–‡ 1 çš„é•¿åº¦ length = 14ã€‚è¯¥æ¨æ–‡æ˜¯æœ‰æ•ˆçš„ã€‚
æ¨æ–‡ 2 çš„é•¿åº¦ length = 32ã€‚è¯¥æ¨æ–‡æ˜¯æ— æ•ˆçš„ã€‚
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def invalid_tweets(tweets: pd.DataFrame) -> pd.DataFrame:
    return tweets[tweets['content'].apply(lambda x : len(x) > 15 )][['tweet_id']]
```

ç„¶åçœ‹åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯æˆ‘åŸå…ˆçš„æƒ³æ³•ï¼š

```python
import pandas as pd

def invalid_tweets(tweets: pd.DataFrame) -> pd.DataFrame:
    return tweets[tweets['content'].str.len() > 15][['tweet_id']]
```

æ³¨ï¼š`len(tweets['content'].str)` ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªè¯­å¥è¿”å›çš„æ˜¯ä¸€ä¸ªserieså¯¹è±¡ï¼Œä¸å¯è¿­ä»£ï¼›lenå‡½æ•°éœ€è¦æ˜¯å¯è¿­ä»£å¯¹è±¡æ‰èƒ½è®¡æ•°

## 1873. è®¡ç®—ç‰¹æ®Šå¥–é‡‘

[1873. è®¡ç®—ç‰¹æ®Šå¥–é‡‘](https://leetcode.cn/problems/calculate-special-bonus/)

è¡¨: `Employees`

```
+-------------+---------+
| åˆ—å        | ç±»å‹     |
+-------------+---------+
| employee_id | int     |
| name        | varchar |
| salary      | int     |
+-------------+---------+
employee_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œç»™å‡ºäº†é›‡å‘˜id ï¼Œåå­—å’Œè–ªæ°´ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—æ¯ä¸ªé›‡å‘˜çš„å¥–é‡‘ã€‚å¦‚æœä¸€ä¸ªé›‡å‘˜çš„ id æ˜¯ **å¥‡æ•°** å¹¶ä¸”ä»–çš„åå­—ä¸æ˜¯ä»¥ `'M'` **å¼€å¤´**ï¼Œé‚£ä¹ˆä»–çš„å¥–é‡‘æ˜¯ä»–å·¥èµ„çš„ `100%` ï¼Œå¦åˆ™å¥–é‡‘ä¸º `0` ã€‚

è¿”å›çš„ç»“æœæŒ‰ç…§ `employee_id` æ’åºã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Employees è¡¨:
+-------------+---------+--------+
| employee_id | name    | salary |
+-------------+---------+--------+
| 2           | Meir    | 3000   |
| 3           | Michael | 3800   |
| 7           | Addilyn | 7400   |
| 8           | Juan    | 6100   |
| 9           | Kannon  | 7700   |
+-------------+---------+--------+
è¾“å‡ºï¼š
+-------------+-------+
| employee_id | bonus |
+-------------+-------+
| 2           | 0     |
| 3           | 0     |
| 7           | 7400  |
| 8           | 0     |
| 9           | 7700  |
+-------------+-------+
è§£é‡Šï¼š
å› ä¸ºé›‡å‘˜idæ˜¯å¶æ•°ï¼Œæ‰€ä»¥é›‡å‘˜id æ˜¯2å’Œ8çš„ä¸¤ä¸ªé›‡å‘˜å¾—åˆ°çš„å¥–é‡‘æ˜¯0ã€‚
é›‡å‘˜idä¸º3çš„å› ä¸ºä»–çš„åå­—ä»¥'M'å¼€å¤´ï¼Œæ‰€ä»¥ï¼Œå¥–é‡‘æ˜¯0ã€‚
å…¶ä»–çš„é›‡å‘˜å¾—åˆ°äº†ç™¾åˆ†ä¹‹ç™¾çš„å¥–é‡‘ã€‚
```

----

æˆ‘çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def calculate_special_bonus(employees: pd.DataFrame) -> pd.DataFrame:
    employees['salary'][(~employees['employee_id'] % 2 == 1) | 
                    (employees['name'].str.startswith("M")) ] = 0
    res = employees.rename(
        columns={
            "salary":"bonus"
        }
    )
    return res[['employee_id', 'bonus']].sort_values(by='employee_id')
```

å‚è€ƒç­”æ¡ˆï¼šï¼ˆåˆ«äººå†™çš„ï¼Œä½†æˆ‘æ„Ÿè§‰å¾ˆä¸é”™ï¼‰

```python
import pandas as pd

def calculate_special_bonus(employees: pd.DataFrame) -> pd.DataFrame:
    employees['bonus'] = ((employees['employee_id'] % 2 == 1) & (employees['name'].str[0]!='M')) * employees['salary']
    employees = employees.sort_values('employee_id')
    return employees[['employee_id','bonus']]
```

## 1667. ä¿®å¤è¡¨ä¸­çš„åå­—

[1667. ä¿®å¤è¡¨ä¸­çš„åå­—](https://leetcode.cn/problems/fix-names-in-a-table/)

è¡¨ï¼š `Users`

```
+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| user_id        | int     |
| name           | varchar |
+----------------+---------+
user_id æ˜¯è¯¥è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¯¥è¡¨åŒ…å«ç”¨æˆ·çš„ ID å’Œåå­—ã€‚åå­—ä»…ç”±å°å†™å’Œå¤§å†™å­—ç¬¦ç»„æˆã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œä¿®å¤åå­—ï¼Œä½¿å¾—åªæœ‰ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¤§å†™çš„ï¼Œå…¶ä½™éƒ½æ˜¯å°å†™çš„ã€‚

è¿”å›æŒ‰ `user_id` æ’åºçš„ç»“æœè¡¨ã€‚

è¿”å›ç»“æœæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Users table:
+---------+-------+
| user_id | name  |
+---------+-------+
| 1       | aLice |
| 2       | bOB   |
+---------+-------+
è¾“å‡ºï¼š
+---------+-------+
| user_id | name  |
+---------+-------+
| 1       | Alice |
| 2       | Bob   |
+---------+-------+
```

----

æˆ‘çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def fix_names(users: pd.DataFrame) -> pd.DataFrame:
    users['name'] = users['name'].str.capitalize()
    return users.sort_values(by='user_id')
```

è¿™é“é¢˜å…¶å®å°±æ˜¯è€ƒå¯Ÿä¸€ä¸ªå‡½æ•°`capitalize()`ï¼Œæ²¡å•¥æ–°é²œçš„ã€‚

## ğŸŒŸ1517. æŸ¥æ‰¾æ‹¥æœ‰æœ‰æ•ˆé‚®ç®±çš„ç”¨æˆ·

[1517. æŸ¥æ‰¾æ‹¥æœ‰æœ‰æ•ˆé‚®ç®±çš„ç”¨æˆ·](https://leetcode.cn/problems/find-users-with-valid-e-mails/)

è¡¨: `Users`

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user_id       | int     |
| name          | varchar |
| mail          | varchar |
+---------------+---------+
user_id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨åŒ…å«äº†ç½‘ç«™å·²æ³¨å†Œç”¨æˆ·çš„ä¿¡æ¯ã€‚æœ‰ä¸€äº›ç”µå­é‚®ä»¶æ˜¯æ— æ•ˆçš„ã€‚
```



ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä»¥æŸ¥æ‰¾å…·æœ‰æœ‰æ•ˆç”µå­é‚®ä»¶çš„ç”¨æˆ·ã€‚

ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶å…·æœ‰å‰ç¼€åç§°å’ŒåŸŸï¼Œå…¶ä¸­ï¼š

1.  **å‰ç¼€** åç§°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å«å­—æ¯ï¼ˆå¤§å†™æˆ–å°å†™ï¼‰ï¼Œæ•°å­—ï¼Œä¸‹åˆ’çº¿ `'_'` ï¼Œç‚¹ `'.'` å’Œ/æˆ–ç ´æŠ˜å· `'-'` ã€‚å‰ç¼€åç§° **å¿…é¡»** ä»¥å­—æ¯å¼€å¤´ã€‚
2.  **åŸŸ** ä¸º `'@leetcode.com'` ã€‚

ä»¥ä»»ä½•é¡ºåºè¿”å›ç»“æœè¡¨ã€‚

ç»“æœçš„æ ¼å¼å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Users è¡¨:
+---------+-----------+-------------------------+
| user_id | name      | mail                    |
+---------+-----------+-------------------------+
| 1       | Winston   | winston@leetcode.com    |
| 2       | Jonathan  | jonathanisgreat         |
| 3       | Annabelle | bella-@leetcode.com     |
| 4       | Sally     | sally.come@leetcode.com |
| 5       | Marwan    | quarz#2020@leetcode.com |
| 6       | David     | david69@gmail.com       |
| 7       | Shapiro   | .shapo@leetcode.com     |
+---------+-----------+-------------------------+
è¾“å‡ºï¼š
+---------+-----------+-------------------------+
| user_id | name      | mail                    |
+---------+-----------+-------------------------+
| 1       | Winston   | winston@leetcode.com    |
| 3       | Annabelle | bella-@leetcode.com     |
| 4       | Sally     | sally.come@leetcode.com |
+---------+-----------+-------------------------+
è§£é‡Šï¼š
ç”¨æˆ· 2 çš„ç”µå­é‚®ä»¶æ²¡æœ‰åŸŸã€‚ 
ç”¨æˆ· 5 çš„ç”µå­é‚®ä»¶å¸¦æœ‰ä¸å…è®¸çš„ '#' ç¬¦å·ã€‚
ç”¨æˆ· 6 çš„ç”µå­é‚®ä»¶æ²¡æœ‰ leetcode åŸŸã€‚ 
ç”¨æˆ· 7 çš„ç”µå­é‚®ä»¶ä»¥ç‚¹å¼€å¤´ã€‚
```

----

```python
import pandas as pd

def valid_emails(users: pd.DataFrame) -> pd.DataFrame:
    reg = r'^[A-Za-z][A-Za-z0-9_./-]*@leetcode\.com$'
    return users[users['mail'].str.match(reg, case=False)]
```

è¿™é“é¢˜å…³é”®æ˜¯æŠŠæ­£åˆ™çœ‹æ‡‚ï¼š

- `^`: åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚
- `[A-Za-z]`: å¿…é¡»ä»¥å­—æ¯ï¼ˆå¤§å†™æˆ–å°å†™ï¼‰å¼€å¤´ã€‚
- `[A-Za-z0-9_.-]*`: å…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç‚¹å’Œç ´æŠ˜å·çš„ç»„åˆï¼Œå¯ä»¥å‡ºç° 0 æ¬¡æˆ–å¤šæ¬¡ã€‚
- `@XXX\.com`: å¼ºåˆ¶è¦æ±‚ä»¥"`@XXX.com`"ç»“å°¾ï¼Œ`\.` è¡¨ç¤ºåŒ¹é…å®é™…çš„ç‚¹å­—ç¬¦.
- `$`: åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾.

æœ€å¥½@ä¹Ÿè½¬ä¹‰ä¸€ä¸‹ï¼š`\@`?   å…¶å®`python 3.7`ä»¥åçš„`@`å­—ç¬¦ä¸å†éœ€è¦è½¬ä¹‰

å¦å¤–case=Falseå¯ä»¥ä¸å†™ï¼Œå› ä¸ºä¸€å¼€å§‹å·²ç»å†™äº†`^[A-Za-z]`

----

## 1527. æ‚£æŸç§ç–¾ç—…çš„æ‚£è€…

[1527. æ‚£æŸç§ç–¾ç—…çš„æ‚£è€…](https://leetcode.cn/problems/patients-with-a-condition/)

æ‚£è€…ä¿¡æ¯è¡¨ï¼š `Patients`

```
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| patient_id   | int     |
| patient_name | varchar |
| conditions   | varchar |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œpatient_id ï¼ˆæ‚£è€… IDï¼‰æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
'conditions' ï¼ˆç–¾ç—…ï¼‰åŒ…å« 0 ä¸ªæˆ–ä»¥ä¸Šçš„ç–¾ç—…ä»£ç ï¼Œä»¥ç©ºæ ¼åˆ†éš”ã€‚
è¿™ä¸ªè¡¨åŒ…å«åŒ»é™¢ä¸­æ‚£è€…çš„ä¿¡æ¯ã€‚
```



æŸ¥è¯¢æ‚£æœ‰ I ç±»ç³–å°¿ç—…çš„æ‚£è€… ID ï¼ˆpatient_idï¼‰ã€æ‚£è€…å§“åï¼ˆpatient_nameï¼‰ä»¥åŠå…¶æ‚£æœ‰çš„æ‰€æœ‰ç–¾ç—…ä»£ç ï¼ˆconditionsï¼‰ã€‚I ç±»ç³–å°¿ç—…çš„ä»£ç æ€»æ˜¯åŒ…å«å‰ç¼€ `DIAB1` ã€‚

æŒ‰ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Patientsè¡¨ï¼š
+------------+--------------+--------------+
| patient_id | patient_name | conditions   |
+------------+--------------+--------------+
| 1          | Daniel       | YFEV COUGH   |
| 2          | Alice        |              |
| 3          | Bob          | DIAB100 MYOP |
| 4          | George       | ACNE DIAB100 |
| 5          | Alain        | DIAB201      |
+------------+--------------+--------------+
è¾“å‡ºï¼š
+------------+--------------+--------------+
| patient_id | patient_name | conditions   |
+------------+--------------+--------------+
| 3          | Bob          | DIAB100 MYOP |
| 4          | George       | ACNE DIAB100 | 
+------------+--------------+--------------+
è§£é‡Šï¼šBob å’Œ George éƒ½æ‚£æœ‰ä»£ç ä»¥ DIAB1 å¼€å¤´çš„ç–¾ç—…ã€‚
```

----

```python
import pandas as pd

def find_patients(patients: pd.DataFrame) -> pd.DataFrame:
    return patients[patients['conditions'].str.contains(r'^DIAB1|\sDIAB1', regex=True)]
```

è¿™é¢˜æ˜¯çœŸä¸ä¼šå†™äº†.å› ä¸ºæ— æ³•æäº¤æˆåŠŸï¼Œä½†æ˜¯æˆ‘æ‹¿å®˜æ–¹çš„ç­”æ¡ˆï¼ˆæ–¹æ³•1ï¼‰è¯•äº†ä¸‹ä¹Ÿé€šè¿‡ä¸äº†ï¼ˆ`+DIAB1`è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ— æ³•é€šè¿‡ï¼‰ï¼Œå’Œæˆ‘çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ã€‚ä¸Šé¢è¿™ä¸ªè§£ç­”æ˜¯æ–¹æ³•1ä¿®æ”¹æˆåŠŸä¹‹åçš„è§£æ³•ï¼Œä¹Ÿæ˜¯è¯„è®ºåŒºçœ‹çš„ã€‚

è§£é‡Šè¿™ä¸ªæ­£åˆ™ï¼š`^DIAB1`åŒ¹é…conditionså­—æ®µä»¥DIAB1å¼€å¤´çš„æƒ…å†µã€‚ `\sDIAB1`åŒ¹é…conditionsä¸­ç©ºæ ¼åç´§è·ŸDIAB1çš„æƒ…å†µã€‚ `| `æ˜¯é€»è¾‘â€œæˆ–â€çš„è¿ç®—ç¬¦ï¼Œè¡¨ç¤ºåŒ¹é…ä¸¤ç§æƒ…å†µä¸­çš„ä»»æ„ä¸€ç§ã€‚

---



# æµ‹éªŒé¢˜

## 2738. ç»Ÿè®¡æ–‡æœ¬ä¸­å•è¯çš„å‡ºç°æ¬¡æ•°

[2738. ç»Ÿè®¡æ–‡æœ¬ä¸­å•è¯çš„å‡ºç°æ¬¡æ•°](https://leetcode.cn/problems/count-occurrences-in-text/)

è¡¨ï¼š`Files`

```
+-------------+---------+
| åˆ—å        | ç±»å‹    |
+-- ----------+---------+
| file_name   | varchar |
| content     | text    |
+-------------+---------+
file_name ä¸ºè¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
æ¯è¡ŒåŒ…å« file_name å’Œè¯¥æ–‡ä»¶çš„å†…å®¹ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºå•è¯ **'bull'** å’Œ **'bear'** ä½œä¸º **ç‹¬ç«‹è¯** æœ‰å‡ºç°çš„æ–‡ä»¶æ•°é‡ï¼Œä¸è€ƒè™‘ä»»ä½•å®ƒå‡ºç°åœ¨ä¸¤ä¾§æ²¡æœ‰ç©ºæ ¼çš„æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œ'bullet', 'bears', 'bull.'ï¼Œæˆ–è€… 'bear' åœ¨å¥é¦–æˆ–å¥å°¾ **ä¸ä¼š** è¢«è€ƒè™‘ï¼‰ã€‚

è¿”å›å•è¯ 'bull' å’Œ 'bear' ä»¥åŠå®ƒä»¬å¯¹åº”çš„å‡ºç°æ–‡ä»¶æ•°é‡ï¼Œ**é¡ºåºæ²¡æœ‰é™åˆ¶** ã€‚

ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Files è¡¨:
+------------+----------------------------------------------------------------------------------+
| file_name  | contenet                                                                         | 
+------------+----------------------------------------------------------------------------------+
| draft1.txt | The stock exchange predicts a bull market which would make many investors happy. | 
| draft2.txt | The stock exchange predicts a bull market which would make many investors happy, |
|            | but analysts warn of possibility of too much optimism and that in fact we are    |
|            | awaiting a bear market.                                                          | 
| draft3.txt | The stock exchange predicts a bull market which would make many investors happy, |
|            | but analysts warn of possibility of too much optimism and that in fact we are    |
|            | awaiting a bear market. As always predicting the future market is an uncertain   |
|            | game and all investors should follow their instincts and best practices.         | 
+------------+----------------------------------------------------------------------------------+
è¾“å‡ºï¼š 
+------+-------+
| word | count |  
+------+-------+
| bull | 3     | 
| bear | 2     | 
+------+-------+
è§£é‡Šï¼š
- å•è¯ "bull" åœ¨ "draft1.txt" ä¸­å‡ºç°1æ¬¡ï¼Œåœ¨ "draft2.txt" ä¸­å‡ºç° 1 æ¬¡ï¼Œåœ¨ "draft3.txt" ä¸­å‡ºç° 1 æ¬¡ã€‚å› æ­¤ï¼Œå•è¯ "bull" å‡ºç°åœ¨ 3 ä¸ªæ–‡ä»¶ä¸­ã€‚
- å•è¯ "bear" åœ¨ "draft2.txt" ä¸­å‡ºç°1æ¬¡ï¼Œåœ¨ "draft3.txt" ä¸­å‡ºç° 1 æ¬¡ã€‚å› æ­¤ï¼Œå•è¯ "bear" å‡ºç°åœ¨ 2 ä¸ªæ–‡ä»¶ä¸­ã€‚
```

-----

```python
import pandas as pd

def count_occurrences(files: pd.DataFrame) -> pd.DataFrame:
    return pd.DataFrame(
        {'word':['bull', 'bear'], 
        'count':[files['content'].str.contains(r'\sbull\s').sum(), 
        files['content'].str.contains(r'\sbear\s').sum()]}
    )
```

`\s`è¡¨ç¤ºç©ºæ ¼ã€‚

# æ•°æ®æ“ä½œ

## 177. ç¬¬Né«˜çš„è–ªæ°´

[177. ç¬¬Né«˜çš„è–ªæ°´](https://leetcode.cn/problems/nth-highest-salary/)

è¡¨: `Employee`

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| salary      | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«æœ‰å…³å‘˜å·¥å·¥èµ„çš„ä¿¡æ¯ã€‚
```



æŸ¥è¯¢ `Employee` è¡¨ä¸­ç¬¬ `n` é«˜çš„å·¥èµ„ã€‚å¦‚æœæ²¡æœ‰ç¬¬ `n` ä¸ªæœ€é«˜å·¥èµ„ï¼ŒæŸ¥è¯¢ç»“æœåº”è¯¥ä¸º `null` ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Employee table:
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
n = 2
è¾“å‡º: 
+------------------------+
| getNthHighestSalary(2) |
+------------------------+
| 200                    |
+------------------------+
```

**ç¤ºä¾‹ 2:**

```
è¾“å…¥: 
Employee è¡¨:
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
+----+--------+
n = 2
è¾“å‡º: 
+------------------------+
| getNthHighestSalary(2) |
+------------------------+
| null                   |
+------------------------+
```

----

æˆ‘çš„ç­”æ¡ˆï¼šï¼ˆæ”¹äº†å¥½å¤šæ¬¡ï¼‰

```python
import pandas as pd

def nth_highest_salary(employee: pd.DataFrame, N: int) -> pd.DataFrame:
    distinct_salaries = employee['salary'].drop_duplicates().sort_values(ascending=False)
    if N <= 0 or N > len(distinct_salaries):  #Simplified condition
        res = None
    else:
        res = distinct_salaries.iloc[N - 1]
    return pd.DataFrame(data=[res], columns=[f'getNthHighestSalary({N})'])
```



## 176. ç¬¬äºŒé«˜çš„è–ªæ°´

[176. ç¬¬äºŒé«˜çš„è–ªæ°´](https://leetcode.cn/problems/second-highest-salary/)

`Employee` è¡¨ï¼š

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| salary      | int  |
+-------------+------+
id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«å‘˜å·¥çš„å·¥èµ„ä¿¡æ¯ã€‚
```



æŸ¥è¯¢å¹¶è¿”å› `Employee` è¡¨ä¸­ç¬¬äºŒé«˜çš„ **ä¸åŒ** è–ªæ°´ ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ŒæŸ¥è¯¢åº”è¯¥è¿”å› `null(Pandas åˆ™è¿”å› None)` ã€‚

æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| null                |
+---------------------+
```

---

åªä¸è¿‡å°±æ˜¯å‰ä¸€é¢˜å˜æˆäº†N=2çš„ç‰¹æ®Šæƒ…å†µï¼š

```python
import pandas as pd

def second_highest_salary(employee: pd.DataFrame) -> pd.DataFrame:
    sorted_salary = employee['salary'].drop_duplicates().sort_values( ascending=False)
    if  len(sorted_salary) < 2 :
        res = None
    else:
        res = sorted_salary.iloc[1]
    return pd.DataFrame(columns=['SecondHighestSalary'], data = [res])
```

## 184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥

[184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥](https://leetcode.cn/problems/department-highest-salary/)

è¡¨ï¼š `Employee`

```
+--------------+---------+
| åˆ—å          | ç±»å‹    |
+--------------+---------+
| id           | int     |
| name         | varchar |
| salary       | int     |
| departmentId | int     |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œidæ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚
departmentId æ˜¯ Department è¡¨ä¸­ id çš„å¤–é”®ï¼ˆåœ¨ Pandas ä¸­ç§°ä¸º join keyï¼‰ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå‘˜å·¥çš„ idã€å§“åå’Œå·¥èµ„ã€‚å®ƒè¿˜åŒ…å«ä»–ä»¬æ‰€åœ¨éƒ¨é—¨çš„ idã€‚
```



è¡¨ï¼š `Department`

```
+-------------+---------+
| åˆ—å         | ç±»å‹    |
+-------------+---------+
| id          | int     |
| name        | varchar |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯æ­¤è¡¨çš„ä¸»é”®åˆ—ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºä¸€ä¸ªéƒ¨é—¨çš„ id åŠå…¶åç§°ã€‚
```



æŸ¥æ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨ä¸­è–ªèµ„æœ€é«˜çš„å‘˜å·¥ã€‚
æŒ‰ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚
æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Employee è¡¨:
+----+-------+--------+--------------+
| id | name  | salary | departmentId |
+----+-------+--------+--------------+
| 1  | Joe   | 70000  | 1            |
| 2  | Jim   | 90000  | 1            |
| 3  | Henry | 80000  | 2            |
| 4  | Sam   | 60000  | 2            |
| 5  | Max   | 90000  | 1            |
+----+-------+--------+--------------+
Department è¡¨:
+----+-------+
| id | name  |
+----+-------+
| 1  | IT    |
| 2  | Sales |
+----+-------+
è¾“å‡ºï¼š
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Jim      | 90000  |
| Sales      | Henry    | 80000  |
| IT         | Max      | 90000  |
+------------+----------+--------+
è§£é‡Šï¼šMax å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜ã€‚
```

-----

è¿™é“é¢˜æˆ‘å°†è°ƒè¯•éƒ¨åˆ†ä¹Ÿé™„ä¸Šä»£ç ï¼š

```python
import pandas as pd

# Employee DataFrame
employee_data = {'id': [1, 2, 3, 4, 5],
                 'name': ['Joe', 'Jim', 'Henry', 'Sam', 'Max'],
                 'salary': [70000, 90000, 80000, 60000, 90000],
                 'departmentId': [1, 1, 2, 2, 1]}
employee = pd.DataFrame(employee_data)

# Department DataFrame
department_data = {'id': [1, 2],
                   'name': ['IT', 'Sales']}
Department = pd.DataFrame(department_data)

Department = Department.rename(
    columns={
        'id':'departmentId',
        'name':'Department'
    }
)
employee = employee.rename(
    columns={
        'name':'Employee',
        'salary':'Salary'
    }
)
merge_table = pd.merge(employee, Department, on='departmentId')


display(merge_table)
merge_table['max'] = merge_table.groupby('departmentId')['Salary'].transform('max')
display(merge_table)

merge_table[merge_table['max'] == merge_table['Salary']][['Department', 'Employee', 'Salary']]
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228134040360.png" alt="image-20250228134040360" style="zoom:50%;" />

å…³äºtransformå‡½æ•°ï¼Œå¯ä»¥å¤ä¹ ï¼š[è¿”å›ä¸è¾“å…¥ç»„å…·æœ‰ç›¸åŒå½¢çŠ¶çš„ç»“æœçš„transformå‡½æ•°](https://kirsten-1.github.io/2025/02/28/pandas%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0transform/)

é¢˜è§£ç­”æ¡ˆæ˜¯ï¼š

```python
import pandas as pd

def department_highest_salary(employee: pd.DataFrame, department: pd.DataFrame) -> pd.DataFrame:
    department = department.rename(
        columns={
            'id':'departmentId',
            'name':'Department'
        }
    )
    employee = employee.rename(
        columns={
            'name':'Employee',
            'salary':'Salary'
        }
    )
    merge_table = pd.merge(employee, department, on='departmentId')
    merge_table['max'] = merge_table.groupby('departmentId')['Salary'].transform('max')
    return merge_table[merge_table['max'] == merge_table['Salary']][['Department', 'Employee', 'Salary']]
    
```

## 178. åˆ†æ•°æ’å

[178. åˆ†æ•°æ’å](https://leetcode.cn/problems/rank-scores/)

è¡¨: `Scores`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| score       | decimal |
+-------------+---------+
id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆæœ‰ä¸åŒå€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«äº†ä¸€åœºæ¯”èµ›çš„åˆ†æ•°ã€‚Score æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä½å°æ•°ç‚¹çš„æµ®ç‚¹å€¼ã€‚
```



ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥æŸ¥è¯¢åˆ†æ•°çš„æ’åã€‚æ’åæŒ‰ä»¥ä¸‹è§„åˆ™è®¡ç®—:

- åˆ†æ•°åº”æŒ‰ä»é«˜åˆ°ä½æ’åˆ—ã€‚
- å¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸ç­‰ï¼Œé‚£ä¹ˆä¸¤ä¸ªåˆ†æ•°çš„æ’ååº”è¯¥ç›¸åŒã€‚
- åœ¨æ’åç›¸åŒçš„åˆ†æ•°åï¼Œæ’åæ•°åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°ã€‚æ¢å¥è¯è¯´ï¼Œæ’åä¹‹é—´ä¸åº”è¯¥æœ‰ç©ºç¼ºçš„æ•°å­—ã€‚

æŒ‰ `score` é™åºè¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Scores è¡¨:
+----+-------+
| id | score |
+----+-------+
| 1  | 3.50  |
| 2  | 3.65  |
| 3  | 4.00  |
| 4  | 3.85  |
| 5  | 4.00  |
| 6  | 3.65  |
+----+-------+
è¾“å‡º: 
+-------+------+
| score | rank |
+-------+------+
| 4.00  | 1    |
| 4.00  | 1    |
| 3.85  | 2    |
| 3.65  | 3    |
| 3.65  | 3    |
| 3.50  | 4    |
+-------+------+
```

---

è¿™é“é¢˜æˆ‘ç ”ç©¶äº†ä¸€ä¸‹rankå‡½æ•°çš„å‚æ•°,æœ€ç»ˆæœºç¼˜å·§åˆå±…ç„¶åšå‡ºæ¥äº†ï¼š

```python
import pandas as pd

def order_scores(scores: pd.DataFrame) -> pd.DataFrame:
    scores['rank'] = scores['score'].rank(ascending=False, method='dense')
    scores['rank'] = scores['rank'].apply(lambda x: int(x))
    sorted_df = scores.sort_values(by='score', ascending=False)
    return sorted_df[['score', 'rank']]
```

è¡¥å……ï¼š`df['rank'] = df['score'].rank(ascending=False, method='dense')`ä¸­çš„`method`å‚æ•°ï¼š

```python
df['rank'] = df['score'].rank(ascending=False, method='dense')
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228140539122.png" alt="image-20250228140539122" style="zoom:50%;" />

averageæ˜¯é»˜è®¤å‚æ•°ï¼š

```python
display(df)
df['rank'] = df['score'].rank(ascending=False, method='average')
display(df.sort_values(by='score', ascending=False))
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228140646508.png" alt="image-20250228140646508" style="zoom:50%;" />

è¡¥å……ï¼šå‰é¢çš„1.5æ˜¯è¿™ä¹ˆç®—çš„ï¼š

åº”è¯¥æ˜¯æ’å1å’Œ2ï¼Œä½†æ˜¯ä¸åˆ†å‰åï¼Œæ‰€ä»¥`ï¼ˆ1+2ï¼‰/2=1.5`

```python
display(df)
df['rank'] = df['score'].rank(ascending=False, method='min')
display(df.sort_values(by='score', ascending=False))
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228140801289.png" alt="image-20250228140801289" style="zoom:50%;" />

```python
display(df)
df['rank'] = df['score'].rank(ascending=False, method='max')
display(df.sort_values(by='score', ascending=False))
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228140820912.png" alt="image-20250228140820912" style="zoom:50%;" />

```python
display(df)
df['rank'] = df['score'].rank(ascending=False, method='first')
display(df.sort_values(by='score', ascending=False))
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228140903602.png" alt="image-20250228140903602" style="zoom:50%;" />

- **method**: æŒ‡å®šå¦‚ä½•å¤„ç†å¹³å±€ (ç›¸åŒçš„å€¼)ã€‚è¿™æ˜¯ rank() å‡½æ•°æœ€é‡è¦çš„å‚æ•°ä¹‹ä¸€ã€‚ é€‰é¡¹åŒ…æ‹¬ï¼š
    - 'average' (é»˜è®¤): å°†å¹³å‡æ’ååˆ†é…ç»™æ¯ä¸ªå¹³å±€ç»„ä¸­çš„å€¼ã€‚
    - 'min': å°†æœ€å°çš„æ’ååˆ†é…ç»™æ¯ä¸ªå¹³å±€ç»„ä¸­çš„å€¼ã€‚
    - 'max': å°†æœ€å¤§çš„æ’ååˆ†é…ç»™æ¯ä¸ªå¹³å±€ç»„ä¸­çš„å€¼ã€‚
    - 'first': æŒ‰ç…§å€¼åœ¨æ•°æ®ä¸­å‡ºç°çš„é¡ºåºåˆ†é…æ’åã€‚
    - 'dense': ç±»ä¼¼äº 'min'ï¼Œä½†æ’åä¹‹é—´æ²¡æœ‰é—´éš”ã€‚å³ï¼Œä¸‹ä¸€ä¸ªéå¹³å±€å€¼å°†è·å¾—ç´§éšå…¶åçš„æ’åã€‚

----

#### rankå¸¸è§çš„ä¸‰ç§æ’åºæ–¹å¼

- First é¡ºåºæ’åï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5
- Min è·³è·ƒæ’åï¼Œ1ï¼Œ2ï¼Œ2ï¼Œ4ï¼Œ5ï¼ˆå¹¶åˆ—2/3åï¼Œå–å°çš„2ï¼‰
- Dense å¯†é›†æ’åï¼Œ1ï¼Œ2ï¼Œ2ï¼Œ3ï¼Œ4

----

## 196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±

[196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±](https://leetcode.cn/problems/delete-duplicate-emails/)

è¡¨: `Person`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| email       | varchar |
+-------------+---------+
id æ˜¯è¯¥è¡¨çš„ä¸»é”®åˆ—(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«ä¸€å°ç”µå­é‚®ä»¶ã€‚ç”µå­é‚®ä»¶å°†ä¸åŒ…å«å¤§å†™å­—æ¯ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆ **åˆ é™¤** æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ä»¶ï¼Œåªä¿ç•™ä¸€ä¸ªå…·æœ‰æœ€å° `id` çš„å”¯ä¸€ç”µå­é‚®ä»¶ã€‚

ï¼ˆå¯¹äº SQL ç”¨æˆ·ï¼Œè¯·æ³¨æ„ä½ åº”è¯¥ç¼–å†™ä¸€ä¸ª `DELETE` è¯­å¥è€Œä¸æ˜¯ `SELECT` è¯­å¥ã€‚ï¼‰

ï¼ˆå¯¹äº Pandas ç”¨æˆ·ï¼Œè¯·æ³¨æ„ä½ åº”è¯¥ç›´æ¥ä¿®æ”¹ `Person` è¡¨ã€‚ï¼‰

è¿è¡Œè„šæœ¬åï¼Œæ˜¾ç¤ºçš„ç­”æ¡ˆæ˜¯ `Person` è¡¨ã€‚é©±åŠ¨ç¨‹åºå°†é¦–å…ˆç¼–è¯‘å¹¶è¿è¡Œæ‚¨çš„ä»£ç ç‰‡æ®µï¼Œç„¶åå†æ˜¾ç¤º `Person` è¡¨ã€‚`Person` è¡¨çš„æœ€ç»ˆé¡ºåº **æ— å…³ç´§è¦** ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Person è¡¨:
+----+------------------+
| id | email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
| 3  | john@example.com |
+----+------------------+
è¾“å‡º: 
+----+------------------+
| id | email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
+----+------------------+
è§£é‡Š: john@example.comé‡å¤ä¸¤æ¬¡ã€‚æˆ‘ä»¬ä¿ç•™æœ€å°çš„Id = 1ã€‚
```

-----

è¿™é¢˜å¤šå°‘æœ‰ç‚¹è„±è£¤å­æ”¾å±äº†ï¼Œå°±ä¸ºäº†å¼ºè°ƒç”¨`inplace=True`ï¼Œè€Œä¸”ç”¨2æ¬¡ , ç”¨è¿”å›å€¼å†èµ‹å€¼éƒ½ä¸è¡Œ

```python
# Person è¡¨:
# | id | email       |
# | -- | ----------- |
# | 2  | abc@efg.com |
# | 1  | abc@efg.com |

data = {'id':[2, 1], 'email':['abc@efg.com', 'abc@efg.com']}
person = pd.DataFrame(data)
display(person)

person = person.sort_values(by='id')
display(person)
person = person.drop_duplicates(subset=['email'], keep='first')
display(person)
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250228143321106.png" alt="image-20250228143321106" style="zoom:50%;" />

## 1795. æ¯ä¸ªäº§å“åœ¨ä¸åŒå•†åº—çš„ä»·æ ¼

[1795. æ¯ä¸ªäº§å“åœ¨ä¸åŒå•†åº—çš„ä»·æ ¼](https://leetcode.cn/problems/rearrange-products-table/)

è¡¨ï¼š`Products`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| product_id  | int     |
| store1      | int     |
| store2      | int     |
| store3      | int     |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œè¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ product_idï¼ˆäº§å“Idï¼‰ã€‚
æ¯è¡Œå­˜å‚¨äº†è¿™ä¸€äº§å“åœ¨ä¸åŒå•†åº— store1, store2, store3 çš„ä»·æ ¼ã€‚
å¦‚æœè¿™ä¸€äº§å“åœ¨å•†åº—é‡Œæ²¡æœ‰å‡ºå”®ï¼Œåˆ™å€¼å°†ä¸º nullã€‚
```



è¯·ä½ é‡æ„ `Products` è¡¨ï¼ŒæŸ¥è¯¢æ¯ä¸ªäº§å“åœ¨ä¸åŒå•†åº—çš„ä»·æ ¼ï¼Œä½¿å¾—è¾“å‡ºçš„æ ¼å¼å˜ä¸º`(product_id, store, price)` ã€‚å¦‚æœè¿™ä¸€äº§å“åœ¨å•†åº—é‡Œæ²¡æœ‰å‡ºå”®ï¼Œåˆ™ä¸è¾“å‡ºè¿™ä¸€è¡Œã€‚

è¾“å‡ºç»“æœè¡¨ä¸­çš„ **é¡ºåºä¸ä½œè¦æ±‚** ã€‚

æŸ¥è¯¢è¾“å‡ºæ ¼å¼è¯·å‚è€ƒä¸‹é¢ç¤ºä¾‹ã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Products table:
+------------+--------+--------+--------+
| product_id | store1 | store2 | store3 |
+------------+--------+--------+--------+
| 0          | 95     | 100    | 105    |
| 1          | 70     | null   | 80     |
+------------+--------+--------+--------+
è¾“å‡ºï¼š
+------------+--------+-------+
| product_id | store  | price |
+------------+--------+-------+
| 0          | store1 | 95    |
| 0          | store2 | 100   |
| 0          | store3 | 105   |
| 1          | store1 | 70    |
| 1          | store3 | 80    |
+------------+--------+-------+
è§£é‡Šï¼š
äº§å“ 0 åœ¨ store1ã€store2ã€store3 çš„ä»·æ ¼åˆ†åˆ«ä¸º 95ã€100ã€105ã€‚
äº§å“ 1 åœ¨ store1ã€store3 çš„ä»·æ ¼åˆ†åˆ«ä¸º 70ã€80ã€‚åœ¨ store2 æ— æ³•ä¹°åˆ°ã€‚
```

----

```python
import pandas as pd

def rearrange_products_table(products: pd.DataFrame) -> pd.DataFrame:
    df_melted = products.melt(id_vars=['product_id'], value_vars=['store1', 'store2', 'store3'],var_name='store', value_name='price')
    return df_melted.dropna(subset=['price'])
```

----

å…³äºpandasä¸­é‡å¡‘çš„å¤§å¸ˆ------ meltå‡½æ•°ï¼Œæ›´å¤šçš„ä»‹ç»ã€æ€»ç»“ã€è®°å¿†æ–¹æ³•å’Œç»ƒä¹ å‚è€ƒåšå®¢ï¼š[dfé•¿å®½å˜å½¢å¤§å¸ˆ - meltçš„é‡å¡‘ç¥åŠŸ](https://kirsten-1.github.io/2025/02/28/%E8%BD%AC%E6%8D%A2%E4%B8%8E%E9%87%8D%E5%A1%91df-melt%E5%87%BD%E6%95%B0/)

----

# æ•°æ®ç»Ÿè®¡

## 2082. å¯Œæœ‰å®¢æˆ·çš„æ•°é‡

[2082. å¯Œæœ‰å®¢æˆ·çš„æ•°é‡](https://leetcode.cn/problems/the-number-of-rich-customers/)

è¡¨ï¼š `Store`

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| bill_id     | int  |
| customer_id | int  |
| amount      | int  |
+-------------+------+
bill_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªè®¢å•çš„é‡‘é¢åŠç›¸å…³å®¢æˆ·çš„ä¿¡æ¯ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º **è‡³å°‘æœ‰ä¸€ä¸ª** è®¢å•çš„é‡‘é¢ **ä¸¥æ ¼å¤§äº** `500` çš„å®¢æˆ·çš„æ•°é‡ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Store è¡¨:
+---------+-------------+--------+
| bill_id | customer_id | amount |
+---------+-------------+--------+
| 6       | 1           | 549    |
| 8       | 1           | 834    |
| 4       | 2           | 394    |
| 11      | 3           | 657    |
| 13      | 3           | 257    |
+---------+-------------+--------+
è¾“å‡ºï¼š 
+------------+
| rich_count |
+------------+
| 2          |
+------------+
è§£é‡Šï¼š
å®¢æˆ· 1 æœ‰ 2 ä¸ªè®¢å•é‡‘é¢ä¸¥æ ¼å¤§äº 500ã€‚
å®¢æˆ· 2 æ²¡æœ‰ä»»ä½•è®¢å•é‡‘é¢ä¸¥æ ¼å¤§äº 500ã€‚
å®¢æˆ· 3 æœ‰ 1 ä¸ªè®¢å•é‡‘é¢ä¸¥æ ¼å¤§äº 500ã€‚
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def count_rich_customers(store: pd.DataFrame) -> pd.DataFrame:
    res = [(i[1]['amount'] > 500).any() for i in store.groupby('customer_id')]
    return pd.DataFrame({'rich_count': sum(res)}, index=[0])
```

å¯ä»¥é€šè¿‡ã€‚

å®˜æ–¹çš„ç­”æ¡ˆï¼š

```cpp
import pandas as pd

def count_rich_customers(store: pd.DataFrame) -> pd.DataFrame:
    rich_customers = store[store['amount'] > 500]
    
    count = rich_customers['customer_id'].nunique()

    answer = pd.DataFrame({'rich_count':[count]})

    return answer

```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250301145758041.png" alt="image-20250301145758041" style="zoom:50%;" />

----

å­¦åˆ°ä¸€ä¸ªæ–°å‡½æ•°ï¼š`nunique`ç»Ÿè®¡uniqueçš„ä¸ªæ•°çš„ã€‚

## 1173. å³æ—¶é£Ÿç‰©é…é€ I

[1173. å³æ—¶é£Ÿç‰©é…é€ I](https://leetcode.cn/problems/immediate-food-delivery-i/)

é…é€è¡¨: `Delivery`

```
+-----------------------------+---------+
| Column Name                 | Type    |
+-----------------------------+---------+
| delivery_id                 | int     |
| customer_id                 | int     |
| order_date                  | date    |
| customer_pref_delivery_date | date    |
+-----------------------------+---------+
delivery_id æ˜¯è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚
```



å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œå³æ—¶è®¢å•ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œè®¡åˆ’è®¢å•ã€ã€‚

ç¼–å†™è§£å†³æ–¹æ¡ˆç»Ÿè®¡å³æ—¶è®¢å•æ‰€å çš„ç™¾åˆ†æ¯”ï¼Œ **ä¿ç•™ä¸¤ä½å°æ•°ã€‚**

è¿”å›ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Delivery è¡¨:
+-------------+-------------+------------+-----------------------------+
| delivery_id | customer_id | order_date | customer_pref_delivery_date |
+-------------+-------------+------------+-----------------------------+
| 1           | 1           | 2019-08-01 | 2019-08-02                  |
| 2           | 5           | 2019-08-02 | 2019-08-02                  |
| 3           | 1           | 2019-08-11 | 2019-08-11                  |
| 4           | 3           | 2019-08-24 | 2019-08-26                  |
| 5           | 4           | 2019-08-21 | 2019-08-22                  |
| 6           | 2           | 2019-08-11 | 2019-08-13                  |
+-------------+-------------+------------+-----------------------------+
è¾“å‡ºï¼š
+----------------------+
| immediate_percentage |
+----------------------+
| 33.33                |
+----------------------+
è§£é‡Šï¼š2 å’Œ 3 å·è®¢å•ä¸ºå³æ—¶è®¢å•ï¼Œå…¶ä»–çš„ä¸ºè®¡åˆ’è®¢å•ã€‚
```

---

æœ¬é¢˜æµ‹è¯•æ•°æ®ï¼š

```python
# æ•°æ®
data = {
    'delivery_id': [1, 2, 3, 4, 5, 6],
    'customer_id': [1, 5, 1, 3, 4, 2],
    'order_date': ['2019-08-01', '2019-08-02', '2019-08-11', '2019-08-24', '2019-08-21', '2019-08-11'],
    'customer_pref_delivery_date': ['2019-08-02', '2019-08-02', '2019-08-11', '2019-08-26', '2019-08-22', '2019-08-13']
}

# åˆ›å»º DataFrame
delivery = pd.DataFrame(data)

# å°†æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸º datetime å¯¹è±¡
delivery['order_date'] = pd.to_datetime(delivery['order_date'])
delivery['customer_pref_delivery_date'] = pd.to_datetime(delivery['customer_pref_delivery_date'])

display(delivery)
print(delivery.dtypes)


rate = sum(delivery['order_date'] == delivery['customer_pref_delivery_date'])/len(delivery)
pd.DataFrame({'immediate_percentage':[rate]})
```

æˆ‘å†™çš„ç­”æ¡ˆ:

```python
import pandas as pd

def food_delivery(delivery: pd.DataFrame) -> pd.DataFrame:
    rate = sum(delivery['order_date'] == delivery['customer_pref_delivery_date'])/len(delivery)
    return pd.DataFrame({'immediate_percentage':[round(rate*100, 2)]})
```



## 1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´

[1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´](https://leetcode.cn/problems/count-salary-categories/)

è¡¨: `Accounts`

```
+-------------+------+
| åˆ—å        | ç±»å‹  |
+-------------+------+
| account_id  | int  |
| income      | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œaccount_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªé“¶è¡Œå¸æˆ·çš„æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚
```



æŸ¥è¯¢æ¯ä¸ªå·¥èµ„ç±»åˆ«çš„é“¶è¡Œè´¦æˆ·æ•°é‡ã€‚ å·¥èµ„ç±»åˆ«å¦‚ä¸‹ï¼š

- `"Low Salary"`ï¼šæ‰€æœ‰å·¥èµ„ **ä¸¥æ ¼ä½äº** `20000` ç¾å…ƒã€‚
- `"Average Salary"`ï¼š **åŒ…å«** èŒƒå›´å†…çš„æ‰€æœ‰å·¥èµ„ `[$20000, $50000]` ã€‚
- `"High Salary"`ï¼šæ‰€æœ‰å·¥èµ„ **ä¸¥æ ¼å¤§äº** `50000` ç¾å…ƒã€‚

ç»“æœè¡¨ **å¿…é¡»** åŒ…å«æ‰€æœ‰ä¸‰ä¸ªç±»åˆ«ã€‚ å¦‚æœæŸä¸ªç±»åˆ«ä¸­æ²¡æœ‰å¸æˆ·ï¼Œåˆ™æŠ¥å‘Š `0` ã€‚

æŒ‰ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹ã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Accounts è¡¨:
+------------+--------+
| account_id | income |
+------------+--------+
| 3          | 108939 |
| 2          | 12747  |
| 8          | 87709  |
| 6          | 91796  |
+------------+--------+
è¾“å‡ºï¼š
+----------------+----------------+
| category       | accounts_count |
+----------------+----------------+
| Low Salary     | 1              |
| Average Salary | 0              |
| High Salary    | 3              |
+----------------+----------------+
è§£é‡Šï¼š
ä½è–ª: æœ‰ä¸€ä¸ªè´¦æˆ· 2.
ä¸­ç­‰è–ªæ°´: æ²¡æœ‰.
é«˜è–ª: æœ‰ä¸‰ä¸ªè´¦æˆ·ï¼Œä»–ä»¬æ˜¯ 3, 6å’Œ 8.
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
# æ•°æ®
data = {
    'account_id': [3, 2, 8, 6],
    'income': [108939, 12747, 87709, 91796]
}
```

---

æˆ‘çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def count_salary_categories(accounts: pd.DataFrame) -> pd.DataFrame:
    l = (accounts['income'] < 20000).sum()
    a = ((20000 <= accounts['income']) &  (accounts['income'] <= 50000)).sum()
    h = (accounts['income'] > 50000).sum()
    return pd.DataFrame({'category':['Low Salary', 'Average Salary', 'High Salary'], 'accounts_count':[l, a, h]})
```

ç­”æ¡ˆå’Œæˆ‘å†™çš„ç±»ä¼¼ã€‚



# æµ‹éªŒé¢˜

## 1322. å¹¿å‘Šæ•ˆæœ

[1322. å¹¿å‘Šæ•ˆæœ](https://leetcode.cn/problems/ads-performance/)

è¡¨: `Ads`

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| ad_id         | int     |
| user_id       | int     |
| action        | enum    |
+---------------+---------+
(ad_id, user_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)
è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«ä¸€æ¡å¹¿å‘Šçš„ ID(ad_id)ï¼Œç”¨æˆ·çš„ ID(user_id) å’Œç”¨æˆ·å¯¹å¹¿å‘Šé‡‡å–çš„è¡Œä¸º (action)
action åˆ—æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ ('Clicked', 'Viewed', 'Ignored') ã€‚
```



ä¸€å®¶å…¬å¸æ­£åœ¨è¿è¥è¿™äº›å¹¿å‘Šå¹¶æƒ³è®¡ç®—æ¯æ¡å¹¿å‘Šçš„æ•ˆæœã€‚

å¹¿å‘Šæ•ˆæœç”¨ç‚¹å‡»é€šè¿‡ç‡ï¼ˆClick-Through Rateï¼šCTRï¼‰æ¥è¡¡é‡ï¼Œå…¬å¼å¦‚ä¸‹:

![image-20250301161341752](https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/sql1.png)

ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºæ¯ä¸€æ¡å¹¿å‘Šçš„ `ctr` ï¼Œ`ctr` è¦ **ä¿ç•™ä¸¤ä½å°æ•°** ã€‚

è¿”å›ç»“æœéœ€è¦æŒ‰ `ctr` **é™åº**ã€æŒ‰ `ad_id` **å‡åº** è¿›è¡Œæ’åºã€‚

è¿”å›ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Ads è¡¨:
+-------+---------+---------+
| ad_id | user_id | action  |
+-------+---------+---------+
| 1     | 1       | Clicked |
| 2     | 2       | Clicked |
| 3     | 3       | Viewed  |
| 5     | 5       | Ignored |
| 1     | 7       | Ignored |
| 2     | 7       | Viewed  |
| 3     | 5       | Clicked |
| 1     | 4       | Viewed  |
| 2     | 11      | Viewed  |
| 1     | 2       | Clicked |
+-------+---------+---------+
è¾“å‡ºï¼š
+-------+-------+
| ad_id | ctr   |
+-------+-------+
| 1     | 66.67 |
| 3     | 50.00 |
| 2     | 33.33 |
| 5     | 0.00  |
+-------+-------+
è§£é‡Šï¼š
å¯¹äº ad_id = 1, ctr = (2/(2+1)) * 100 = 66.67
å¯¹äº ad_id = 2, ctr = (1/(1+2)) * 100 = 33.33
å¯¹äº ad_id = 3, ctr = (1/(1+1)) * 100 = 50.00
å¯¹äº ad_id = 5, ctr = 0.00, æ³¨æ„ ad_id = 5 æ²¡æœ‰è¢«ç‚¹å‡» (Clicked) æˆ–æŸ¥çœ‹ (Viewed) è¿‡
æ³¨æ„æˆ‘ä»¬ä¸å…³å¿ƒ action ä¸º Ingnored çš„å¹¿å‘Š
```

---

æµ‹è¯•æ•°æ®ï¼š

```python
data = {
    'ad_id': [1, 2, 3, 5, 1, 2, 3, 1, 2, 1],
    'user_id': [1, 2, 3, 5, 7, 7, 5, 4, 11, 2],
    'action': ['Clicked', 'Clicked', 'Viewed', 'Ignored', 'Ignored', 'Viewed', 'Clicked', 'Viewed', 'Viewed', 'Clicked']
}
```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼šï¼ˆæ—¶é—´å¤æ‚åº¦ç•¥å¤§ï¼‰ï¼š

```python
import pandas as pd

def ads_performance(ads: pd.DataFrame) -> pd.DataFrame:
    ad_id = ads['ad_id'].unique()
    ctr = []
    for id in ad_id:
        ads_i = ads[ads['ad_id'] == id]
        clicked = (ads_i['action'] == 'Clicked').sum()
        viewed = (ads_i['action'] == 'Viewed').sum()
        ctr.append(0 if clicked + viewed == 0 else round(100*clicked/(clicked + viewed), 2))   
    return pd.DataFrame({'ad_id':ad_id, 'ctr':ctr}).sort_values(by=['ctr', 'ad_id'], ascending=[False, True])
```

# æ•°æ®åˆ†ç»„

## 1741. æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´

[1741. æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥èŠ±è´¹çš„æ€»æ—¶é—´](https://leetcode.cn/problems/find-total-time-spent-by-each-employee/)

è¡¨: `Employees`

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| emp_id      | int  |
| event_day   | date |
| in_time     | int  |
| out_time    | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œ(emp_id, event_day, in_time) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨æ˜¾ç¤ºäº†å‘˜å·¥åœ¨åŠå…¬å®¤çš„å‡ºå…¥æƒ…å†µã€‚
event_day æ˜¯æ­¤äº‹ä»¶å‘ç”Ÿçš„æ—¥æœŸï¼Œin_time æ˜¯å‘˜å·¥è¿›å…¥åŠå…¬å®¤çš„æ—¶é—´ï¼Œè€Œ out_time æ˜¯ä»–ä»¬ç¦»å¼€åŠå…¬å®¤çš„æ—¶é—´ã€‚
in_time å’Œ out_time çš„å–å€¼åœ¨1åˆ°1440ä¹‹é—´ã€‚
é¢˜ç›®ä¿è¯åŒä¸€å¤©æ²¡æœ‰ä¸¤ä¸ªäº‹ä»¶åœ¨æ—¶é—´ä¸Šæ˜¯ç›¸äº¤çš„ï¼Œå¹¶ä¸”ä¿è¯ in_time å°äº out_timeã€‚
```



è®¡ç®—æ¯ä½å‘˜å·¥æ¯å¤©åœ¨åŠå…¬å®¤èŠ±è´¹çš„æ€»æ—¶é—´ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œåœ¨ä¸€å¤©ä¹‹å†…ï¼ŒåŒä¸€å‘˜å·¥æ˜¯å¯ä»¥å¤šæ¬¡è¿›å…¥å’Œç¦»å¼€åŠå…¬å®¤çš„ã€‚ åœ¨åŠå…¬å®¤é‡Œä¸€æ¬¡è¿›å‡ºæ‰€èŠ±è´¹çš„æ—¶é—´ä¸ºout_time å‡å» in_timeã€‚

è¿”å›ç»“æœè¡¨å•çš„é¡ºåºæ— è¦æ±‚ã€‚
æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Employees table:
+--------+------------+---------+----------+
| emp_id | event_day  | in_time | out_time |
+--------+------------+---------+----------+
| 1      | 2020-11-28 | 4       | 32       |
| 1      | 2020-11-28 | 55      | 200      |
| 1      | 2020-12-03 | 1       | 42       |
| 2      | 2020-11-28 | 3       | 33       |
| 2      | 2020-12-09 | 47      | 74       |
+--------+------------+---------+----------+
è¾“å‡ºï¼š
+------------+--------+------------+
| day        | emp_id | total_time |
+------------+--------+------------+
| 2020-11-28 | 1      | 173        |
| 2020-11-28 | 2      | 30         |
| 2020-12-03 | 1      | 41         |
| 2020-12-09 | 2      | 27         |
+------------+--------+------------+
è§£é‡Šï¼š
é›‡å‘˜ 1 æœ‰ä¸‰æ¬¡è¿›å‡º: æœ‰ä¸¤æ¬¡å‘ç”Ÿåœ¨ 2020-11-28 èŠ±è´¹çš„æ—¶é—´ä¸º (32 - 4) + (200 - 55) = 173, æœ‰ä¸€æ¬¡å‘ç”Ÿåœ¨ 2020-12-03 èŠ±è´¹çš„æ—¶é—´ä¸º (42 - 1) = 41ã€‚
é›‡å‘˜ 2 æœ‰ä¸¤æ¬¡è¿›å‡º: æœ‰ä¸€æ¬¡å‘ç”Ÿåœ¨ 2020-11-28 èŠ±è´¹çš„æ—¶é—´ä¸º (33 - 3) = 30,  æœ‰ä¸€æ¬¡å‘ç”Ÿåœ¨ 2020-12-09 èŠ±è´¹çš„æ—¶é—´ä¸º (74 - 47) = 27ã€‚
```

---

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'emp_id': [1, 1, 1, 2, 2],
        'event_day': ['2020-11-28', '2020-11-28', '2020-12-03', '2020-11-28', '2020-12-09'],
        'in_time': [4, 55, 1, 3, 47],
        'out_time': [32, 200, 42, 33, 74]}
```

---

æˆ‘çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def total_time(employees: pd.DataFrame) -> pd.DataFrame:
    employees['total'] = employees['out_time'] - employees['in_time']
    employees['total_time'] = employees.groupby(['emp_id', 'event_day'])['total'].transform('sum')
    res = employees.drop_duplicates(subset=['emp_id', 'event_day'])
    res = res.rename(columns={'event_day':'day'})
    return res[['day', 'emp_id', 'total_time']]
```

----

å®˜æ–¹ç­”æ¡ˆæœ‰ä¸€ä¸ªå‡½æ•°`reset_index`:

```python
import pandas as pd

# ç¤ºä¾‹ DataFrame
data = {'col1': [1, 2, 3],
        'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])  # ä½¿ç”¨è‡ªå®šä¹‰ç´¢å¼•

print("åŸå§‹ DataFrame:\n", df)

# ä½¿ç”¨ reset_index()
df_reset = df.reset_index()

print("\né‡ç½®ç´¢å¼•åçš„ DataFrame:\n", df_reset)
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250301171532540.png" alt="image-20250301171532540" style="zoom:50%;" />



## 511. æ¸¸æˆç©æ³•åˆ†æ I

[511. æ¸¸æˆç©æ³•åˆ†æ I](https://leetcode.cn/problems/game-play-analysis-i/)

æ´»åŠ¨è¡¨ `Activity`ï¼š

```
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œè¡¨çš„ä¸»é”®æ˜¯ (player_id, event_date)ã€‚
è¿™å¼ è¡¨å±•ç¤ºäº†ä¸€äº›æ¸¸æˆç©å®¶åœ¨æ¸¸æˆå¹³å°ä¸Šçš„è¡Œä¸ºæ´»åŠ¨ã€‚
æ¯è¡Œæ•°æ®è®°å½•äº†ä¸€åç©å®¶åœ¨é€€å‡ºå¹³å°ä¹‹å‰ï¼Œå½“å¤©ä½¿ç”¨åŒä¸€å°è®¾å¤‡ç™»å½•å¹³å°åæ‰“å¼€çš„æ¸¸æˆçš„æ•°ç›®ï¼ˆå¯èƒ½æ˜¯ 0 ä¸ªï¼‰ã€‚
```



æŸ¥è¯¢æ¯ä½ç©å®¶ **ç¬¬ä¸€æ¬¡ç™»å½•å¹³å°çš„æ—¥æœŸ**ã€‚

æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

```
Activity è¡¨ï¼š
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-05-02 | 6            |
| 2         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+

Result è¡¨ï¼š
+-----------+-------------+
| player_id | first_login |
+-----------+-------------+
| 1         | 2016-03-01  |
| 2         | 2017-06-25  |
| 3         | 2016-03-02  |
+-----------+-------------+
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'player_id': [1, 1, 2, 3, 3],
        'device_id': [2, 2, 3, 1, 4],
        'event_date': ['2016-03-01', '2016-05-02', '2017-06-25', '2016-03-02', '2018-07-03'],
        'games_played': [5, 6, 1, 0, 5]}
data = {'player_id': [1, 3],
        'device_id': [2, 4],
        'event_date': ['2016-03-01', '2016-02-03'],
        'games_played': [5, 5]}
```

ä¸çŸ¥é“æˆ‘å†™çš„æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œç¢°åˆ°åŠ›æ‰£ä¸€ä¸ªè´¼é•¿çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ‡’å¾—æŸ¥ä¸ºä»€ä¹ˆäº†ã€‚ã€‚ã€‚

```python
import pandas as pd

def game_analysis(activity: pd.DataFrame) -> pd.DataFrame:
    activity['first_login'] = activity.groupby('player_id')['event_date'].transform('min')
    activity = activity.drop_duplicates(subset=['first_login'])
    return activity[['player_id', 'first_login']]
```

å®˜æ–¹ç­”æ¡ˆæ˜¯ï¼š

```python
import pandas as pd

def game_analysis(activity: pd.DataFrame) -> pd.DataFrame:
    df = activity.groupby('player_id')['event_date'].min().reset_index()

    return df.rename(columns = {'event_date':'first_login'})

```

å’Œæˆ‘å†™çš„å·®ä¸å¤šï¼Œä½†æ˜¯æœ‰`reset_index()`

GPTè¯´è¿™ä¸¤æ®µä»£ç ä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œå³ä¸€ä¸ª DataFrameï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ª player_id åŠå…¶å¯¹åº”çš„æœ€æ—©ç™»å½•æ—¥æœŸã€‚

-----



## 2356. æ¯ä½æ•™å¸ˆæ‰€æ•™æˆçš„ç§‘ç›®ç§ç±»çš„æ•°é‡

[2356. æ¯ä½æ•™å¸ˆæ‰€æ•™æˆçš„ç§‘ç›®ç§ç±»çš„æ•°é‡](https://leetcode.cn/problems/number-of-unique-subjects-taught-by-each-teacher/)

è¡¨: `Teacher`

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| teacher_id  | int  |
| subject_id  | int  |
| dept_id     | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œ(subject_id, dept_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå¸¦æœ‰ teacher_id çš„æ•™å¸ˆåœ¨ç³» dept_id ä¸­æ•™æˆç§‘ç›® subject_idã€‚
```



æŸ¥è¯¢æ¯ä½è€å¸ˆåœ¨å¤§å­¦é‡Œæ•™æˆçš„ç§‘ç›®ç§ç±»çš„æ•°é‡ã€‚

ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Teacher è¡¨:
+------------+------------+---------+
| teacher_id | subject_id | dept_id |
+------------+------------+---------+
| 1          | 2          | 3       |
| 1          | 2          | 4       |
| 1          | 3          | 3       |
| 2          | 1          | 1       |
| 2          | 2          | 1       |
| 2          | 3          | 1       |
| 2          | 4          | 1       |
+------------+------------+---------+
è¾“å‡º:  
+------------+-----+
| teacher_id | cnt |
+------------+-----+
| 1          | 2   |
| 2          | 4   |
+------------+-----+
è§£é‡Š: 
æ•™å¸ˆ 1:
  - ä»–åœ¨ 3ã€4 ç³»æ•™ç§‘ç›® 2ã€‚
  - ä»–åœ¨ 3 ç³»æ•™ç§‘ç›® 3ã€‚
æ•™å¸ˆ 2:
  - ä»–åœ¨ 1 ç³»æ•™ç§‘ç›® 1ã€‚
  - ä»–åœ¨ 1 ç³»æ•™ç§‘ç›® 2ã€‚
  - ä»–åœ¨ 1 ç³»æ•™ç§‘ç›® 3ã€‚
  - ä»–åœ¨ 1 ç³»æ•™ç§‘ç›® 4ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'teacher_id': [1, 1, 1, 2, 2, 2, 2],
        'subject_id': [2, 2, 3, 1, 2, 3, 4],
        'dept_id': [3, 4, 3, 1, 1, 1, 1]}

teacher = pd.DataFrame(data)
display(teacher)
```

---

è¿™é¢˜æˆ‘å†™çš„æ¯”è¾ƒé¡ºåˆ©ï¼š

```python
import pandas as pd

def count_unique_subjects(teacher: pd.DataFrame) -> pd.DataFrame:
    sub = teacher.groupby('teacher_id')['subject_id'].unique().reset_index()
    sub['cnt'] = sub['subject_id'].str.len()  # .str.len() æ–¹æ³•æ¥è·å–æ¯ä¸ªåˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡ã€‚
    return sub[['teacher_id', 'cnt']]
```

è¡¥å……ï¼š`reset_index() `åœ¨è¿™æ®µä»£ç ä¸­çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œå®ƒå½±å“ç€ groupby æ“ä½œçš„ç»“æœä»¥åŠåç»­è®¡ç®—åˆ—è¡¨é•¿åº¦çš„æ–¹å¼ã€‚

- **`teacher.groupby('teacher_id')['subject_id'].unique()`**: è¿™ä¸€æ­¥æŒ‰ `teacher_id `åˆ†ç»„ï¼Œå¹¶è·å–æ¯ä¸ªæ•™å¸ˆå¯¹åº”çš„å”¯ä¸€ `subject_id `åˆ—è¡¨ã€‚ ç»“æœæ˜¯ä¸€ä¸ª Seriesï¼Œå…¶ä¸­ teacher_id æ˜¯ç´¢å¼•ã€‚

- **`.reset_index()`**: **å…³é”®ä½œç”¨ï¼š**` reset_index() `å°†ç´¢å¼• `teacher_id `è½¬æ¢ä¸º DataFrame çš„ä¸€ä¸ªæ™®é€šåˆ—ã€‚ è¿™ä¼šå°† Series è½¬æ¢ä¸º DataFrameï¼Œå…¶ä¸­åŒ…å«ä¸¤åˆ—ï¼š`teacher_id `å’Œ `subject_id`ï¼ˆåŒ…å«å”¯ä¸€ç§‘ç›®åˆ—è¡¨ï¼‰ã€‚ è¿™æ ·åšçš„ç›®çš„æ˜¯è®© `teacher_id `æˆä¸ºä¸€ä¸ªå¯ä»¥æ“ä½œçš„åˆ—ï¼Œè€Œä¸æ˜¯ç´¢å¼•ã€‚

å¦‚æœæ²¡æœ‰ `reset_index()`ï¼Œsub ä»ç„¶æ˜¯ä¸€ä¸ª Seriesï¼Œå…¶ä¸­ `teacher_id` æ˜¯ç´¢å¼•ï¼Œè€ŒåŒ…å«å”¯ä¸€ç§‘ç›®åˆ—è¡¨æ˜¯ Series çš„å€¼ã€‚

å› ä¸ºsubæ˜¯Seriesï¼Œæ‰€ä»¥è¦å…ˆä½¿ç”¨`to_frame()`å‡½æ•°è½¬æ¢ä¸ºDataframeï¼Œç´¢å¼•ä¼šé»˜è®¤æˆä¸ºDataframeçš„ç´¢å¼•

æ‰€ä»¥ä¹Ÿå¯ä»¥å†™æˆï¼š

```python
import pandas as pd

def count_unique_subjects(teacher: pd.DataFrame) -> pd.DataFrame:
    sub = teacher.groupby('teacher_id')['subject_id'].unique()  # å»æ‰reset_index()
    sub = sub.to_frame()  # å°† Series è½¬æ¢ä¸º DataFrame, ç´¢å¼•æˆä¸ºDataFrameçš„ç´¢å¼•
    sub['cnt'] = sub['subject_id'].str.len()  # .str.len() æ–¹æ³•æ¥è·å–æ¯ä¸ªåˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡ã€‚
    return sub.rename_axis('teacher_id').reset_index()[['teacher_id', 'cnt']]
```

æœ€ç»ˆè¿˜æ˜¯è¦å†ç”¨`reset_index()`è½¬æ¢ä¸ºåˆ—ã€‚

-----

## 596. è¶…è¿‡ 5 åå­¦ç”Ÿçš„è¯¾

[596. è¶…è¿‡ 5 åå­¦ç”Ÿçš„è¯¾](https://leetcode.cn/problems/classes-more-than-5-students/)

è¡¨: `Courses`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| student     | varchar |
| class       | varchar |
+-------------+---------+
(student, class)æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆä¸åŒå€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºå­¦ç”Ÿçš„åå­—å’Œä»–ä»¬æ³¨å†Œçš„ç­çº§ã€‚
```



æŸ¥è¯¢ **è‡³å°‘æœ‰ 5 ä¸ªå­¦ç”Ÿ** çš„æ‰€æœ‰ç­çº§ã€‚

ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Courses table:
+---------+----------+
| student | class    |
+---------+----------+
| A       | Math     |
| B       | English  |
| C       | Math     |
| D       | Biology  |
| E       | Math     |
| F       | Computer |
| G       | Math     |
| H       | Math     |
| I       | Math     |
+---------+----------+
è¾“å‡º: 
+---------+ 
| class   | 
+---------+ 
| Math    | 
+---------+
è§£é‡Š: 
-æ•°å­¦è¯¾æœ‰ 6 ä¸ªå­¦ç”Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬åŒ…æ‹¬å®ƒã€‚
-è‹±è¯­è¯¾æœ‰ 1 åå­¦ç”Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åŒ…æ‹¬å®ƒã€‚
-ç”Ÿç‰©è¯¾æœ‰ 1 åå­¦ç”Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åŒ…æ‹¬å®ƒã€‚
-è®¡ç®—æœºè¯¾æœ‰ 1 ä¸ªå­¦ç”Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åŒ…æ‹¬å®ƒã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'student': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'],
        'class': ['Math', 'English', 'Math', 'Biology', 'Math', 'Computer', 'Math', 'Math', 'Math']}
```

----

è¿™é¢˜ç»è¿‡å‰é¢è¿™ä¹ˆå¤šé¢˜ç›®çš„è®­ç»ƒï¼Œå˜å¾—éå¸¸ç®€å•äº†ï¼š

```python
import pandas as pd

def find_classes(courses: pd.DataFrame) -> pd.DataFrame:
    res = courses.groupby('class')['student'].count() .reset_index()
    return res[res['student'] >= 5][['class']]
```



## 586. è®¢å•æœ€å¤šçš„å®¢æˆ·

[586. è®¢å•æœ€å¤šçš„å®¢æˆ·](https://leetcode.cn/problems/customer-placing-the-largest-number-of-orders/)

è¡¨: `Orders`

```
+-----------------+----------+
| Column Name     | Type     |
+-----------------+----------+
| order_number    | int      |
| customer_number | int      |
+-----------------+----------+
åœ¨ SQL ä¸­ï¼ŒOrder_numberæ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
æ­¤è¡¨åŒ…å«å…³äºè®¢å•IDå’Œå®¢æˆ·IDçš„ä¿¡æ¯ã€‚
```



æŸ¥æ‰¾ä¸‹äº† **æœ€å¤šè®¢å•** çš„å®¢æˆ·çš„ `customer_number` ã€‚

æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆåï¼Œ **æ°å¥½æœ‰ä¸€ä¸ªå®¢æˆ·** æ¯”ä»»ä½•å…¶ä»–å®¢æˆ·ä¸‹äº†æ›´å¤šçš„è®¢å•ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Orders è¡¨:
+--------------+-----------------+
| order_number | customer_number |
+--------------+-----------------+
| 1            | 1               |
| 2            | 2               |
| 3            | 3               |
| 4            | 3               |
+--------------+-----------------+
è¾“å‡º: 
+-----------------+
| customer_number |
+-----------------+
| 3               |
+-----------------+
è§£é‡Š: 
customer_number ä¸º '3' çš„é¡¾å®¢æœ‰ä¸¤ä¸ªè®¢å•ï¼Œæ¯”é¡¾å®¢ '1' æˆ–è€… '2' éƒ½è¦å¤šï¼Œå› ä¸ºä»–ä»¬åªæœ‰ä¸€ä¸ªè®¢å•ã€‚
æ‰€ä»¥ç»“æœæ˜¯è¯¥é¡¾å®¢çš„ customer_number ï¼Œä¹Ÿå°±æ˜¯ 3 ã€‚
```

------

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'order_number': [1, 2, 3, 4],
        'customer_number': [1, 2, 3, 3]}
```

----

æˆ‘çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def largest_orders(orders: pd.DataFrame) -> pd.DataFrame:
    res = orders.groupby('customer_number')['order_number'].count().reset_index()
    res = res[res['order_number'].max() == res['order_number']]
    return res[['customer_number']]
```



---

**è¿›é˜¶ï¼š** å¦‚æœæœ‰å¤šä½é¡¾å®¢è®¢å•æ•°å¹¶åˆ—æœ€å¤šï¼Œä½ èƒ½æ‰¾åˆ°ä»–ä»¬æ‰€æœ‰çš„ `customer_number` å—ï¼Ÿ

ç”¨æˆ‘ä¸Šé¢çš„è§£æ³•ä¹Ÿæ²¡é—®é¢˜å•Šï¼š

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250302104618377.png" alt="image-20250302104618377" style="zoom:50%;" />



## 1484. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“

[1484. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“](https://leetcode.cn/problems/group-sold-products-by-the-date/)

è¡¨ `Activities`ï¼š

```
+-------------+---------+
| åˆ—å         | ç±»å‹    |
+-------------+---------+
| sell_date   | date    |
| product     | varchar |
+-------------+---------+
è¯¥è¡¨æ²¡æœ‰ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚å®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«äº§å“åç§°å’Œåœ¨å¸‚åœºä¸Šé”€å”®çš„æ—¥æœŸã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºæ¯ä¸ªæ—¥æœŸã€é”€å”®çš„ä¸åŒäº§å“çš„æ•°é‡åŠå…¶åç§°ã€‚
æ¯ä¸ªæ—¥æœŸçš„é”€å”®äº§å“åç§°åº”æŒ‰è¯å…¸åºæ’åˆ—ã€‚
è¿”å›æŒ‰ `sell_date` æ’åºçš„ç»“æœè¡¨ã€‚
ç»“æœè¡¨ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
Activities è¡¨ï¼š
+------------+-------------+
| sell_date  | product     |
+------------+-------------+
| 2020-05-30 | Headphone   |
| 2020-06-01 | Pencil      |
| 2020-06-02 | Mask        |
| 2020-05-30 | Basketball  |
| 2020-06-01 | Bible       |
| 2020-06-02 | Mask        |
| 2020-05-30 | T-Shirt     |
+------------+-------------+
è¾“å‡ºï¼š
+------------+----------+------------------------------+
| sell_date  | num_sold | products                     |
+------------+----------+------------------------------+
| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |
| 2020-06-01 | 2        | Bible,Pencil                 |
| 2020-06-02 | 1        | Mask                         |
+------------+----------+------------------------------+
è§£é‡Šï¼š
å¯¹äº2020-05-30ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Headphone, Basketball, T-shirt)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å· ',' åˆ†éš”ã€‚
å¯¹äº2020-06-01ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Pencil, Bible)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å·åˆ†éš”ã€‚
å¯¹äº2020-06-02ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Mask)ï¼Œåªéœ€è¿”å›è¯¥ç‰©å“åã€‚
```

---

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'sell_date': ['2020-05-30', '2020-06-01', '2020-06-02', '2020-05-30', '2020-06-01', '2020-06-02', '2020-05-30'],
        'product': ['Headphone', 'Pencil', 'Mask', 'Basketball', 'Bible', 'Mask', 'T-Shirt']}
```



---

è¿™é“é¢˜çš„ç±»å‹æˆ‘è¿˜æ²¡æœ‰ç»“æŸè¿‡ã€‚ç”¨äº†gptï¼Œä¸‹é¢çš„å†™æ³•å¤ªå¼ºäº†ï¼š

```python
import pandas as pd

def categorize_products(activities: pd.DataFrame) -> pd.DataFrame:
    res = activities.groupby('sell_date')['product'].agg(['nunique', lambda x: ','.join(sorted(x.unique()))]).reset_index()
    res = res.rename(columns={
        'nunique':'num_sold',
        '<lambda_0>':'products'
    })
    return res
```



## 1693. æ¯å¤©çš„é¢†å¯¼å’Œåˆä¼™äºº

[1693. æ¯å¤©çš„é¢†å¯¼å’Œåˆä¼™äºº](https://leetcode.cn/problems/daily-leads-and-partners/)

è¡¨ï¼š`DailySales`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| date_id     | date    |
| make_name   | varchar |
| lead_id     | int     |
| partner_id  | int     |
+-------------+---------+
è¯¥è¡¨æ²¡æœ‰ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚å®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚
è¯¥è¡¨åŒ…å«æ—¥æœŸã€äº§å“çš„åç§°ï¼Œä»¥åŠå”®ç»™çš„é¢†å¯¼å’Œåˆä¼™äººçš„ç¼–å·ã€‚
åç§°åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚
```



å¯¹äºæ¯ä¸€ä¸ª `date_id` å’Œ `make_name`ï¼Œæ‰¾å‡º **ä¸åŒ** çš„ `lead_id` ä»¥åŠ **ä¸åŒ** çš„ `partner_id` çš„æ•°é‡ã€‚

æŒ‰ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼š
DailySales è¡¨ï¼š
+-----------+-----------+---------+------------+
| date_id   | make_name | lead_id | partner_id |
+-----------+-----------+---------+------------+
| 2020-12-8 | toyota    | 0       | 1          |
| 2020-12-8 | toyota    | 1       | 0          |
| 2020-12-8 | toyota    | 1       | 2          |
| 2020-12-7 | toyota    | 0       | 2          |
| 2020-12-7 | toyota    | 0       | 1          |
| 2020-12-8 | honda     | 1       | 2          |
| 2020-12-8 | honda     | 2       | 1          |
| 2020-12-7 | honda     | 0       | 1          |
| 2020-12-7 | honda     | 1       | 2          |
| 2020-12-7 | honda     | 2       | 1          |
+-----------+-----------+---------+------------+
è¾“å‡ºï¼š
+-----------+-----------+--------------+-----------------+
| date_id   | make_name | unique_leads | unique_partners |
+-----------+-----------+--------------+-----------------+
| 2020-12-8 | toyota    | 2            | 3               |
| 2020-12-7 | toyota    | 1            | 2               |
| 2020-12-8 | honda     | 2            | 2               |
| 2020-12-7 | honda     | 3            | 2               |
+-----------+-----------+--------------+-----------------+
è§£é‡Šï¼š
åœ¨ 2020-12-8ï¼Œä¸°ç”°ï¼ˆtoyotaï¼‰æœ‰é¢†å¯¼è€… = [0, 1] å’Œåˆä¼™äºº = [0, 1, 2] ï¼ŒåŒæ—¶æœ¬ç”°ï¼ˆhondaï¼‰æœ‰é¢†å¯¼è€… = [1, 2] å’Œåˆä¼™äºº = [1, 2]ã€‚
åœ¨ 2020-12-7ï¼Œä¸°ç”°ï¼ˆtoyotaï¼‰æœ‰é¢†å¯¼è€… = [0] å’Œåˆä¼™äºº = [1, 2] ï¼ŒåŒæ—¶æœ¬ç”°ï¼ˆhondaï¼‰æœ‰é¢†å¯¼è€… = [0, 1, 2] å’Œåˆä¼™äºº = [1, 2]ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'date_id': ['2020-12-8', '2020-12-8', '2020-12-8', '2020-12-7', '2020-12-7', '2020-12-8', '2020-12-8', '2020-12-7', '2020-12-7', '2020-12-7'],
        'make_name': ['toyota', 'toyota', 'toyota', 'toyota', 'toyota', 'honda', 'honda', 'honda', 'honda', 'honda'],
        'lead_id': [0, 1, 1, 0, 0, 1, 2, 0, 1, 2],
        'partner_id': [1, 0, 2, 2, 1, 2, 1, 1, 2, 1]}
```

---

é€šè¿‡è¿™é“é¢˜å¯ä»¥é¢†ç•¥aggå‡½æ•°çš„å¼ºå¤§ï¼š

```python
import pandas as pd

def daily_leads_and_partners(daily_sales: pd.DataFrame) -> pd.DataFrame:
    return daily_sales.groupby(['date_id', 'make_name']).agg(
        unique_leads=('lead_id', 'nunique'),
        unique_partners=('partner_id', 'nunique')
    ).reset_index()
```



# æ•°æ®åˆå¹¶

## 1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”

[1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”](https://leetcode.cn/problems/actors-and-directors-who-cooperated-at-least-three-times/)

`ActorDirector` è¡¨ï¼š

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| actor_id    | int     |
| director_id | int     |
| timestamp   | int     |
+-------------+---------+
timestamp æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—).
```



ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºåˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ `(actor_id, director_id)`



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
ActorDirector è¡¨ï¼š
+-------------+-------------+-------------+
| actor_id    | director_id | timestamp   |
+-------------+-------------+-------------+
| 1           | 1           | 0           |
| 1           | 1           | 1           |
| 1           | 1           | 2           |
| 1           | 2           | 3           |
| 1           | 2           | 4           |
| 2           | 1           | 5           |
| 2           | 1           | 6           |
+-------------+-------------+-------------+
è¾“å‡ºï¼š
+-------------+-------------+
| actor_id    | director_id |
+-------------+-------------+
| 1           | 1           |
+-------------+-------------+
è§£é‡Šï¼š
å”¯ä¸€çš„ id å¯¹æ˜¯ (1, 1)ï¼Œä»–ä»¬æ°å¥½åˆä½œäº† 3 æ¬¡ã€‚
```

---

æµ‹è¯•æ•°æ®ï¼š

```python
data = {'actor_id': [1, 1, 1, 1, 1, 2, 2],
        'director_id': [1, 1, 1, 2, 2, 1, 1],
        'timestamp': [0, 1, 2, 3, 4, 5, 6]}
```

----

è¿™é¢˜æ¯”è¾ƒç®€å•ï¼Œæˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def actors_and_directors(actor_director: pd.DataFrame) -> pd.DataFrame:
    grouped = actor_director.groupby(['actor_id', 'director_id'])['timestamp'].count().reset_index()
    return grouped[grouped['timestamp'] >=3][['actor_id', 'director_id']]
```

----

## 1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID

[1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID](https://leetcode.cn/problems/replace-employee-id-with-the-unique-identifier/)

`Employees` è¡¨ï¼š

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| name          | varchar |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨äº†æŸå…¬å¸å…¶ä¸­ä¸€ä½å‘˜å·¥çš„åå­—å’Œ ID ã€‚
```



`EmployeeUNI` è¡¨ï¼š

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| unique_id     | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œ(id, unique_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†è¯¥å…¬å¸æŸä½å‘˜å·¥çš„ ID å’Œä»–çš„å”¯ä¸€æ ‡è¯†ç ï¼ˆunique IDï¼‰ã€‚
```



å±•ç¤ºæ¯ä½ç”¨æˆ·çš„ **å”¯ä¸€æ ‡è¯†ç ï¼ˆunique ID ï¼‰**ï¼›å¦‚æœæŸä½å‘˜å·¥æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç ï¼Œä½¿ç”¨ null å¡«å……å³å¯ã€‚

ä½ å¯ä»¥ä»¥ **ä»»æ„** é¡ºåºè¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Employees è¡¨:
+----+----------+
| id | name     |
+----+----------+
| 1  | Alice    |
| 7  | Bob      |
| 11 | Meir     |
| 90 | Winston  |
| 3  | Jonathan |
+----+----------+
EmployeeUNI è¡¨:
+----+-----------+
| id | unique_id |
+----+-----------+
| 3  | 1         |
| 11 | 2         |
| 90 | 3         |
+----+-----------+
è¾“å‡ºï¼š
+-----------+----------+
| unique_id | name     |
+-----------+----------+
| null      | Alice    |
| null      | Bob      |
| 2         | Meir     |
| 3         | Winston  |
| 1         | Jonathan |
+-----------+----------+
è§£é‡Šï¼š
Alice and Bob æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç , å› æ­¤æˆ‘ä»¬ä½¿ç”¨ null æ›¿ä»£ã€‚
Meir çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 2 ã€‚
Winston çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 3 ã€‚
Jonathan å”¯ä¸€æ ‡è¯†ç æ˜¯ 1 ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
{'id': [1, 7, 11, 90, 3],
                  'name': ['Alice', 'Bob', 'Meir', 'Winston', 'Jonathan']}

{'id': [3, 11, 90],
                     'unique_id': [1, 2, 3]}
```

---

è¿™é¢˜éå¸¸ç®€å•å•Šï¼Œä¸€ä¸ªmergeæå®šï¼ˆæ³¨æ„howå€¼æ˜¯leftï¼‰

```python
import pandas as pd

def replace_employee_id(employees: pd.DataFrame, employee_uni: pd.DataFrame) -> pd.DataFrame:
    return pd.merge(employees, employee_uni, how='left')[['unique_id', 'name']]

```





## 1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°

[1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°](https://leetcode.cn/problems/students-and-examinations/)

å­¦ç”Ÿè¡¨: `Students`

```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| student_id    | int     |
| student_name  | varchar |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œä¸»é”®ä¸º student_idï¼ˆå­¦ç”ŸIDï¼‰ã€‚
è¯¥è¡¨å†…çš„æ¯ä¸€è¡Œéƒ½è®°å½•æœ‰å­¦æ ¡ä¸€åå­¦ç”Ÿçš„ä¿¡æ¯ã€‚
```



ç§‘ç›®è¡¨: `Subjects`

```
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| subject_name | varchar |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œä¸»é”®ä¸º subject_nameï¼ˆç§‘ç›®åç§°ï¼‰ã€‚
æ¯ä¸€è¡Œè®°å½•å­¦æ ¡çš„ä¸€é—¨ç§‘ç›®åç§°ã€‚
```



è€ƒè¯•è¡¨: `Examinations`

```
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| student_id   | int     |
| subject_name | varchar |
+--------------+---------+
è¿™ä¸ªè¡¨å¯èƒ½åŒ…å«é‡å¤æ•°æ®ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨ SQL ä¸­ï¼Œè¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼‰ã€‚
å­¦ç”Ÿè¡¨é‡Œçš„ä¸€ä¸ªå­¦ç”Ÿä¿®è¯»ç§‘ç›®è¡¨é‡Œçš„æ¯ä¸€é—¨ç§‘ç›®ã€‚
è¿™å¼ è€ƒè¯•è¡¨çš„æ¯ä¸€è¡Œè®°å½•å°±è¡¨ç¤ºå­¦ç”Ÿè¡¨é‡Œçš„æŸä¸ªå­¦ç”Ÿå‚åŠ äº†ä¸€æ¬¡ç§‘ç›®è¡¨é‡ŒæŸé—¨ç§‘ç›®çš„æµ‹è¯•ã€‚
```



æŸ¥è¯¢å‡ºæ¯ä¸ªå­¦ç”Ÿå‚åŠ æ¯ä¸€é—¨ç§‘ç›®æµ‹è¯•çš„æ¬¡æ•°ï¼Œç»“æœæŒ‰ `student_id` å’Œ `subject_name` æ’åºã€‚

æŸ¥è¯¢ç»“æ„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Students table:
+------------+--------------+
| student_id | student_name |
+------------+--------------+
| 1          | Alice        |
| 2          | Bob          |
| 13         | John         |
| 6          | Alex         |
+------------+--------------+
Subjects table:
+--------------+
| subject_name |
+--------------+
| Math         |
| Physics      |
| Programming  |
+--------------+
Examinations table:
+------------+--------------+
| student_id | subject_name |
+------------+--------------+
| 1          | Math         |
| 1          | Physics      |
| 1          | Programming  |
| 2          | Programming  |
| 1          | Physics      |
| 1          | Math         |
| 13         | Math         |
| 13         | Programming  |
| 13         | Physics      |
| 2          | Math         |
| 1          | Math         |
+------------+--------------+
è¾“å‡ºï¼š
+------------+--------------+--------------+----------------+
| student_id | student_name | subject_name | attended_exams |
+------------+--------------+--------------+----------------+
| 1          | Alice        | Math         | 3              |
| 1          | Alice        | Physics      | 2              |
| 1          | Alice        | Programming  | 1              |
| 2          | Bob          | Math         | 1              |
| 2          | Bob          | Physics      | 0              |
| 2          | Bob          | Programming  | 1              |
| 6          | Alex         | Math         | 0              |
| 6          | Alex         | Physics      | 0              |
| 6          | Alex         | Programming  | 0              |
| 13         | John         | Math         | 1              |
| 13         | John         | Physics      | 1              |
| 13         | John         | Programming  | 1              |
+------------+--------------+--------------+----------------+
è§£é‡Šï¼š
ç»“æœè¡¨éœ€åŒ…å«æ‰€æœ‰å­¦ç”Ÿå’Œæ‰€æœ‰ç§‘ç›®ï¼ˆå³ä¾¿æµ‹è¯•æ¬¡æ•°ä¸º0ï¼‰ï¼š
Alice å‚åŠ äº† 3 æ¬¡æ•°å­¦æµ‹è¯•, 2 æ¬¡ç‰©ç†æµ‹è¯•ï¼Œä»¥åŠ 1 æ¬¡ç¼–ç¨‹æµ‹è¯•ï¼›
Bob å‚åŠ äº† 1 æ¬¡æ•°å­¦æµ‹è¯•, 1 æ¬¡ç¼–ç¨‹æµ‹è¯•ï¼Œæ²¡æœ‰å‚åŠ ç‰©ç†æµ‹è¯•ï¼›
Alex å•¥æµ‹è¯•éƒ½æ²¡å‚åŠ ï¼›
John  å‚åŠ äº†æ•°å­¦ã€ç‰©ç†ã€ç¼–ç¨‹æµ‹è¯•å„ 1 æ¬¡ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
students_data = {'student_id': [1, 2, 13, 6],
                 'student_name': ['Alice', 'Bob', 'John', 'Alex']}
subjects_data = {'subject_name': ['Math', 'Physics', 'Programming']}
examinations_data = {'student_id': [1, 1, 1, 2, 1, 1, 13, 13, 13, 2, 1],
                     'subject_name': ['Math', 'Physics', 'Programming', 'Programming', 'Physics', 'Math', 'Math', 'Programming', 'Physics', 'Math', 'Math']}



students = pd.DataFrame(students_data)
subjects = pd.DataFrame(subjects_data)
examinations = pd.DataFrame(examinations_data)
display(students)
display(subjects)
display(examinations)
```

----

è¦å®Œæˆè¿™é“é¢˜è¦é¦–å…ˆæŒæ¡**ç¬›å¡å°”ç§¯**ï¼šè®¡ç®—æ‰€æœ‰å¯èƒ½çš„å…ƒç´ å¯¹çš„ä¹˜ç§¯

```python
students['key'] = 1
subjects['key'] = 1

pd.merge(students, subjects, on='key')
```

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250302221843742.png" alt="image-20250302221843742" style="zoom:50%;" />



è¿™æ ·å°±æœ‰äº†è¾“å‡ºçš„é›å½¢ã€‚

----

è¿™é“é¢˜ï¼Œè¿˜æœ‰å¾ˆå¤šå°ç»†èŠ‚è¦æ³¨æ„ã€‚å¯ä»¥è¾¹å†™è¾¹æµ‹è¯•ï¼Œæœ‰äº†ç»“æœæäº¤å‘ç°ä¸é€šè¿‡ ä¹Ÿå¯ä»¥å†è°ƒè¯•ã€‚

```python
import pandas as pd

def students_and_examinations(students: pd.DataFrame, subjects: pd.DataFrame, examinations: pd.DataFrame) -> pd.DataFrame:
    students['key'] = 1
    subjects['key'] = 1
    res = pd.merge(students, subjects, on='key')
    count_examinations = examinations.groupby(['student_id', 'subject_name']).size().reset_index(name='attended_exams')
    res = pd.merge(res, count_examinations, on=['student_id', 'subject_name'], how='left')
    res['attended_exams'] = res['attended_exams'].fillna(0)
    res = res[['student_id', 'student_name', 'subject_name', 'attended_exams']]
    return res.sort_values(by=['student_id', 'subject_name'])
```

æ³¨ï¼š

1.size()å’Œcount()

2.æŸä¸€åˆ—çš„å€¼ï¼ˆå«NaNï¼‰èµ‹å€¼ï¼š`res['attended_exams'] = res['attended_exams'].fillna(0)`ï¼Œ å› ä¸ºåå­—è¿™ä¸€åˆ—å¯èƒ½å‡ºç°nullï¼Œä¸å¯è¢«è¦†ç›–ï¼Œæ‰€ä»¥åªå¯¹ä¸€åˆ—è¿›è¡Œnançš„å¡«å……ã€‚

3.`reset_index(name='attended_exams')`ï¼Œgroupbyåç»Ÿè®¡çš„ç»“æœèµ‹å€¼ç»™æŸä¸€åˆ—ï¼Œç»™é‚£ä¸€åˆ—å–ä¸ªæ–°åå­—

4.ç¬›å¡å°”ç§¯ï¼š

```python
    students['key'] = 1
    subjects['key'] = 1
    res = pd.merge(students, subjects, on='key')
```

----



## 570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†

[570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†](https://leetcode.cn/problems/managers-with-at-least-5-direct-reports/)

è¡¨: `Employee`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
| department  | varchar |
| managerId   | int     |
+-------------+---------+
id æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºé›‡å‘˜çš„åå­—ã€ä»–ä»¬çš„éƒ¨é—¨å’Œä»–ä»¬çš„ç»ç†çš„idã€‚
å¦‚æœmanagerIdä¸ºç©ºï¼Œåˆ™è¯¥å‘˜å·¥æ²¡æœ‰ç»ç†ã€‚
æ²¡æœ‰å‘˜å·¥ä¼šæˆä¸ºè‡ªå·±çš„ç®¡ç†è€…ã€‚
```



ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºè‡³å°‘æœ‰**äº”ä¸ªç›´æ¥ä¸‹å±**çš„ç»ç†ã€‚

ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1:**

```
è¾“å…¥: 
Employee è¡¨:
+-----+-------+------------+-----------+
| id  | name  | department | managerId |
+-----+-------+------------+-----------+
| 101 | John  | A          | Null      |
| 102 | Dan   | A          | 101       |
| 103 | James | A          | 101       |
| 104 | Amy   | A          | 101       |
| 105 | Anne  | A          | 101       |
| 106 | Ron   | B          | 101       |
+-----+-------+------------+-----------+
è¾“å‡º: 
+------+
| name |
+------+
| John |
+------+
```

----

æµ‹è¯•æ•°æ®:

```python
employee_data = {
    'id': [101, 102, 103, 104, 105, 106],
    'name': ['John', 'Dan', 'James', 'Amy', 'Anne', 'Ron'],
    'department': ['A', 'A', 'A', 'A', 'A', 'B'],
    'managerId': [None, 101, 101, 101, 101, 101]  # ä½¿ç”¨ np.nan è¡¨ç¤º Null
}

employee = pd.DataFrame(employee_data)
display(employee)
```

----

æˆ‘å†™çš„ï¼š

```python
import pandas as pd

def find_managers(employee: pd.DataFrame) -> pd.DataFrame:
    count_managerId = employee.groupby('managerId').size().reset_index(name='count_e').rename(columns={'managerId':'id'})
    res = pd.merge(employee, count_managerId, on='id', how='left')
    return res[res['count_e'] >= 5][['name']]
```



## 607. é”€å”®å‘˜

[607. é”€å”®å‘˜](https://leetcode.cn/problems/sales-person/)

è¡¨: `SalesPerson`

```
+-----------------+---------+
| Column Name     | Type    |
+-----------------+---------+
| sales_id        | int     |
| name            | varchar |
| salary          | int     |
| commission_rate | int     |
| hire_date       | date    |
+-----------------+---------+
sales_id æ˜¯è¯¥è¡¨çš„ä¸»é”®åˆ—(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½æ˜¾ç¤ºäº†é”€å”®äººå‘˜çš„å§“åå’Œ ID ï¼Œä»¥åŠä»–ä»¬çš„å·¥èµ„ã€ä½£é‡‘ç‡å’Œé›‡ä½£æ—¥æœŸã€‚
```



è¡¨: `Company`

```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| com_id      | int     |
| name        | varchar |
| city        | varchar |
+-------------+---------+
com_id æ˜¯è¯¥è¡¨çš„ä¸»é”®åˆ—(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå…¬å¸çš„åç§°å’Œ ID ï¼Œä»¥åŠå…¬å¸æ‰€åœ¨çš„åŸå¸‚ã€‚
```



è¡¨: `Orders`

```
+-------------+------+
| Column Name | Type |
+-------------+------+
| order_id    | int  |
| order_date  | date |
| com_id      | int  |
| sales_id    | int  |
| amount      | int  |
+-------------+------+
order_id æ˜¯è¯¥è¡¨çš„ä¸»é”®åˆ—(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
com_id æ˜¯ Company è¡¨ä¸­ com_id çš„å¤–é”®ï¼ˆreference åˆ—ï¼‰ã€‚
sales_id æ˜¯æ¥è‡ªé”€å”®å‘˜è¡¨ sales_id çš„å¤–é”®ï¼ˆreference åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªè®¢å•çš„ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬å…¬å¸çš„ ID ã€é”€å”®äººå‘˜çš„ ID ã€è®¢å•æ—¥æœŸå’Œæ”¯ä»˜çš„é‡‘é¢ã€‚
```



ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ²¡æœ‰ä»»ä½•ä¸åä¸º **â€œREDâ€** çš„å…¬å¸ç›¸å…³çš„è®¢å•çš„æ‰€æœ‰é”€å”®äººå‘˜çš„å§“åã€‚

ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
SalesPerson è¡¨:
+----------+------+--------+-----------------+------------+
| sales_id | name | salary | commission_rate | hire_date  |
+----------+------+--------+-----------------+------------+
| 1        | John | 100000 | 6               | 4/1/2006   |
| 2        | Amy  | 12000  | 5               | 5/1/2010   |
| 3        | Mark | 65000  | 12              | 12/25/2008 |
| 4        | Pam  | 25000  | 25              | 1/1/2005   |
| 5        | Alex | 5000   | 10              | 2/3/2007   |
+----------+------+--------+-----------------+------------+
Company è¡¨:
+--------+--------+----------+
| com_id | name   | city     |
+--------+--------+----------+
| 1      | RED    | Boston   |
| 2      | ORANGE | New York |
| 3      | YELLOW | Boston   |
| 4      | GREEN  | Austin   |
+--------+--------+----------+
Orders è¡¨:
+----------+------------+--------+----------+--------+
| order_id | order_date | com_id | sales_id | amount |
+----------+------------+--------+----------+--------+
| 1        | 1/1/2014   | 3      | 4        | 10000  |
| 2        | 2/1/2014   | 4      | 5        | 5000   |
| 3        | 3/1/2014   | 1      | 1        | 50000  |
| 4        | 4/1/2014   | 1      | 4        | 25000  |
+----------+------------+--------+----------+--------+
è¾“å‡ºï¼š
+------+
| name |
+------+
| Amy  |
| Mark |
| Alex |
+------+
è§£é‡Šï¼š
æ ¹æ®è¡¨ orders ä¸­çš„è®¢å• '3' å’Œ '4' ï¼Œå®¹æ˜“çœ‹å‡ºåªæœ‰ 'John' å’Œ 'Pam' ä¸¤ä¸ªé”€å”®å‘˜æ›¾ç»å‘å…¬å¸ 'RED' é”€å”®è¿‡ã€‚
æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¾“å‡ºè¡¨ salesperson ä¸­æ‰€æœ‰å…¶ä»–äººçš„åå­—ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python
salesperson_data = {
    'sales_id': [1, 2, 3, 4, 5],
    'name': ['John', 'Amy', 'Mark', 'Pam', 'Alex'],
    'salary': [100000, 12000, 65000, 25000, 5000],
    'commission_rate': [6, 5, 12, 25, 10],
    'hire_date': ['4/1/2006', '5/1/2010', '12/25/2008', '1/1/2005', '2/3/2007']
}

company_data = {
    'com_id': [1, 2, 3, 4],
    'name': ['RED', 'ORANGE', 'YELLOW', 'GREEN'],
    'city': ['Boston', 'New York', 'Boston', 'Austin']
}

orders_data = {
    'order_id': [1, 2, 3, 4],
    'order_date': ['1/1/2014', '2/1/2014', '3/1/2014', '4/1/2014'],
    'com_id': [3, 4, 1, 1],
    'sales_id': [4, 5, 1, 4],
    'amount': [10000, 5000, 50000, 25000]
}


sales_person = pd.DataFrame(salesperson_data)
company = pd.DataFrame(company_data)
orders = pd.DataFrame(orders_data)
display(sales_person)
display(company)
display(orders)
```

---

æœ¬æ¥éƒ½å†™å®Œäº†ï¼Œè·‘â€œæäº¤â€çš„æ—¶å€™å‡ºç°äº†æ²¡æœ‰REDå…¬å¸çš„æƒ…å†µï¼Œæ‰€ä»¥å¤šåŠ ä¸€å±‚åˆ¤æ–­(ç›´æ¥è¿”å›æ‰€æœ‰çš„é”€å”®äººå‘˜å§“å)ï¼š

```python
import pandas as pd

def sales_person(sales_person: pd.DataFrame, company: pd.DataFrame, orders: pd.DataFrame) -> pd.DataFrame:
    if (company['name'] == 'RED').any():
        red_com_id = company['com_id'][company['name'] == 'RED'].values[0]
        return sales_person[~sales_person['sales_id'].isin(orders["sales_id"][orders['com_id'] == red_com_id])][['name']]
    else:
        return sales_person[['name']]
```

# æµ‹éªŒé¢˜

## 2041. é¢è¯•ä¸­è¢«å½•å–çš„å€™é€‰äºº

[2041. é¢è¯•ä¸­è¢«å½•å–çš„å€™é€‰äºº](https://leetcode.cn/problems/accepted-candidates-from-the-interviews/)

è¡¨ï¼š`Candidates`

```
+--------------+----------+
| Column Name  | Type     |
+--------------+----------+
| candidate_id | int      |
| name         | varchar  |
| years_of_exp | int      |
| interview_id | int      |
+--------------+----------+
candidate_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå€™é€‰äººçš„å§“åã€å·¥ä½œå¹´é™ä»¥åŠé¢è¯• ID ã€‚
```



è¡¨ï¼š`Rounds`

```
+--------------+------+
| Column Name  | Type |
+--------------+------+
| interview_id | int  |
| round_id     | int  |
| score        | int  |
+--------------+------+
(interview_id, round_idï¼‰æ˜¯æœ¬è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚
æœ¬è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºä¸€è½®é¢è¯•çš„åˆ†æ•°
```



ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡º **è‡³å°‘æœ‰ä¸¤å¹´** å·¥ä½œç»éªŒã€ä¸”é¢è¯•åˆ†æ•°ä¹‹å’Œ **ä¸¥æ ¼å¤§äº `15`** çš„å€™é€‰äººçš„ ID **ã€‚**

å¯ä»¥ä»¥ **ä»»ä½•é¡ºåº** è¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
Candidates table:
+--------------+---------+--------------+--------------+
| candidate_id | name    | years_of_exp | interview_id |
+--------------+---------+--------------+--------------+
| 11           | Atticus | 1            | 101          |
| 9            | Ruben   | 6            | 104          |
| 6            | Aliza   | 10           | 109          |
| 8            | Alfredo | 0            | 107          |
+--------------+---------+--------------+--------------+
Rounds table:
+--------------+----------+-------+
| interview_id | round_id | score |
+--------------+----------+-------+
| 109          | 3        | 4     |
| 101          | 2        | 8     |
| 109          | 4        | 1     |
| 107          | 1        | 3     |
| 104          | 3        | 6     |
| 109          | 1        | 4     |
| 104          | 4        | 7     |
| 104          | 1        | 2     |
| 109          | 2        | 1     |
| 104          | 2        | 7     |
| 107          | 2        | 3     |
| 101          | 1        | 8     |
+--------------+----------+-------+
è¾“å‡ºï¼š
+--------------+
| candidate_id |
+--------------+
| 9            |
+--------------+
è§£é‡Šï¼š
- å€™é€‰äºº 11 ï¼šæ€»åˆ†æ˜¯ 16 ï¼Œ1 å¹´å·¥ä½œç»éªŒã€‚ç”±äºå·¥ä½œå¹´é™ï¼Œä¸åˆ—å…¥ç»“æœè¡¨ã€‚
- å€™é€‰äºº 9 ï¼šæ€»åˆ†æ˜¯ 22 ï¼Œ6 å¹´å·¥ä½œç»éªŒã€‚åˆ—å…¥ç»“æœè¡¨ã€‚
- å€™é€‰äºº 6 ï¼šæ€»åˆ†æ˜¯ 10 ï¼Œ10 å¹´å·¥ä½œç»éªŒã€‚ç”±äºåˆ†æ•°ä¸è¶³ï¼Œä¸åˆ—å…¥ç»“æœè¡¨ã€‚
- å€™é€‰äºº 8 ï¼šæ€»åˆ†æ˜¯ 6 ï¼Œ0 å¹´å·¥ä½œç»éªŒã€‚ç”±äºå·¥ä½œå¹´é™å’Œåˆ†æ•°ï¼Œä¸åˆ—å…¥ç»“æœè¡¨ã€‚
```

----

æµ‹è¯•æ•°æ®ï¼š

```python

```

----

æˆ‘å†™çš„ç­”æ¡ˆï¼š

```python
import pandas as pd

def accepted_candidates(candidates: pd.DataFrame, rounds: pd.DataFrame) -> pd.DataFrame:
    merged = pd.merge(candidates, rounds, how='right')
    sum_ = merged.groupby('candidate_id')['score'].sum().reset_index()
    return candidates[(candidates['candidate_id'].isin(sum_['candidate_id'][sum_['score'] > 15])) & (candidates['years_of_exp'] >= 2)][['candidate_id']]

```

----

ä»¥ä¸Šå°±å®Œæˆäº†æ•´ä¸ªåˆ·é¢˜è®¡åˆ’ã€‚

<img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250303114303211.png" alt="image-20250303114303211" style="zoom:50%;" />

