<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="这里是 Hilda 的个人博客，与你一起发现更大的世界 | 要做一个有 swag 的程序员">
    <meta name="keywords" content="Hilda">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="【体系学习007】加强堆 - Hilda的博客 | Your genius girlfriend's blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="

">
    
    <meta property="article:published_time" content=" 2025-09-24T00:00:00Z">
    
    
    <meta property="article:author" content="Hilda">
    
    
    <meta property="article:tag" content="算法">
    
    
    <meta property="og:image" content="https://kirsten-1.github.io">
    <meta property="og:url" content="https://kirsten-1.github.io/2025/09/24/%E7%AE%97%E6%B3%95%E4%BD%93%E7%B3%BB%E5%AD%A6%E4%B9%A0-7%E5%8A%A0%E5%BC%BA%E5%A0%86/">
    <meta property="og:site_name" content="Hilda的博客 | Your genius girlfriend's blog">

    <title>【体系学习007】加强堆 - Hilda的博客 | Your genius girlfriend's blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://kirsten-1.github.io/2025/09/24/%E7%AE%97%E6%B3%95%E4%BD%93%E7%B3%BB%E5%AD%A6%E4%B9%A0-7%E5%8A%A0%E5%BC%BA%E5%A0%86/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Hilda</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-2015.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/post-bg-2015.jpg');
        background: ;
    }

    
</style>




<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=%E7%AE%97%E6%B3%95" title="算法">算法</a>
                        
                    </div>
                    <h1>【体系学习007】加强堆</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by Hilda on September 24, 2025</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG">
</script>

<h1 id="1通过规模和指令条数来推测算法复杂度">1.通过规模和指令条数来推测算法复杂度</h1>

<p>在线评测系统需要一个公平的环境来评估不同语言的解法。考虑到 Java 特有的启动和 JIT 开销，如果将所有语言的时间限制都设为 1-2 秒（C/C++通常是这样），那么一些本应通过的 Java 代码可能会因为这些“系统开销”而超时。</p>

<p>为了弥补这种天生的劣势，评测系统会为 Java 这类需要虚拟机的语言<strong>提供更宽裕的时间限制</strong>（比如2-4秒），以确保竞赛的公平性。这个时间差通常是根据经验值和大量测试得出的，旨在让参赛者能专注于算法本身的效率，而不是语言特性带来的额外负担。</p>

<p>考虑这样的已知条件：</p>

<ul>
  <li>评测系统的大致时间限制：<strong>1秒</strong>。</li>
  <li>1秒大致能执行的指令数：<strong>\(10^8\) 条</strong>。</li>
  <li>输入数据的规模（比如数组大小）：<strong>\(N=10^3\)</strong>。</li>
</ul>

<p>现在一道算法题的要求是：找到一个<strong>算法复杂度</strong>（比如 \(O(N^2)\)、\(O(NlogN)\)、\(O(N^3)\) 等），使得当 \(N=10^3\) 时，总运算量<strong>不超过</strong> \(10^8\)。</p>

<p>那么大概率需找到一个<strong>\(O(N^2)\) 或更优（比如 O(NlogN)）</strong>的解法，那么这个算法大概率能在规定时间内通过。(显然O(\(N^3\))不太行)</p>

<p>总而言之，这种通过<strong>规模反推复杂度</strong>的方法，是算法竞赛中非常实用的一个技巧，它能帮助你快速筛选出可行的解法，避免在错误的思路上浪费时间。</p>

<h1 id="2最大线段重合问题用堆的实现">2.最大线段重合问题（用堆的实现）</h1>

<p>【思路】：任何重合区域的左边界一定是某个线段的左边界，所以考察每个线段的左边界，到底有多少重合线段。</p>

<p>【解法】：</p>

<ul>
  <li>首先，对所有线段按照它们的左边界进行升序排序。</li>
  <li>
    <p>使用最小堆跟踪结束点： 创建一个最小堆 heap，用于存放当前所有正在进行的线段的结束点。</p>
  </li>
  <li>
    <p>遍历线段：  检查堆顶元素 heap.peek()，如果堆顶元素的结束点小于或等于当前线段的起始点<code class="language-plaintext highlighter-rouge"> lines[i][0]</code>，说明该线段已经结束了，不再与当前线段重叠。将它从堆中移除 (poll())。不断重复此操作，直到堆顶的结束点晚于当前线段的起始点。</p>
  </li>
  <li>
    <p>添加新的线段： 将当前线段的结束点<code class="language-plaintext highlighter-rouge"> lines[i][1] </code>添加到堆中。</p>
  </li>
  <li>更新最大重叠数： 在每一步操作后，堆中剩余的元素数量就是当前时间点上正在进行的线段数量。用一个变量 ans 记录下堆的最大容量 heap.size()，这个值就是最多同时重叠的线段数量。</li>
</ul>

<p>【时间复杂度】 O(NlogN)，主要是由排序和堆的操作决定的。</p>

<p>【额外空间复杂度】 <strong>O(N)</strong>，Java 的 <code class="language-plaintext highlighter-rouge">Arrays.sort()</code> 方法在对对象数组进行排序时，通常需要一个大小为 O(N) 的额外空间作为辅助数组；另外PriorityQueue，在最坏的情况下，所有线段都可能在某一时刻重叠。此时，最小堆需要存储所有 N 个线段的结束点，因此其空间复杂度是 O(N)。</p>

<p>试题链接(ACM风格，线段重合)：https://www.nowcoder.com/practice/1ae8d0b6bb4e4bcdbf64ec491f63fc37</p>

<p>解法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="c1">// 注意类名必须为 Main, 不要有任何 package xxx 信息</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
        <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
        <span class="nc">StreamTokenizer</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamTokenizer</span><span class="o">(</span><span class="n">br</span><span class="o">);</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">));</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">nextToken</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">StreamTokenizer</span><span class="o">.</span><span class="na">TT_EOF</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">in</span><span class="o">.</span><span class="na">nval</span><span class="o">;</span>
            <span class="n">in</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span>
            <span class="kt">int</span><span class="o">[][]</span> <span class="n">lines</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="mi">2</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">in</span><span class="o">.</span><span class="na">nval</span><span class="o">;</span>
                <span class="n">in</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span>
                <span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">in</span><span class="o">.</span><span class="na">nval</span><span class="o">;</span>
                <span class="n">in</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">lines</span><span class="o">);</span>
            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ans</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span><span class="o">[][]</span> <span class="n">lines</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="nc">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">lines</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)-&gt;(</span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">]-</span><span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
        <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">heap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityQueue</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">heap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">heap</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">])</span> <span class="o">{</span>
                <span class="n">heap</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]);</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">ans</span><span class="o">,</span> <span class="n">heap</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="3手动改写堆加强堆">3.手动改写堆(加强堆)</h1>

<h2 id="31原理">3.1原理</h2>

<p>系统提供的堆无法做到的事情：
1）已经入堆的元素，如果参与排序的指标方法变化，
系统提供的堆无法做到时间复杂度O(logN)调整！都是O(N)的调整！
2）系统提供的堆只能弹出堆顶，做不到自由删除任何一个堆中的元素，
或者说，无法在时间复杂度O(logN)内完成！一定会高于O(logN)
根本原因：无反向索引表</p>

<p>举个例子：假设你有一个对象<code class="language-plaintext highlighter-rouge">Student</code>，它根据<code class="language-plaintext highlighter-rouge">score</code>属性值入堆。当你改变了某个学生的<code class="language-plaintext highlighter-rouge">score</code>后，<code class="language-plaintext highlighter-rouge">PriorityQueue</code>并不知道这个学生在堆的哪个位置。为了找到它，你必须遍历整个堆，这需要O(N)的时间。找到后，你才能将其删除（O(N)）并重新插入（O(logN)），总时间复杂度为O(N)。</p>

<p>如果你需要频繁地对堆中元素的排序指标进行更新，并希望保持O(logN)的性能，那么你需要自己实现一个带<strong>反向索引表</strong>的数据结构。例如，可以使用一个<code class="language-plaintext highlighter-rouge">HashMap</code>来存储<code class="language-plaintext highlighter-rouge">元素 -&gt; 数组索引</code>的映射关系。</p>

<p>Java不直接提供一个内置的、带反向索引表的堆（如<code class="language-plaintext highlighter-rouge">java.util.PriorityQueue</code>），主要是基于以下几个原因：</p>

<p><strong>1.设计哲学与通用性</strong></p>

<p><code class="language-plaintext highlighter-rouge">PriorityQueue</code>的设计目标是提供一个基础、高效的<strong>优先级队列</strong>实现。在绝大多数应用场景中，优先级队列的核心操作就是<strong>插入元素</strong>（<code class="language-plaintext highlighter-rouge">add</code>）和<strong>移除最高优先级元素</strong>（<code class="language-plaintext highlighter-rouge">poll</code>）。对于这些基本操作，<code class="language-plaintext highlighter-rouge">PriorityQueue</code>已经通过二叉堆结构做到了最优的时间复杂度（O(logN)）。</p>

<p>加入反向索引表（如<code class="language-plaintext highlighter-rouge">HashMap</code>）会带来额外的开销，包括：</p>

<ul>
  <li><strong>内存开销</strong>：每个元素都需要在<code class="language-plaintext highlighter-rouge">HashMap</code>中存储一份额外的引用和哈希值，这会增加堆的内存占用。</li>
  <li><strong>性能开销</strong>：每次插入、删除或更新元素时，不仅要维护堆结构，还要同步更新<code class="language-plaintext highlighter-rouge">HashMap</code>中的映射关系。虽然这些操作的理论时间复杂度不变，但在实际运行中，哈希表的维护（如哈希计算、冲突处理）会比单纯的数组操作慢。</li>
</ul>

<p>标准库的设计者倾向于提供基础、高效且通用的数据结构。如果需要更复杂的功能（比如支持任意元素的高效删除或更新），开发者可以根据自己的需求，通过组合现有数据结构（如<code class="language-plaintext highlighter-rouge">PriorityQueue</code>和<code class="language-plaintext highlighter-rouge">HashMap</code>）来构建。这种<strong>“组合优于继承”</strong>的设计思想，是Java乃至许多面向对象语言的核心原则。</p>

<p>2.避免复杂性与增加风险</p>

<p>一个内置的反向索引堆会变得更复杂。例如，它需要处理以下问题：</p>

<ul>
  <li><strong>键的唯一性</strong>：反向索引表需要一个唯一的键来映射到堆的索引。如果<strong>堆中包含重复元素</strong>，这个键的选择就变得复杂。例如，可能需要使用对象的引用作为键，但如果元素是可变的，哈希值也可能发生变化，这会破坏哈希表的完整性。</li>
  <li><strong>线程安全</strong>：<code class="language-plaintext highlighter-rouge">PriorityQueue</code>本身不是线程安全的。如果加入了反向索引表，同步机制会变得更加复杂，以确保堆和哈希表的数据一致性。</li>
</ul>

<p>将这种复杂性交给开发者，让他们根据具体应用场景来决定是否需要，是一种更灵活、更安全的方式。</p>

<p>3.性能不是唯一考量</p>

<p>在许多场景下，$O(N)$的性能开销是可以接受的。例如，如果你只是偶尔需要更新或删除某个特定元素，那么为了这个不频繁的操作而牺牲整体的内存和性能，可能是不划算的。</p>

<p>总而言之，Java标准库的设计哲学是提供<strong>最小化</strong>但<strong>功能强大</strong>的构建块。<code class="language-plaintext highlighter-rouge">PriorityQueue</code>作为一个高效的优先级队列已经足够。开发者如果需要高级功能，可以自行组合其他数据结构，从而实现<strong>按需定制</strong>，而不是被迫接受一个功能更全但可能更臃肿、更慢的内置实现。</p>

<hr />

<p>这种设计思路也体现在许多其他标准库中，例如，Java的<code class="language-plaintext highlighter-rouge">HashSet</code>和<code class="language-plaintext highlighter-rouge">HashMap</code>都基于哈希表，但它们的内部实现细节隐藏了起来，只暴露了简单、清晰的接口。这让开发者可以专注于解决问题，而不是纠结于底层实现。</p>

<hr />

<p>手动改写堆：</p>

<ul>
  <li>1）建立反向索引表</li>
  <li>2）建立比较器</li>
  <li>3）核心在于各种结构相互配合，非常容易出错</li>
</ul>

<h2 id="32题目-商品买又退">3.2题目-商品买又退</h2>

<p>给定一个整型数组，int[] arr；和一个布尔类型数组，boolean[] op
两个数组一定等长，假设长度为N，arr[i]表示客户编号，op[i]表示客户操作
arr = [ 3   ,   3   ,   1   ,  2,      1,      2,      5…
op = [ T   ,   T,      T,     T,      F,      T,       F…
依次表示：3用户购买了一件商品，3用户购买了一件商品，1用户购买了一件商品，2用户购买了一件商品，1用户退货了一件商品，2用户购买了一件商品，5用户退货了一件商品…</p>

<hr />

<p>一对<code class="language-plaintext highlighter-rouge">arr[i]</code>和<code class="language-plaintext highlighter-rouge">op[i]</code>就代表一个事件：
用户号为arr[i]，<code class="language-plaintext highlighter-rouge">op[i] == T</code>就代表这个用户购买了一件商品
<code class="language-plaintext highlighter-rouge">op[i] == F</code>就代表这个用户退货了一件商品
现在你作为电商平台负责人，你想在每一个事件到来的时候，
都给购买次数最多的前K名用户颁奖。
所以每个事件发生后，你都需要一个得奖名单（得奖区）。</p>

<hr />

<p>得奖系统的规则：
1，如果某个用户购买商品数为0，但是又发生了退货事件，
则认为该事件无效，得奖名单和上一个事件发生后一致，例子中的5用户
2，某用户发生购买商品事件，购买商品数+1，发生退货事件，购买商品数-1
3，每次都是最多K个用户得奖，K也为传入的参数
如果根据全部规则，得奖人数确实不够K个，那就以不够的情况输出结果</p>

<p>4，得奖系统分为得奖区和候选区，任何用户只要购买数&gt;0，
一定在这两个区域中的一个
5，购买数最大的前K名用户进入得奖区，
在最初时如果得奖区没有到达K个用户，那么新来的用户直接进入得奖区
6，如果购买数不足以进入得奖区的用户，进入候选区</p>

<p>7，如果候选区购买数最多的用户，已经足以进入得奖区，
该用户就会替换得奖区中购买数最少的用户（大于才能替换），
如果得奖区中购买数最少的用户有多个，就替换最早进入得奖区的用户
如果候选区中购买数最多的用户有多个，机会会给最早进入候选区的用户</p>

<p>8，候选区和得奖区是两套时间，
因用户只会在其中一个区域，所以只会有一个区域的时间，另一个没有
从得奖区出来进入候选区的用户，得奖区时间删除，
进入候选区的时间就是当前事件的时间（可以理解为arr[i]和op[i]中的i）
从候选区出来进入得奖区的用户，候选区时间删除，
进入得奖区的时间就是当前事件的时间（可以理解为arr[i]和op[i]中的i）</p>

<p>9，如果某用户购买数==0，不管在哪个区域都离开，区域时间删除，
离开是指彻底离开，哪个区域也不会找到该用户
如果下次该用户又发生购买行为，产生&gt;0的购买数，
会再次根据之前规则回到某个区域中，进入区域的时间重记</p>

<hr />

<p>请遍历arr数组和op数组，遍历每一步输出一个得奖名单</p>

<p><code class="language-plaintext highlighter-rouge">public List&lt;List&lt;Integer&gt;&gt;  topK (int[] arr, boolean[] op, int k)</code></p>

<p>给出答案和对数器：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">class07</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Code02_EveryStepShowBoss</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
		<span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
		<span class="kd">public</span> <span class="kt">int</span> <span class="n">buy</span><span class="o">;</span>
		<span class="kd">public</span> <span class="kt">int</span> <span class="n">enterTime</span><span class="o">;</span>

		<span class="kd">public</span> <span class="nf">Customer</span><span class="o">(</span><span class="kt">int</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">,</span> <span class="kt">int</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
			<span class="n">buy</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
			<span class="n">enterTime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CandidateComparator</span> <span class="kd">implements</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="o">{</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Customer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">buy</span> <span class="o">!=</span> <span class="n">o2</span><span class="o">.</span><span class="na">buy</span> <span class="o">?</span> <span class="o">(</span><span class="n">o2</span><span class="o">.</span><span class="na">buy</span> <span class="o">-</span> <span class="n">o1</span><span class="o">.</span><span class="na">buy</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">enterTime</span><span class="o">);</span>
		<span class="o">}</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DaddyComparator</span> <span class="kd">implements</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="o">{</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Customer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">buy</span> <span class="o">!=</span> <span class="n">o2</span><span class="o">.</span><span class="na">buy</span> <span class="o">?</span> <span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">buy</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">buy</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">enterTime</span><span class="o">);</span>
		<span class="o">}</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">WhosYourDaddy</span> <span class="o">{</span>
		<span class="kd">private</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span><span class="o">;</span>
		<span class="kd">private</span> <span class="nc">HeapGreater</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">candHeap</span><span class="o">;</span>
		<span class="kd">private</span> <span class="nc">HeapGreater</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">daddyHeap</span><span class="o">;</span>
		<span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">daddyLimit</span><span class="o">;</span>

		<span class="kd">public</span> <span class="nf">WhosYourDaddy</span><span class="o">(</span><span class="kt">int</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">customers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">&gt;();</span>
			<span class="n">candHeap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HeapGreater</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">CandidateComparator</span><span class="o">());</span>
			<span class="n">daddyHeap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HeapGreater</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">DaddyComparator</span><span class="o">());</span>
			<span class="n">daddyLimit</span> <span class="o">=</span> <span class="n">limit</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="c1">// 当前处理i号事件，arr[i] -&gt; id,  buyOrRefund</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">operate</span><span class="o">(</span><span class="kt">int</span> <span class="n">time</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">buyOrRefund</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">buyOrRefund</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">customers</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">id</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">customers</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">id</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">customers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
			<span class="o">}</span>
			<span class="nc">Customer</span> <span class="n">c</span> <span class="o">=</span> <span class="n">customers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">buyOrRefund</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">c</span><span class="o">.</span><span class="na">buy</span><span class="o">++;</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">c</span><span class="o">.</span><span class="na">buy</span><span class="o">--;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">buy</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">customers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">candHeap</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">daddyHeap</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">daddyHeap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">daddyLimit</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">c</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
					<span class="n">daddyHeap</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
					<span class="n">c</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
					<span class="n">candHeap</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">candHeap</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">buy</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">candHeap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
					<span class="n">candHeap</span><span class="o">.</span><span class="na">resign</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">buy</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">daddyHeap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
					<span class="n">daddyHeap</span><span class="o">.</span><span class="na">resign</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="n">daddyMove</span><span class="o">(</span><span class="n">time</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">getDaddies</span><span class="o">()</span> <span class="o">{</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="n">daddyHeap</span><span class="o">.</span><span class="na">getAllElements</span><span class="o">();</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ans</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
			<span class="k">for</span> <span class="o">(</span><span class="nc">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">customers</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">ans</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="kd">private</span> <span class="kt">void</span> <span class="nf">daddyMove</span><span class="o">(</span><span class="kt">int</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">candHeap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">daddyHeap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">daddyLimit</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">Customer</span> <span class="n">p</span> <span class="o">=</span> <span class="n">candHeap</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
				<span class="n">p</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
				<span class="n">daddyHeap</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">candHeap</span><span class="o">.</span><span class="na">peek</span><span class="o">().</span><span class="na">buy</span> <span class="o">&gt;</span> <span class="n">daddyHeap</span><span class="o">.</span><span class="na">peek</span><span class="o">().</span><span class="na">buy</span><span class="o">)</span> <span class="o">{</span>
					<span class="nc">Customer</span> <span class="n">oldDaddy</span> <span class="o">=</span> <span class="n">daddyHeap</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
					<span class="nc">Customer</span> <span class="n">newDaddy</span> <span class="o">=</span> <span class="n">candHeap</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
					<span class="n">oldDaddy</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
					<span class="n">newDaddy</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
					<span class="n">daddyHeap</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">newDaddy</span><span class="o">);</span>
					<span class="n">candHeap</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">oldDaddy</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="nf">topK</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">,</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">op</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="nc">WhosYourDaddy</span> <span class="n">whoDaddies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WhosYourDaddy</span><span class="o">(</span><span class="n">k</span><span class="o">);</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">whoDaddies</span><span class="o">.</span><span class="na">operate</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">op</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
			<span class="n">ans</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">whoDaddies</span><span class="o">.</span><span class="na">getDaddies</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">// 干完所有的事，模拟，不优化</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="nf">compare</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">,</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">op</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
		<span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">cands</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">daddy</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
			<span class="kt">boolean</span> <span class="n">buyOrRefund</span> <span class="o">=</span> <span class="n">op</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">buyOrRefund</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">id</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">ans</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">getCurAns</span><span class="o">(</span><span class="n">daddy</span><span class="o">));</span>
				<span class="k">continue</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="c1">// 没有发生：用户购买数为0并且又退货了</span>
			<span class="c1">// 用户之前购买数是0，此时买货事件</span>
			<span class="c1">// 用户之前购买数&gt;0， 此时买货</span>
			<span class="c1">// 用户之前购买数&gt;0, 此时退货</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">id</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
			<span class="o">}</span>
			<span class="c1">// 买、卖</span>
			<span class="nc">Customer</span> <span class="n">c</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">buyOrRefund</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">c</span><span class="o">.</span><span class="na">buy</span><span class="o">++;</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">c</span><span class="o">.</span><span class="na">buy</span><span class="o">--;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">buy</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="c1">// c</span>
			<span class="c1">// 下面做</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">cands</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">daddy</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">daddy</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">c</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
					<span class="n">daddy</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
					<span class="n">c</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
					<span class="n">cands</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="n">cleanZeroBuy</span><span class="o">(</span><span class="n">cands</span><span class="o">);</span>
			<span class="n">cleanZeroBuy</span><span class="o">(</span><span class="n">daddy</span><span class="o">);</span>
			<span class="n">cands</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="nc">CandidateComparator</span><span class="o">());</span>
			<span class="n">daddy</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="nc">DaddyComparator</span><span class="o">());</span>
			<span class="n">move</span><span class="o">(</span><span class="n">cands</span><span class="o">,</span> <span class="n">daddy</span><span class="o">,</span> <span class="n">k</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
			<span class="n">ans</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">getCurAns</span><span class="o">(</span><span class="n">daddy</span><span class="o">));</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">cands</span><span class="o">,</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">daddy</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">,</span> <span class="kt">int</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">cands</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="c1">// 候选区不为空</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">daddy</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">Customer</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cands</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
			<span class="n">c</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
			<span class="n">daddy</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
			<span class="n">cands</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="c1">// 等奖区满了，候选区有东西</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">cands</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">buy</span> <span class="o">&gt;</span> <span class="n">daddy</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">buy</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">Customer</span> <span class="n">oldDaddy</span> <span class="o">=</span> <span class="n">daddy</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
				<span class="n">daddy</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
				<span class="nc">Customer</span> <span class="n">newDaddy</span> <span class="o">=</span> <span class="n">cands</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
				<span class="n">cands</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
				<span class="n">newDaddy</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
				<span class="n">oldDaddy</span><span class="o">.</span><span class="na">enterTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
				<span class="n">daddy</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newDaddy</span><span class="o">);</span>
				<span class="n">cands</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oldDaddy</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">cleanZeroBuy</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">noZero</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;();</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">buy</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">noZero</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="n">arr</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">noZero</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">arr</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">getCurAns</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">daddy</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ans</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">Customer</span> <span class="n">c</span> <span class="o">:</span> <span class="n">daddy</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">ans</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">// 为了测试</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
		<span class="kd">public</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">;</span>
		<span class="kd">public</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">op</span><span class="o">;</span>

		<span class="kd">public</span> <span class="nf">Data</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">a</span><span class="o">,</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">arr</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
			<span class="n">op</span> <span class="o">=</span> <span class="n">o</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">// 为了测试</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Data</span> <span class="nf">randomData</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxValue</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxLen</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">maxLen</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
		<span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">len</span><span class="o">];</span>
		<span class="kt">boolean</span><span class="o">[]</span> <span class="n">op</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">len</span><span class="o">];</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">maxValue</span><span class="o">);</span>
			<span class="n">op</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Data</span><span class="o">(</span><span class="n">arr</span><span class="o">,</span> <span class="n">op</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="c1">// 为了测试</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">sameAnswer</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans1</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans2</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">ans1</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">!=</span> <span class="n">ans2</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ans1</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">cur1</span> <span class="o">=</span> <span class="n">ans1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">cur2</span> <span class="o">=</span> <span class="n">ans2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">cur1</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">!=</span> <span class="n">cur2</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="n">cur1</span><span class="o">.</span><span class="na">sort</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">);</span>
			<span class="n">cur2</span><span class="o">.</span><span class="na">sort</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">);</span>
			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cur1</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(!</span><span class="n">cur1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">cur2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)))</span> <span class="o">{</span>
					<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">maxValue</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">maxLen</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">maxK</span> <span class="o">=</span> <span class="mi">6</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">testTimes</span> <span class="o">=</span> <span class="mi">100000</span><span class="o">;</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"测试开始"</span><span class="o">);</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">testTimes</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="nc">Data</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">randomData</span><span class="o">(</span><span class="n">maxValue</span><span class="o">,</span> <span class="n">maxLen</span><span class="o">);</span>
			<span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">maxK</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
			<span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="na">arr</span><span class="o">;</span>
			<span class="kt">boolean</span><span class="o">[]</span> <span class="n">op</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="na">op</span><span class="o">;</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">topK</span><span class="o">(</span><span class="n">arr</span><span class="o">,</span> <span class="n">op</span><span class="o">,</span> <span class="n">k</span><span class="o">);</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">compare</span><span class="o">(</span><span class="n">arr</span><span class="o">,</span> <span class="n">op</span><span class="o">,</span> <span class="n">k</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">sameAnswer</span><span class="o">(</span><span class="n">ans1</span><span class="o">,</span> <span class="n">ans2</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
					<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="s">" , "</span> <span class="o">+</span> <span class="n">op</span><span class="o">[</span><span class="n">j</span><span class="o">]);</span>
				<span class="o">}</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">k</span><span class="o">);</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ans1</span><span class="o">);</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ans2</span><span class="o">);</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"出错了！"</span><span class="o">);</span>
				<span class="k">break</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"测试结束"</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="33什么时候用加强堆">3.3什么时候用加强堆</h2>

<p>用到这个结构的题目特征：</p>

<p><strong>需要用到堆结构来维持样本之间的大小关系，</strong></p>

<p><strong>又有样本数值改变的需求，还需要在结构里调整排列次序，</strong></p>

<p><strong>样本数值之间允许重复，也就是在结构里数值一样的样本不希望去重，希望都保留。</strong></p>

<p>这是加强堆的使用特征。</p>

<p><strong>完全可以把这个结构当作堆的coding练习，事实上这个结构也确实是练习意义大于实际意义的结构。</strong></p>

<h2 id="34加强堆-其他题">3.4加强堆-其他题</h2>

<h3 id="力扣508-出现次数最多的子树元素和">力扣508-出现次数最多的子树元素和</h3>

<p><a href="https://leetcode.cn/problems/most-frequent-subtree-sum/">508. 出现次数最多的子树元素和</a></p>

<p>解法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Definition for a binary tree node.
 * public class TreeNode {
 *     int val;
 *     TreeNode left;
 *     TreeNode right;
 *     TreeNode() {}
 *     TreeNode(int val) { this.val = val; }
 *     TreeNode(int val, TreeNode left, TreeNode right) {
 *         this.val = val;
 *         this.left = left;
 *         this.right = right;
 *     }
 * }
 */</span>
<span class="c1">// 加强堆</span>
<span class="kd">class</span> <span class="nc">Solution</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">findFrequentTreeSum</span><span class="o">(</span><span class="nc">TreeNode</span> <span class="n">root</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Heap</span> <span class="n">heap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Heap</span><span class="o">();</span>
        <span class="n">findFrequentTreeSum</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">heap</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">getMaxNum</span><span class="o">(</span><span class="n">heap</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">findFrequentTreeSum</span><span class="o">(</span><span class="nc">TreeNode</span> <span class="n">root</span><span class="o">,</span> <span class="nc">Heap</span> <span class="n">heap</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">findFrequentTreeSum</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">heap</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">findFrequentTreeSum</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">heap</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">root</span><span class="o">.</span><span class="na">val</span><span class="o">;</span>
        <span class="n">heap</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">getMaxNum</span><span class="o">(</span><span class="nc">Heap</span> <span class="n">heap</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">heap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
        <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">peek</span><span class="o">().</span><span class="na">num</span><span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;&gt;();</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">heap</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">heap</span><span class="o">.</span><span class="na">peek</span><span class="o">().</span><span class="na">num</span> <span class="o">==</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">heap</span><span class="o">.</span><span class="na">pop</span><span class="o">().</span><span class="na">sum</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">result</span><span class="o">.</span><span class="na">size</span><span class="o">()];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">arr</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">sum</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">num</span><span class="o">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="nc">Data</span> <span class="n">data</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Data</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">sum</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="na">sum</span> <span class="o">&amp;&amp;</span> <span class="n">num</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="na">num</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">sum</span><span class="o">,</span> <span class="n">num</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Heap</span> <span class="o">{</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Data</span><span class="o">&gt;</span> <span class="n">heap</span><span class="o">;</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">indexMap</span><span class="o">;</span>

        <span class="kt">int</span> <span class="n">heapSize</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Heap</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">heap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="n">indexMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insert</span><span class="o">(</span><span class="kt">int</span> <span class="n">sum</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">indexMap</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">sum</span><span class="o">)){</span>
                <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">indexMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">sum</span><span class="o">)).</span><span class="na">num</span><span class="o">++;</span>
                <span class="n">resign</span><span class="o">(</span><span class="n">indexMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">sum</span><span class="o">));</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">Data</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Data</span><span class="o">();</span>
                <span class="n">data</span><span class="o">.</span><span class="na">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">;</span>
                <span class="n">data</span><span class="o">.</span><span class="na">num</span><span class="o">++;</span>
                <span class="n">heap</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
                <span class="n">indexMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">sum</span><span class="o">,</span> <span class="n">heapSize</span><span class="o">);</span>
                <span class="n">heapInsert</span><span class="o">(</span><span class="n">heapSize</span><span class="o">++);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Data</span> <span class="nf">peek</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>


        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">heapSize</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Data</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">Data</span> <span class="n">data</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">remove</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">sum</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resign</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">heapInsert</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
            <span class="n">heapIfy</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">int</span> <span class="n">sum</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Integer</span> <span class="n">index</span> <span class="o">=</span> <span class="n">indexMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
            <span class="nc">Data</span> <span class="n">last</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">heapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
            <span class="n">indexMap</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
            <span class="n">heapSize</span><span class="o">--;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">last</span><span class="o">.</span><span class="na">sum</span> <span class="o">!=</span> <span class="n">sum</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">indexMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">last</span><span class="o">.</span><span class="na">sum</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
                <span class="n">heap</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">last</span><span class="o">);</span>
                <span class="n">resign</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">heapIfy</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">index</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="n">heapSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">heapSize</span> <span class="o">&amp;&amp;</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">left</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">num</span> <span class="o">&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">left</span><span class="o">).</span><span class="na">num</span> <span class="o">?</span> <span class="n">left</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">left</span><span class="o">;</span>
                <span class="n">largest</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">num</span> <span class="o">&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">largest</span><span class="o">).</span><span class="na">num</span> <span class="o">?</span> <span class="n">index</span> <span class="o">:</span> <span class="n">largest</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">==</span> <span class="n">largest</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">swap</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">largest</span><span class="o">);</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">largest</span><span class="o">;</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">index</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">heapInsert</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">parent</span> <span class="o">=</span> <span class="o">(</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(!(</span><span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">parent</span><span class="o">).</span><span class="na">num</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">num</span><span class="o">))</span> <span class="k">break</span><span class="o">;</span>
                <span class="n">swap</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">swap</span><span class="o">(</span><span class="kt">int</span> <span class="n">left</span><span class="o">,</span> <span class="kt">int</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Data</span> <span class="n">l</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">left</span><span class="o">);</span>
            <span class="nc">Data</span> <span class="n">r</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">right</span><span class="o">);</span>
            <span class="n">indexMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="na">sum</span><span class="o">,</span> <span class="n">right</span><span class="o">);</span>
            <span class="n">indexMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">sum</span><span class="o">,</span> <span class="n">left</span><span class="o">);</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">left</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">right</span><span class="o">,</span> <span class="n">l</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="4力扣-295">4.力扣-295</h1>

<p><a href="https://leetcode.cn/problems/find-median-from-data-stream/">295. 数据流的中位数</a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MedianFinder</span> <span class="o">{</span>

    <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">hMax</span><span class="o">;</span>
    <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">hMin</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MedianFinder</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">hMax</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityQueue</span><span class="o">&lt;&gt;((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)-&gt;</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">);</span>
        <span class="n">hMin</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityQueue</span><span class="o">&lt;&gt;((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)-&gt;</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addNum</span><span class="o">(</span><span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hMax</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">hMax</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">hMax</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">hMax</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">hMin</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">balance</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">findMedian</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hMax</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">hMin</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">double</span><span class="o">)(</span><span class="n">hMax</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">+</span> <span class="n">hMin</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">hMax</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">hMin</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">?</span> <span class="n">hMax</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">:</span> <span class="n">hMin</span><span class="o">.</span><span class="na">peek</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>    

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">balance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hMax</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">hMin</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">hMin</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">hMax</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">hMin</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">hMax</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">hMax</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">hMin</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
 * Your MedianFinder object will be instantiated and called as such:
 * MedianFinder obj = new MedianFinder();
 * obj.addNum(num);
 * double param_2 = obj.findMedian();
 */</span>
</pre></td></tr></tbody></table></code></pre></div></div>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2025/09/22/%E7%AE%97%E6%B3%95%E9%A2%98%E5%BA%93-1%E5%87%A0%E4%B9%8E%E6%9C%89%E5%BA%8F/" data-toggle="tooltip" data-placement="top" title="【算法题库1】几乎有序">
                        Previous<br>
                        <span>【算法题库1】几乎有序</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2025/09/25/%E7%AE%97%E6%B3%95%E4%BD%93%E7%B3%BB%E5%AD%A6%E4%B9%A0-8%E5%89%8D%E7%BC%80%E6%A0%91%E4%B8%8E%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F/" data-toggle="tooltip" data-placement="top" title="【体系学习008】前缀树与基数排序">
                        Next<br>
                        <span>【体系学习008】前缀树与基数排序</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0169" 
                    href="/archive/?tag=%E4%B9%A6%E7%B1%8D%E9%98%85%E8%AF%BB"
                    title="书籍阅读"
                    rel="3">书籍阅读</a>
        
                <a data-sort="0134" 
                    href="/archive/?tag=%E7%AE%97%E6%B3%95"
                    title="算法"
                    rel="38">算法</a>
        
                <a data-sort="0154" 
                    href="/archive/?tag=%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BDAI%E5%9F%BA%E7%A1%80"
                    title="人工智能AI基础"
                    rel="18">人工智能AI基础</a>
        
                <a data-sort="0155" 
                    href="/archive/?tag=python%E5%9F%BA%E7%A1%80"
                    title="python基础"
                    rel="17">python基础</a>
        
                <a data-sort="0157" 
                    href="/archive/?tag=%E5%8A%9B%E6%89%A3"
                    title="力扣"
                    rel="15">力扣</a>
        
                <a data-sort="0159" 
                    href="/archive/?tag=numpy"
                    title="numpy"
                    rel="13">numpy</a>
        
                <a data-sort="0159" 
                    href="/archive/?tag=pandas"
                    title="pandas"
                    rel="13">pandas</a>
        
                <a data-sort="0160" 
                    href="/archive/?tag=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%90%B4%E6%81%A9%E8%BE%BE"
                    title="机器学习-吴恩达"
                    rel="12">机器学习-吴恩达</a>
        
                <a data-sort="0161" 
                    href="/archive/?tag=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95"
                    title="机器学习算法"
                    rel="11">机器学习算法</a>
        
                <a data-sort="0166" 
                    href="/archive/?tag=matplotlib"
                    title="matplotlib"
                    rel="6">matplotlib</a>
        
                <a data-sort="0169" 
                    href="/archive/?tag=spring6"
                    title="spring6"
                    rel="3">spring6</a>
        
                <a data-sort="0170" 
                    href="/archive/?tag=Java%E5%9F%BA%E7%A1%80"
                    title="Java基础"
                    rel="2">Java基础</a>
        
                <a data-sort="0170" 
                    href="/archive/?tag=java%E9%9B%86%E5%90%88"
                    title="java集合"
                    rel="2">java集合</a>
        
                <a data-sort="0170" 
                    href="/archive/?tag=ollama%E5%B7%A5%E5%85%B7"
                    title="ollama工具"
                    rel="2">ollama工具</a>
        
                <a data-sort="0170" 
                    href="/archive/?tag=python%E7%88%AC%E8%99%AB"
                    title="python爬虫"
                    rel="2">python爬虫</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://m.freebuf.com/">freebuf</a></li>
  
  <li><a href="https://xz.aliyun.com/">先知</a></li>
  
  <li><a href="https://www.sec-in.com/All">sec-in</a></li>
  
  <li><a href="https://paper.seebug.org/">see-bug</a></li>
  
  <li><a href="https://twitter.com/Concurr21486093">我的推特</a></li>
  
  <li><a href="https://pdai.tech/">pdai</a></li>
  
  <li><a href="https://nodejs.org/dist/">nodejs index of dist</a></li>
  
  <li><a href="#">公众号：小东方不败</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/Concurr21486093">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/Hilda">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/kirsten-1">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Hilda 2025
                    <br>
                    Powered by <a href="https://kirsten-1.github.io/">hilda Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
