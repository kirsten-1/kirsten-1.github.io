<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="这里是 Hilda 的个人博客，与你一起发现更大的世界 | 要做一个有 swag 的程序员">
    <meta name="keywords" content="Hilda">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="numpy(11)玩转 Pygame - Hilda的博客 | Your genius girlfriend's blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="

">
    
    <meta property="article:published_time" content=" 2025-02-14T00:00:00Z">
    
    
    <meta property="article:author" content="Hilda">
    
    
    <meta property="article:tag" content="人工智能AI基础">
    
    
    <meta property="og:image" content="https://kirsten-1.github.io">
    <meta property="og:url" content="https://kirsten-1.github.io/2025/02/14/NumPy(11)%E7%8E%A9%E8%BD%ACPygame/">
    <meta property="og:site_name" content="Hilda的博客 | Your genius girlfriend's blog">

    <title>numpy(11)玩转 Pygame - Hilda的博客 | Your genius girlfriend's blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://kirsten-1.github.io/2025/02/14/NumPy(11)%E7%8E%A9%E8%BD%ACPygame/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Hilda</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-2015.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/post-bg-2015.jpg');
        background: ;
    }

    
</style>




<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BDAI%E5%9F%BA%E7%A1%80" title="人工智能AI基础">人工智能AI基础</a>
                        
                    </div>
                    <h1>numpy(11)玩转 Pygame</h1>
                    
                    <h2 class="subheading">第 11 章 玩转 Pygame</h2>
                    <span class="meta">Posted by Hilda on February 14, 2025</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG">
</script>

<p>前10章以及其他补充已经整理如下：</p>

<p><a href="https://kirsten-1.github.io/2025/01/27/numpy(1)_%E5%85%A5%E9%97%A8/">第1章NumPy入门</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/04/numpy(2)_numpy%E5%9F%BA%E7%A1%80/">第2章NumPy基础</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/06/Numpy(3)%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/">第3章常用函数</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/04/Numpy%E7%9A%84%E5%B9%BF%E6%92%AD%E5%92%8C%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6/">【补充1】-广播与广播机制</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/07/NumPy(4)%E4%BE%BF%E6%8D%B7%E5%87%BD%E6%95%B0/">第4章便捷函数</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/09/NumPy(5)%E7%9F%A9%E9%98%B5%E5%92%8C%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0/">第5章矩阵和通用函数</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/09/NumPy(6)%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0NumPy%E6%A8%A1%E5%9D%97/">第6章深入学习NumPy模块</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/10/NumPy(7)%E4%B8%93%E7%94%A8%E5%87%BD%E6%95%B0/">第7章专用函数</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/12/NumPy(8)%E8%B4%A8%E9%87%8F%E6%8E%A7%E5%88%B6/">第8章质量控制</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/12/NumPy(9)%E4%BD%BF%E7%94%A8Matplotlib%E7%BB%98%E5%9B%BE/">第9章使用Matplotlib绘图</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/11/jupyter-notebook-%E8%AF%BB%E5%9B%BE%E7%89%87/">【补充2】-读图片-jupyter notebook-三种方式+图像简单操作</a></p>

<p><a href="https://kirsten-1.github.io/2025/02/12/NumPy(10)NumPy%E7%9A%84%E6%89%A9%E5%B1%95-SciPy/">第10章NumPy 的扩展：SciPy</a></p>

<hr />

<p>本章写给需要使用NumPy和Pygame快速并且简易地进行游戏制作的开发者。基本的游戏开发经验对于阅读本章内容有帮助，但并不是必需的。</p>

<p>本章涵盖以下内容：</p>

<ul>
  <li>Pygame基础；</li>
  <li>Matplotlib集成；</li>
  <li>屏幕像素矩阵；</li>
  <li>人工智能；</li>
  <li>动画；</li>
  <li>OpenGL。</li>
</ul>

<hr />

<h1 id="111-pygame">11.1 Pygame</h1>

<p>Pygame最初是由Pete Shinners编写的一套Python架构。顾名思义，Pygame可以用于制作电子游戏。自2004年起，Pygame成为GPL（General Public License，通用公共许可证）下的开源免费软件，这意味着你可以使用它制作任何类型的游戏。Pygame基于SDL（Simple DirectMedia Layer，简易直控媒体层）。SDL是一套C语言架构，可用于在各种操作系统中（包括Linux、Mac OS X和Windows）访问图形、声音、键盘以及其他输入设备。</p>

<h1 id="112-动手实践安装-pygame">11.2 动手实践：安装 Pygame</h1>

<p>在本节教程中，我们将安装Pygame。Pygame基本上可以与所有版本的Python兼容。不过在编写本书的时候，和Python 3仍有一些兼容问题，但这些问题很可能不久就会被修复。请完成如下步骤安装Pygame。</p>

<p>(1) 根据你所使用的操作系统，选择一种方式安装Pygame。</p>

<ul>
  <li>Debian和Ubuntu Pygame可以在Debian软件库中找到： http://packages.qa.debian.org/p/pygame.html。</li>
  <li>Windows 根据所使用的Python版本，我们可以从Pygame的网站上（http://www.pygame.org/download.shtml）下载合适的二进制安装包。</li>
  <li>Mac Pygame在Mac OS X 10.3及以上版本的二进制安装包也可以在这里下载： http://www.pygame.org/download.shtml。</li>
</ul>

<blockquote>
  <p>注：前10章我在jupyter notebook中运行代码案例。这一章<code class="language-plaintext highlighter-rouge">Pygame</code> 需要一个主事件循环来处理用户输入、更新屏幕等。然而，Jupyter Notebook 是基于 cell 执行的，而每个 cell 都是相互独立的，这与 <code class="language-plaintext highlighter-rouge">Pygame</code> 的事件循环模型不兼容。</p>

  <p><code class="language-plaintext highlighter-rouge">Pygame</code> 需要一个持久的窗口显示，而 Jupyter Notebook 通常在单个输出框内显示图形，这对于动态更新（如游戏中的帧更新）来说比较困难。</p>

  <p>综上，我在pycharm中书写这一章的示例代码。</p>
</blockquote>

<p>在pycharm中安装依赖pygame</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214144041449.png" alt="image-20250214144041449" style="zoom:50%;" /></p>

<p>我也不清楚需不需要下面的库（pygame所依赖的），暂时先安装上：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">所依赖的库</span><span class="p">:</span><span class="n">sdl</span> <span class="n">hg</span>  
  <span class="n">这两个我没有安装成功</span><span class="err">：</span><span class="n">portmidizero</span>  <span class="n">pyPortmidi</span>  
</pre></td></tr></tbody></table></code></pre></div></div>

<p>验证安装:安装完成后，可以编写一个简单的Pygame程序来验证安装是否成功。创建一个Python文件，命名为<code class="language-plaintext highlighter-rouge">test_pygame.py</code>，并将以下代码复制到文件中:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span>

<span class="c1"># 初始化Pygame
</span><span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

<span class="c1"># 创建游戏窗口
</span><span class="n">window</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">"</span><span class="s">Pygame测试</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 游戏循环
</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">while</span> <span class="n">running</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># 绘制背景
</span>    <span class="n">window</span><span class="p">.</span><span class="nf">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="c1"># 刷新窗口
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>

<span class="c1"># 退出游戏
</span><span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>相应目录下运行<code class="language-plaintext highlighter-rouge">python test_pygame.py</code></p>

<p>控制台输出：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214144942287.png" alt="image-20250214144942287" style="zoom:50%;" /></p>

<p>并且有一个弹窗出现：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214144956999.png" alt="image-20250214144956999" style="zoom:50%;" /></p>

<p>这表明已成功安装Pygame并准备好开始游戏开发了！</p>

<h1 id="113-hello-world">11.3 Hello World</h1>

<p>我们将制作一个简单的游戏，并在本章后续内容中加以改进。按照程序设计类书籍的传统，我们将从一个Hello World示例程序开始。</p>

<h1 id="114-动手实践制作简单游戏">11.4 动手实践：制作简单游戏</h1>

<p>值得注意的是，所有的动作都会在所谓的游戏主循环中发生，以及使用font模块来呈现文本。在这个程序中，我们将利用Pygame的Surface对象进行绘图，并处理一个退出事件。请完成如下步骤。</p>

<p>(1) 首先，导入所需要的Pygame模块。如果Pygame已经正确安装，将不会有任何报错；否则，请返回安装教程。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span> <span class="n">sys</span> 
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 我们将初始化Pygame，创建一块<code class="language-plaintext highlighter-rouge">400 × 300</code>像素大小的显示区域，并将窗口标题设置为Hello World!。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span> 
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span> 
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">Hello World!</span><span class="sh">'</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 游戏通常会有一个主循环一直运行，直到退出事件的发生。在本例中，我们仅仅在坐标<code class="language-plaintext highlighter-rouge">(100, 100)</code>处设置一个Hello World文本标签，文本的字体大小为19，颜色为红色。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">sysFont</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="nc">SysFont</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
    <span class="n">rendered</span> <span class="o">=</span> <span class="n">sysFont</span><span class="p">.</span><span class="nf">render </span><span class="p">(</span><span class="sh">'</span><span class="s">Hello World</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="nf">blit</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214145507694.png" alt="image-20250214145507694" style="zoom:50%;" /></p>

<p>刚才做了些什么 : 在本节教程中，虽然看起来内容不多，但其实我们已经学习了很多。我们将出现过的函数总结在下面的表格中。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214145617262.png" alt="image-20250214145617262" style="zoom:50%;" /></p>

<p>完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">Hello World!</span><span class="sh">'</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">sysFont</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="nc">SysFont</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
    <span class="n">rendered</span> <span class="o">=</span> <span class="n">sysFont</span><span class="p">.</span><span class="nf">render </span><span class="p">(</span><span class="sh">'</span><span class="s">Hello World</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="nf">blit</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="115-动画">11.5 动画</h1>

<p>大部分游戏，即使是最“静态”的那些，也有一定程度的动画部分。从一个程序员的角度来看，动画只不过是不同的时间在不同地点显示对象，从而模拟对象的移动。</p>

<p>Pygame提供Clock对象，用于控制每秒钟绘图的帧数。这可以保证动画与CPU的快慢无关。</p>

<h1 id="116-动手实践使用-numpy-和-pygame-制作动画对象">11.6 动手实践：使用 NumPy 和 Pygame 制作动画对象</h1>

<p>我们将载入一个图像并使用NumPy定义一条沿屏幕的顺时针路径。请完成如下步骤。</p>

<p>(1) 创建一个Pygame的Clock对象，如下所示：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="nc">Clock</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 和本书配套的源代码文件一起，有一张头部的图片。我们将载入这张图片，并使之在屏幕上移动。</p>

<blockquote>
  <p>注：<code class="language-plaintext highlighter-rouge">head.jpg</code>可以从https://github.com/sundaygeek/numpy-beginner-guide/blob/master/ch11code/head.jpg 下载。</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">head.jpg</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 我们将定义一些数组来储存动画中图片的位置坐标。既然对象可以被移动，那么应该有四个方向——上、下、左、右。每一个方向上都有40个等距的步长。我们将各方向上的值全部初始化为0。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">40</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> 
<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span> 
<span class="n">down</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span> 
<span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span> 
<span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(4) 设置图片的位置坐标是一件很烦琐的事情。不过，有一个小技巧可以用上——<code class="language-plaintext highlighter-rouge">[::-1]</code>可以获得倒序的数组元素。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">down</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">down</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">up</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(5) 四个方向的路径可以连接在一起，但需要先用T操作符对数组进行转置操作，使得它们以正确的方式对齐。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span><span class="n">right</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">down</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">up</span><span class="p">.</span><span class="n">T</span><span class="p">))</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(6) 在主循环中，我们设置时钟周期为每秒30帧：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">clock</span><span class="p">.</span><span class="nf">tick</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>动画截图如下：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214153128684.png" alt="image-20250214153128684" style="zoom:50%;" /></p>

<p>完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
<span class="c1"># 创建一个Pygame的Clock对象 用于控制每秒钟绘图的帧数。这可以保证动画与CPU的快慢无关。
</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="nc">Clock</span><span class="p">()</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">Animating Objects</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 载入图片
</span><span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">head.jpg</span><span class="sh">'</span><span class="p">)</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">40</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">down</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>

<span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">down</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">down</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">up</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span><span class="n">right</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">down</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">up</span><span class="p">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># 清屏
</span>    <span class="n">screen</span><span class="p">.</span><span class="nf">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">screen</span><span class="p">.</span><span class="nf">blit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
                <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="nf">tick</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 :在本节教程中我们学习了一点关于动画的内容，其中最重要的就是时钟的概念。我们将使用到的新函数总结在下面的表格中。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214153217535.png" alt="image-20250214153217535" style="zoom:50%;" /></p>

<h1 id="117-matplotlib">11.7 Matplotlib</h1>

<p>我们在第9章中学习过Matplotlib，这是一个可以便捷绘图的开源工具库。我们可以在Pygame中集成Matplotlib，绘制各种各样的图像。</p>

<h1 id="118-动手实践在-pygame-中使用-matplotlib">11.8 动手实践：在 Pygame 中使用 Matplotlib</h1>

<p>在本节教程中，我们将使用前一节教程中的位置坐标并为其绘制图像。请完成如下步骤。</p>

<p>(1) 使用非交互式的后台：为了在Pygame中集成Matplotlib，我们需要使用一个非交互式的后台，否则Matplotlib会默认显示一个GUI窗口。我们将引入Matplotlib主模块并调用use函数。该函数必须在引入Matplotlib主模块后并引入其他Matplotlib模块前立即调用。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>

<span class="n">mpl</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">Agg</span><span class="sh">"</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 非交互式绘图可以在Matplotlib画布（canvas）上完成。创建画布需要引入模块、创建图像和子图。我们将指定图像大小为<code class="language-plaintext highlighter-rouge">3 × 3</code>英寸。更多细节请参阅本节末尾的代码。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span> 
<span class="kn">import</span> <span class="n">matplotlib.backends.backend_agg</span> <span class="k">as</span> <span class="n">agg</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>  
<span class="n">canvas</span> <span class="o">=</span> <span class="n">agg</span><span class="p">.</span><span class="nc">FigureCanvasAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 在非交互模式下绘图比在默认模式下稍复杂一点。由于我们要反复多次绘图，因此有必要将绘图代码组织成一个函数。图像最终应绘制在画布上，这使得我们的步骤变得复杂了一些。在本例的最后，你可以找到这些函数更为详细的说明。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">canvas</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_renderer</span><span class="p">()</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">tostring_rgb</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_width_height</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">fromstring</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="sh">"</span><span class="s">RGB</span><span class="sh">"</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>注：原书有个问题。在较新的版本的 <code class="language-plaintext highlighter-rouge">Matplotlib</code> 中，<code class="language-plaintext highlighter-rouge">tostring_rgb()</code> 已被移除，改为 <code class="language-plaintext highlighter-rouge">tostring_argb()</code> 或 <code class="language-plaintext highlighter-rouge">tostring()</code>。</p>

  <p>因此，可以修改为使用 <code class="language-plaintext highlighter-rouge">tostring_argb()</code> 来代替 <code class="language-plaintext highlighter-rouge">tostring_rgb()</code>。</p>

  <p>但是，<code class="language-plaintext highlighter-rouge">raw_data</code> 的字节长度与 <code class="language-plaintext highlighter-rouge">size</code>（图像尺寸）不匹配。可能是由于使用 <code class="language-plaintext highlighter-rouge">tostring_argb()</code> 获取的字节数据与 <code class="language-plaintext highlighter-rouge">pygame.image.fromstring()</code> 期望的格式不一致。为了正确处理图像，必须确保图像数据的字节数正确，并且能够正确地传递给 <code class="language-plaintext highlighter-rouge">pygame.image.fromstring()</code>。</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># 绘制数据
</span>    <span class="n">canvas</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_renderer</span><span class="p">()</span>
    <span class="c1"># 使用 tostring_argb() 代替 tostring_rgb()
</span>    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">tostring_argb</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_width_height</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">fromstring</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="sh">"</span><span class="s">ARGB</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 使用 ARGB 格式
</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>大致效果：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214164127104.png" alt="image-20250214164127104" style="zoom:50%;" /></p>

<p>完整代码：(和书上不太一样，因为我进行了调试，原书某方法已经过时了)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">matplotlib.backends.backend_agg</span> <span class="k">as</span> <span class="n">agg</span>

<span class="n">mpl</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">Agg</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 使用 Agg 后端
</span>
<span class="c1"># 创建 matplotlib 绘图
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">agg</span><span class="p">.</span><span class="nc">FigureCanvasAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># 绘制数据
</span>    <span class="n">canvas</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_renderer</span><span class="p">()</span>
    <span class="c1"># 使用 tostring_argb() 代替 tostring_rgb()
</span>    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">tostring_argb</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">.</span><span class="nf">get_width_height</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">fromstring</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="sh">"</span><span class="s">ARGB</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 使用 ARGB 格式
</span>

<span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="nc">Clock</span><span class="p">()</span>

<span class="c1"># 设置显示窗口
</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">Animating Objects</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 加载图片
</span><span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">head.jpg</span><span class="sh">'</span><span class="p">)</span>

<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">40</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">down</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>
<span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)))</span>

<span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">down</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">down</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">up</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># 计算路径
</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span><span class="n">right</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">down</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">up</span><span class="p">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># 初始化 history
</span><span class="n">history</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([])</span>

<span class="c1"># 绘制初始图像
</span><span class="n">surf</span> <span class="o">=</span> <span class="nf">plot</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>

<span class="c1"># 主循环
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># 清空屏幕
</span>    <span class="n">screen</span><span class="p">.</span><span class="nf">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="nf">plot</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>  <span class="c1"># 更新绘图
</span>
    <span class="c1"># 绘制图片
</span>    <span class="n">screen</span><span class="p">.</span><span class="nf">blit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># 更新历史记录
</span>    <span class="n">history</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># 绘制 matplotlib 图形
</span>    <span class="n">screen</span><span class="p">.</span><span class="nf">blit</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>  <span class="c1"># 在屏幕上绘制 matplotlib 图形
</span>
    <span class="c1"># 更新帧数
</span>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="nf">tick</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># 控制帧率
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 ：下表给出了绘图相关函数的说明。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214164419072.png" alt="image-20250214164419072" style="zoom:50%;" /></p>

<h1 id="119-屏幕像素">11.9 屏幕像素</h1>

<p>Pygame的surfarray模块可以处理<code class="language-plaintext highlighter-rouge">PygameSurface</code>对象和NumPy数组之间的转换。你或许还记得，NumPy可以快速、高效地处理大规模数组。</p>

<h1 id="1110-动手实践访问屏幕像素">11.10 动手实践：访问屏幕像素</h1>

<p>在本节教程中，我们将平铺一张小图片以填充游戏界面。请完成如下步骤。</p>

<p>(1) array2d函数将像素存入一个二维数组。还有相似的函数，将像素存入三维数组。我们将avatar头像图片的像素存入数组：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># 将加载的图像转换为一个2D数组，数组中的每个元素表示像素的灰度值
</span><span class="n">pixels</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">surfarray</span><span class="p">.</span><span class="nf">array2d</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 我们使用shape属性获取像素数组pixels的形状，并据此创建游戏界面。游戏界面的长和宽都将是像素数组的7倍大小。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1"># 获取图像的尺寸，并计算将图像放大后的尺寸
</span><span class="n">X</span> <span class="o">=</span> <span class="n">pixels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>  <span class="c1"># 图像的宽度乘以 7
</span><span class="n">Y</span> <span class="o">=</span> <span class="n">pixels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>  <span class="c1"># 图像的高度乘以 7
</span>
<span class="c1"># 创建一个新的pygame窗口，并设置窗口尺寸为放大的图像尺寸
</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 使用tile函数可以轻松平铺图片。由于颜色是定义为整数的，像素数据需要被转换成 整数。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1"># 使用 np.tile() 函数将图像数组放大 7 倍，得到新的数组
# np.tile() 会重复像素数据，创建一个更大的数组
</span><span class="n">new_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(4) surfarray模块中有一个专用函数<code class="language-plaintext highlighter-rouge">blit_array</code>，可以将数组中的像素呈现在屏幕上。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># 将新的像素数据渲染到屏幕上
</span><span class="n">pygame</span><span class="p">.</span><span class="n">surfarray</span><span class="p">.</span><span class="nf">blit_array</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">new_pixels</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果如下图所示。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214164852621.png" alt="image-20250214164852621" style="zoom:50%;" /></p>

<p>平铺图片的完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># 初始化pygame库
</span><span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

<span class="c1"># 加载图片 'head.jpg'
</span><span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">'</span><span class="s">head.jpg</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 将加载的图像转换为一个2D数组，数组中的每个元素表示像素的灰度值
</span><span class="n">pixels</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">surfarray</span><span class="p">.</span><span class="nf">array2d</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="c1"># 获取图像的尺寸，并计算将图像放大后的尺寸
</span><span class="n">X</span> <span class="o">=</span> <span class="n">pixels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>  <span class="c1"># 图像的宽度乘以 7
</span><span class="n">Y</span> <span class="o">=</span> <span class="n">pixels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>  <span class="c1"># 图像的高度乘以 7
</span>
<span class="c1"># 创建一个新的pygame窗口，并设置窗口尺寸为放大的图像尺寸
</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>

<span class="c1"># 设置窗口的标题
</span><span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">Surfarray Demo</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 使用 np.tile() 函数将图像数组放大 7 倍，得到新的数组
# np.tile() 会重复像素数据，创建一个更大的数组
</span><span class="n">new_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">tile</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># 进入主循环，直到用户关闭窗口
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># 用白色填充整个屏幕
</span>    <span class="n">screen</span><span class="p">.</span><span class="nf">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="c1"># 将新的像素数据渲染到屏幕上
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">surfarray</span><span class="p">.</span><span class="nf">blit_array</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">new_pixels</span><span class="p">)</span>

    <span class="c1"># 处理所有的事件
</span>    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="c1"># 如果用户点击关闭按钮，退出程序
</span>        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>  <span class="c1"># 退出pygame
</span>            <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>  <span class="c1"># 退出程序
</span>
    <span class="c1"># 更新显示
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 :  下面的表格给出了新函数及其属性的简单说明。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214165206440.png" alt="image-20250214165206440" style="zoom:50%;" /></p>

<h1 id="1111-人工智能">11.11 人工智能</h1>

<p>在游戏中，我们通常需要模拟一些智能行为。<code class="language-plaintext highlighter-rouge">scikit-learn</code>项目旨在提供机器学习的API，我最喜欢的是其出色的文档。我们可以使用操作系统的包管理器来安装<code class="language-plaintext highlighter-rouge">scikit-learn</code>，这取决于你所使用的操作系统是否支持，但应该是最为简便的安装方式。Windows用户可以直接从项目网站上下载安装包。</p>

<p>在Debian和Ubuntu上，该项目名为python-sklearn。在MacPorts命名为py26-scikits-learn和py27-scikits-learn。我们也可以从源代码安装或使用<code class="language-plaintext highlighter-rouge">easy_install</code>工具，还有第三方发行版如Python(x, y)、Enthought和NetBSD。</p>

<blockquote>
  <p>以上说的是原书那个版本的下载，下面是新版本的（适用于现在）。</p>
</blockquote>

<p>在菜单栏中，选择 <code class="language-plaintext highlighter-rouge">文件</code> &gt; <code class="language-plaintext highlighter-rouge">设置</code>（在 macOS 上为 <code class="language-plaintext highlighter-rouge">PyCharm</code> &gt; <code class="language-plaintext highlighter-rouge">首选项</code>），然后导航到 <code class="language-plaintext highlighter-rouge">项目：您的项目名</code> &gt; <code class="language-plaintext highlighter-rouge">Python 解释器</code>。</p>

<p><strong>安装 scikit-learn</strong>：点击窗口右上角的 <code class="language-plaintext highlighter-rouge">+</code> 按钮，在弹出的搜索框中输入 <code class="language-plaintext highlighter-rouge">scikit-learn</code>，选择相应的版本，然后点击 <code class="language-plaintext highlighter-rouge">安装</code>。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214165553767.png" alt="image-20250214165553767" style="zoom:50%;" /></p>

<p><strong>验证安装</strong>：安装完成后，您可以在代码中添加以下内容来验证 scikit-learn 是否已正确安装：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sklearn</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sklearn</span><span class="p">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214170459859.png" alt="image-20250214170459859" style="zoom:50%;" /></p>

<h1 id="1112-动手实践数据点聚类">11.12 动手实践：数据点聚类</h1>

<p>我们将随机生成一些数据点并对它们进行聚类，也就是将相近的点放到同一个聚类中。这只是<code class="language-plaintext highlighter-rouge">scikit-learn</code>提供的众多技术之一。聚类是一种机器学习算法，即依据相似度对数据点进行分组。随后，我们将计算一个关联矩阵。关联矩阵即包含关联值的矩阵，如点与点之间的距离。最后，我们将使用<code class="language-plaintext highlighter-rouge">scikit-learn</code>中的<code class="language-plaintext highlighter-rouge">AffinityPropagation</code>类对数据点进行聚类。请完成如下步骤。</p>

<p>(1) 我们将在<code class="language-plaintext highlighter-rouge">400 × 400</code>像素的方块内随机生成30个坐标点：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 我们将使用欧氏距离（Euclidean distance）来初始化关联矩阵。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">positions_norms</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">positions</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="o">-</span> <span class="n">positions_norms</span><span class="p">[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions_norms</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">positions</span><span class="p">.</span><span class="n">T</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 将前一步的结果提供给AffinityPropagation类。该类将为每一个数据点标记合适的聚类编号。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">aff_pro</span> <span class="o">=</span> <span class="n">sklearn</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="nc">AffinityPropagation</span><span class="p">().</span><span class="nf">fit</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">aff_pro</span><span class="p">.</span><span class="n">labels_</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(4) 我们将为每一个聚类绘制多边形。该函数需要的参数包括Surface对象、颜色（本例中使用红色）和数据点列表。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="nf">polygon</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>绘制结果如下图所示。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214171106495.png" alt="image-20250214171106495" style="zoom:50%;" /></p>

<blockquote>
  <p>注：效果可能和书上不一样，因为是随机生成的。</p>
</blockquote>

<p>完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sklearn</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pygame</span><span class="p">,</span><span class="n">sys</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">positions_norms</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">positions</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="o">-</span> <span class="n">positions_norms</span><span class="p">[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions_norms</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">positions</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">aff_pro</span> <span class="o">=</span> <span class="n">sklearn</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="nc">AffinityPropagation</span><span class="p">().</span><span class="nf">fit</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">aff_pro</span><span class="p">.</span><span class="n">labels_</span>

<span class="n">polygon_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">polygon_points</span><span class="p">.</span><span class="nf">append</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
    <span class="n">polygon_points</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="nf">append</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">)):</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="nf">polygon</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 :  下面的表格给出了人工智能示例代码中最重要的几个函数的功能说明。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214171200266.png" alt="image-20250214171200266" style="zoom:50%;" /></p>

<h1 id="1113-opengl-和-pygame">11.13 OpenGL 和 Pygame</h1>

<p>OpenGL是专业的用于二维和三维图形的计算机图形应用程序接口（API），由函数和一些常数构成。我们将重点关注其Python的实现，即<code class="language-plaintext highlighter-rouge">PyOpenGL</code>。使用如下命令安装PyOpenGL：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">pip</span> <span class="n">install</span>  <span class="n">PyOpenGL_accelerate</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>你可能需要根权限来执行这条命令。以下是相应的easy_install命令：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">easy_install</span> <span class="n">PyOpenGL</span> <span class="n">PyOpenGL_accelerate</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在pycharm中，一样可以下载这2个依赖：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214171344121.png" alt="image-20250214171344121" style="zoom:50%;" /></p>

<p>备注，如果下载<code class="language-plaintext highlighter-rouge">PyOpenGL_accelerate</code>失败，参考帖子：https://www.cnblogs.com/sea-stream/p/9840986.html</p>

<p>或者试试conda安装：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">conda</span> <span class="n">install</span> <span class="n">PyOpenGL</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>如果用conda安装成功，那么在pycharm中用项目解释器就换成conda的即可。如下图所示：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214173238215.png" alt="image-20250214173238215" style="zoom:50%;" /></p>

<h1 id="1114-动手实践绘制谢尔宾斯基地毯">11.14 动手实践：绘制谢尔宾斯基地毯</h1>

<p>为了演示OpenGL的功能，我们将使用OpenGL绘制谢尔宾斯基地毯（Sierpinski gasket），亦称作谢尔宾斯基三角形（Sierpinski triangle）或谢尔宾斯基筛子（Sierpinski sieve）。这是一种三角形形状的分形（fractal），由数学家瓦茨瓦夫·谢尔宾斯基（Waclaw Sierpinski）提出。这个三角形是经过原则上无穷的递归过程得到的。请完成如下步骤绘制谢尔宾斯基地毯。</p>

<blockquote>
  <p>注意书上提供的源代码中，<code class="language-plaintext highlighter-rouge">gluOrtho2D</code>函数拼错了</p>
</blockquote>

<p>(1) 首先，我们将初始化一些OpenGL相关的基本要素，包括设置显示模式和背景颜色等。在本节的末尾可以找到相关函数的详细说明。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">display_openGL</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    初始化 OpenGL 环境，设置窗口和投影矩阵
    :param w: 窗口的宽度
    :param h: 窗口的高度
    </span><span class="sh">"""</span>
    <span class="c1"># 设置窗口大小，并启用 OpenGL 渲染和双缓冲
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">pygame</span><span class="p">.</span><span class="n">OPENGL</span> <span class="o">|</span> <span class="n">pygame</span><span class="p">.</span><span class="n">DOUBLEBUF</span><span class="p">)</span>

    <span class="c1"># 设置背景色为黑色
</span>    <span class="nf">glClearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># 清除颜色缓冲和深度缓冲
</span>    <span class="nf">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

    <span class="c1"># 设置 2D 正交投影矩阵，使用 gluOrtho2D 函数，设置视口范围
</span>    <span class="c1"># 这里将视口范围设定为从 (0, 0) 到 (w, h)，即图像的宽度和高度
</span>    <span class="nf">gluOrtho2D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 依据分形的算法，我们应该尽可能多地准确地绘制结点。第一步，我们将绘制颜色设置为红色。第二步，我们定义三角形的顶点。随后，我们定义随机挑选的索引，即从三角形的3个顶点中任意选出其中一个。从三角形靠中间的位置随意指定一点——这个点在哪里并不重要。然后，我们在前一次的点和随机选出的三角形顶点之间的中点处进行绘制。最后，我们强制刷新缓冲以保证绘图命令全部得以执行。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1"># 设置绘图颜色，这里是红色（RGB）
</span><span class="nf">glColor3f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># 定义三角形的三个顶点
# vertices 数组存储的是三角形的 3 个顶点坐标
</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">DIM</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DIM</span><span class="p">],</span> <span class="p">[</span><span class="n">DIM</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="c1"># 设置绘制的点的数量（分形中的点）
</span><span class="n">NPOINTS</span> <span class="o">=</span> <span class="mi">9000</span>

<span class="c1"># 使用随机生成的整数值来选择 vertices 数组中的一个顶点
</span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">NPOINTS</span><span class="p">)</span>

<span class="c1"># 初始点的位置
</span><span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="mf">175.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">]</span>

<span class="c1"># 进入循环绘制分形图
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">NPOINTS</span><span class="p">):</span>
    <span class="nf">glBegin</span><span class="p">(</span><span class="n">GL_POINTS</span><span class="p">)</span>  <span class="c1"># 开始绘制点
</span>    <span class="c1"># 更新当前点的位置：新的点是原点和当前选择的顶点的中点
</span>    <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="n">point</span> <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="c1"># 绘制当前点
</span>    <span class="nf">glVertex2fv</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="nf">glEnd</span><span class="p">()</span>  <span class="c1"># 结束绘制
</span>
<span class="c1"># 刷新 OpenGL 的渲染缓冲，确保所有绘制的内容立即显示
</span><span class="nf">glFlush</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>谢尔宾斯基三角形如下图所示。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214173906435.png" alt="image-20250214173906435" style="zoom:50%;" /></p>

<p>完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre></td><td class="rouge-code"><pre><span class="c1"># 导入所需的库
</span><span class="kn">import</span> <span class="n">pygame</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">OpenGL.GL</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">OpenGL.GLU</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">OpenGL.GLUT</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">display_openGL</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    初始化 OpenGL 环境，设置窗口和投影矩阵
    :param w: 窗口的宽度
    :param h: 窗口的高度
    </span><span class="sh">"""</span>
    <span class="c1"># 设置窗口大小，并启用 OpenGL 渲染和双缓冲
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">pygame</span><span class="p">.</span><span class="n">OPENGL</span> <span class="o">|</span> <span class="n">pygame</span><span class="p">.</span><span class="n">DOUBLEBUF</span><span class="p">)</span>

    <span class="c1"># 设置背景色为黑色
</span>    <span class="nf">glClearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># 清除颜色缓冲和深度缓冲
</span>    <span class="nf">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

    <span class="c1"># 设置 2D 正交投影矩阵，使用 gluOrtho2D 函数，设置视口范围
</span>    <span class="c1"># 这里将视口范围设定为从 (0, 0) 到 (w, h)，即图像的宽度和高度
</span>    <span class="nf">gluOrtho2D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">
    主函数，初始化 Pygame，设置 OpenGL 渲染，并运行动画
    </span><span class="sh">"""</span>
    <span class="c1"># 初始化 pygame
</span>    <span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

    <span class="c1"># 设置 Pygame 窗口标题
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">'</span><span class="s">OpenGL Demo</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># 设置窗口的尺寸
</span>    <span class="n">DIM</span> <span class="o">=</span> <span class="mi">400</span>

    <span class="c1"># 调用 display_openGL 函数，设置窗口和 OpenGL 环境
</span>    <span class="nf">display_openGL</span><span class="p">(</span><span class="n">DIM</span><span class="p">,</span> <span class="n">DIM</span><span class="p">)</span>

    <span class="c1"># 设置绘图颜色，这里是红色（RGB）
</span>    <span class="nf">glColor3f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 定义三角形的三个顶点
</span>    <span class="c1"># vertices 数组存储的是三角形的 3 个顶点坐标
</span>    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">DIM</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DIM</span><span class="p">],</span> <span class="p">[</span><span class="n">DIM</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># 设置绘制的点的数量（分形中的点）
</span>    <span class="n">NPOINTS</span> <span class="o">=</span> <span class="mi">9000</span>

    <span class="c1"># 使用随机生成的整数值来选择 vertices 数组中的一个顶点
</span>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">NPOINTS</span><span class="p">)</span>

    <span class="c1"># 初始点的位置
</span>    <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="mf">175.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">]</span>

    <span class="c1"># 进入循环绘制分形图
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">NPOINTS</span><span class="p">):</span>
        <span class="nf">glBegin</span><span class="p">(</span><span class="n">GL_POINTS</span><span class="p">)</span>  <span class="c1"># 开始绘制点
</span>        <span class="c1"># 更新当前点的位置：新的点是原点和当前选择的顶点的中点
</span>        <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="n">point</span> <span class="o">+</span> <span class="n">vertices</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="c1"># 绘制当前点
</span>        <span class="nf">glVertex2fv</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="nf">glEnd</span><span class="p">()</span>  <span class="c1"># 结束绘制
</span>
    <span class="c1"># 刷新 OpenGL 的渲染缓冲，确保所有绘制的内容立即显示
</span>    <span class="nf">glFlush</span><span class="p">()</span>

    <span class="c1"># 更新窗口显示内容
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">flip</span><span class="p">()</span>

    <span class="c1"># 事件循环，保持窗口开启直到用户关闭窗口
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># 如果收到关闭事件，则退出主循环
</span>

<span class="c1"># 如果是直接运行该脚本，调用 main 函数
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 :如前所述，下面的表格给出了示例代码中最重要的一些函数的功能说明。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214171625902.png" alt="image-20250214171625902" style="zoom:50%;" /></p>

<h1 id="1115-模拟游戏">11.15 模拟游戏</h1>

<p>作为最后一个示例，我们将根据生命游戏（Conway’ s Game of Life）来完成一个模拟生命的游戏。原始的生命游戏是基于几个基本规则的。我们从一个随机初始化的二维方形网格开始。网格中每一个细胞的状态可能是生或死，由其相邻的8个细胞决定。在这个规则下可以使用卷积进行计算，我们需要SciPy的工具包完成卷积运算。</p>

<h1 id="1116-动手实践模拟生命">11.16 动手实践：模拟生命</h1>

<p>下面的代码实现了生命游戏，并做了如下修改：</p>

<ul>
  <li>单击鼠标绘制一个十字架；</li>
  <li>按下r 键将网格重置为随机状态；</li>
  <li>按下b 键在鼠标位置创建一个方块；</li>
  <li>按下g 键创建一个形如滑翔机的图案。</li>
</ul>

<p>本例的代码中最重要的数据结构就是一个二维数组，用于维护游戏界面上像素的颜色值。该数组被随机初始化，然后在游戏主循环中每一轮迭代重新计算一次。在本节的末尾可以找到相关函数的更多信息。</p>

<p>(1) 根据游戏规则，我们将使用卷积进行计算。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">get_pixar</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    获取一个新的 pixar 数组，通过卷积操作计算新状态并根据特定规则返回符合条件的状态。
    :param arr: 当前像素数组
    :param weights: 卷积核，用于对像素进行卷积运算
    :return: 更新后的像素数组
    </span><span class="sh">"""</span>
    <span class="c1"># 使用 ndimage.convolve 执行卷积运算，'wrap' 模式表示边界循环处理
</span>    <span class="n">states</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="nf">convolve</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">wrap</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># 根据状态值判断像素是否符合某些条件
</span>    <span class="n">bools</span> <span class="o">=</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># 将布尔数组转换为 0 或 1 的整数数组
</span>    <span class="k">return</span> <span class="n">bools</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(2) 我们可以使用在第2章中学到的索引技巧绘制十字架。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">draw_cross</span><span class="p">(</span><span class="n">pixar</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    在鼠标位置画一个十字形（横向和纵向都设置为 1）
    :param pixar: 当前的像素数组
    </span><span class="sh">"""</span>
    <span class="p">(</span><span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">)</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="nf">get_pos</span><span class="p">()</span>  <span class="c1"># 获取鼠标当前的屏幕位置
</span>    <span class="n">pixar</span><span class="p">[</span><span class="n">posx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 横向设置为 1
</span>    <span class="n">pixar</span><span class="p">[:,</span> <span class="n">posy</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 纵向设置为 1
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>(3) 随机初始化网格：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1"># 更新的 random_init 函数，使用 np.random.randint 替代 random_integers(以及废除了)
</span><span class="k">def</span> <span class="nf">random_init</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    创建一个 n x n 的随机二维数组，每个元素是 0 或 1，用于初始化像素矩阵。
    :param n: 矩阵的大小
    :return: 一个随机的 0 或 1 的二维数组
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># 生成 0 或 1 的二维数组
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>单机鼠标效果：（绘制一个十字架）</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214180610998.png" alt="image-20250214180610998" style="zoom:50%;" /></p>

<p>按下r 键将网格重置为随机状态：</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214180649338.png" alt="image-20250214180649338" style="zoom:50%;" /></p>

<p>按下b 键在鼠标位置创建一个方块:</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214180712833.png" alt="image-20250214180712833" style="zoom:50%;" /></p>

<p>按下g 键创建一个形如滑翔机的图案:(截图效果不是很明显，但是动画可以看得出来)</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214180800406.png" alt="image-20250214180800406" style="zoom:50%;" /></p>

<p>完整代码如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">pygame</span>
<span class="kn">from</span> <span class="n">pygame.locals</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>


<span class="c1"># 更新的 random_init 函数，使用 np.random.randint 替代 random_integers
</span><span class="k">def</span> <span class="nf">random_init</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    创建一个 n x n 的随机二维数组，每个元素是 0 或 1，用于初始化像素矩阵。
    :param n: 矩阵的大小
    :return: 一个随机的 0 或 1 的二维数组
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># 生成 0 或 1 的二维数组
</span>

<span class="k">def</span> <span class="nf">get_pixar</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    获取一个新的 pixar 数组，通过卷积操作计算新状态并根据特定规则返回符合条件的状态。
    :param arr: 当前像素数组
    :param weights: 卷积核，用于对像素进行卷积运算
    :return: 更新后的像素数组
    </span><span class="sh">"""</span>
    <span class="c1"># 使用 ndimage.convolve 执行卷积运算，'wrap' 模式表示边界循环处理
</span>    <span class="n">states</span> <span class="o">=</span> <span class="n">ndimage</span><span class="p">.</span><span class="nf">convolve</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">wrap</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># 根据状态值判断像素是否符合某些条件
</span>    <span class="n">bools</span> <span class="o">=</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">states</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># 将布尔数组转换为 0 或 1 的整数数组
</span>    <span class="k">return</span> <span class="n">bools</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">draw_cross</span><span class="p">(</span><span class="n">pixar</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    在鼠标位置画一个十字形（横向和纵向都设置为 1）
    :param pixar: 当前的像素数组
    </span><span class="sh">"""</span>
    <span class="p">(</span><span class="n">posx</span><span class="p">,</span> <span class="n">posy</span><span class="p">)</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="nf">get_pos</span><span class="p">()</span>  <span class="c1"># 获取鼠标当前的屏幕位置
</span>    <span class="n">pixar</span><span class="p">[</span><span class="n">posx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 横向设置为 1
</span>    <span class="n">pixar</span><span class="p">[:,</span> <span class="n">posy</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 纵向设置为 1
</span>

<span class="k">def</span> <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    根据传入的图案名称在像素矩阵中绘制对应的图案
    :param pixar: 当前的像素数组
    :param pattern: 图案名称（如 glider, block, exploder 等）
    </span><span class="sh">"""</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="c1"># 根据图案选择对应的坐标位置
</span>    <span class="k">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="sh">'</span><span class="s">glider</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="sh">'</span><span class="s">block</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="sh">'</span><span class="s">exploder</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="sh">'</span><span class="s">fpentomino</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

    <span class="c1"># 获取鼠标位置作为图案的左上角位置
</span>    <span class="n">pos</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="nf">get_pos</span><span class="p">()</span>

    <span class="c1"># 定义 x 和 y 方向上的间隔
</span>    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># 在这些位置上绘制图案
</span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">pixar</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 设置图案坐标为 1，表示活跃状态
</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">
    主函数，初始化 Pygame 和像素数组，并启动事件循环
    </span><span class="sh">"""</span>
    <span class="c1"># 初始化 Pygame
</span>    <span class="n">pygame</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

    <span class="c1"># 定义矩阵大小
</span>    <span class="n">N</span> <span class="o">=</span> <span class="mi">400</span>

    <span class="c1"># 设置窗口的大小
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_mode</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">set_caption</span><span class="p">(</span><span class="sh">"</span><span class="s">Life Demo</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 设置窗口标题
</span>
    <span class="c1"># 获取 Pygame 屏幕对象
</span>    <span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">get_surface</span><span class="p">()</span>

    <span class="c1"># 初始化像素数组
</span>    <span class="n">pixar</span> <span class="o">=</span> <span class="nf">random_init</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># 设置卷积核，用于计算像素的状态变化
</span>    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="n">cross_on</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># 控制是否绘制十字形
</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># 根据卷积核更新像素状态
</span>        <span class="n">pixar</span> <span class="o">=</span> <span class="nf">get_pixar</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>

        <span class="c1"># 如果 cross_on 为 True，绘制十字形
</span>        <span class="k">if</span> <span class="n">cross_on</span><span class="p">:</span>
            <span class="nf">draw_cross</span><span class="p">(</span><span class="n">pixar</span><span class="p">)</span>

        <span class="c1"># 使用 Pygame 显示像素数组（乘以 255 ** 3 来调节亮度）
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">surfarray</span><span class="p">.</span><span class="nf">blit_array</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">pixar</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># 更新显示
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="nf">flip</span><span class="p">()</span>

        <span class="c1"># 处理事件
</span>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">QUIT</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># 如果点击关闭按钮，退出程序
</span>            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">cross_on</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">cross_on</span>  <span class="c1"># 切换十字形的绘制状态
</span>            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">):</span>  <span class="c1"># 按下 'r' 键，随机初始化像素
</span>                    <span class="n">pixar</span> <span class="o">=</span> <span class="nf">random_init</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Random init</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">):</span>  <span class="c1"># 按下 'g' 键，绘制 glider 图案
</span>                    <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="sh">'</span><span class="s">glider</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">):</span>  <span class="c1"># 按下 'b' 键，绘制 block 图案
</span>                    <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="sh">'</span><span class="s">block</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">e</span><span class="sh">'</span><span class="p">):</span>  <span class="c1"># 按下 'e' 键，绘制 exploder 图案
</span>                    <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="sh">'</span><span class="s">exploder</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">f</span><span class="sh">'</span><span class="p">):</span>  <span class="c1"># 按下 'f' 键，绘制 fpentomino 图案
</span>                    <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">pixar</span><span class="p">,</span> <span class="sh">'</span><span class="s">fpentomino</span><span class="sh">'</span><span class="p">)</span>


<span class="c1"># 如果是直接运行该脚本，调用 main 函数
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>刚才做了些什么 :  我们使用的一些NumPy和SciPy的函数需要进一步说明，参见下面的表格。</p>

<p><img src="https://wechat01.oss-cn-hangzhou.aliyuncs.com/img/image-20250214181642892.png" alt="image-20250214181642892" style="zoom:50%;" /></p>

<h1 id="1117-本章小结">11.17 本章小结</h1>

<p>一开始，你可能会觉得在本书中提到Pygame有些奇怪。希望你在阅读完本章内容后，觉察到一起使用NumPy和Pygame的妙处。毕竟游戏需要很多计算，因此NumPy和SciPy是理想的选择。</p>

<p>游戏也需要人工智能，如<code class="language-plaintext highlighter-rouge">scikit-learn</code>中可以找到相应的支持。总之，编写游戏是一件有趣的事情，我们希望最后一章的内容如同前面十章教程的正餐之后的甜点或咖啡。如果你还没有“吃饱”，请参阅本书作者的另一本著作《NumPy攻略：Python科学计算与数据分析》，比本书更为深入且与本书内容互不重叠。</p>

<p>本书阅读全部完成。～～～撒花🎉</p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2025/02/14/NumPy(10)NumPy%E7%9A%84%E6%89%A9%E5%B1%95-SciPy/" data-toggle="tooltip" data-placement="top" title="numpy(10)NumPy的扩展：SciPy">
                        Previous<br>
                        <span>numpy(10)NumPy的扩展：SciPy</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2025/02/14/NumPy%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97(%E7%AC%AC2%E7%89%88)%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93/" data-toggle="tooltip" data-placement="top" title="NumPy学习指南（第2版）阅读总结">
                        Next<br>
                        <span>NumPy学习指南（第2版）阅读总结</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0117" 
                    href="/archive/?tag=%E4%B9%A6%E7%B1%8D%E9%98%85%E8%AF%BB"
                    title="书籍阅读"
                    rel="3">书籍阅读</a>
        
                <a data-sort="0096" 
                    href="/archive/?tag=%E7%AE%97%E6%B3%95"
                    title="算法"
                    rel="24">算法</a>
        
                <a data-sort="0102" 
                    href="/archive/?tag=%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BDAI%E5%9F%BA%E7%A1%80"
                    title="人工智能AI基础"
                    rel="18">人工智能AI基础</a>
        
                <a data-sort="0103" 
                    href="/archive/?tag=python%E5%9F%BA%E7%A1%80"
                    title="python基础"
                    rel="17">python基础</a>
        
                <a data-sort="0107" 
                    href="/archive/?tag=numpy"
                    title="numpy"
                    rel="13">numpy</a>
        
                <a data-sort="0108" 
                    href="/archive/?tag=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%90%B4%E6%81%A9%E8%BE%BE"
                    title="机器学习-吴恩达"
                    rel="12">机器学习-吴恩达</a>
        
                <a data-sort="0110" 
                    href="/archive/?tag=%E5%8A%9B%E6%89%A3"
                    title="力扣"
                    rel="10">力扣</a>
        
                <a data-sort="0117" 
                    href="/archive/?tag=pandas"
                    title="pandas"
                    rel="3">pandas</a>
        
                <a data-sort="0117" 
                    href="/archive/?tag=spring6"
                    title="spring6"
                    rel="3">spring6</a>
        
                <a data-sort="0118" 
                    href="/archive/?tag=Java%E5%9F%BA%E7%A1%80"
                    title="Java基础"
                    rel="2">Java基础</a>
        
                <a data-sort="0118" 
                    href="/archive/?tag=ollama%E5%B7%A5%E5%85%B7"
                    title="ollama工具"
                    rel="2">ollama工具</a>
        
                <a data-sort="0118" 
                    href="/archive/?tag=python%E7%88%AC%E8%99%AB"
                    title="python爬虫"
                    rel="2">python爬虫</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://m.freebuf.com/">freebuf</a></li>
  
  <li><a href="https://xz.aliyun.com/">先知</a></li>
  
  <li><a href="https://www.sec-in.com/All">sec-in</a></li>
  
  <li><a href="https://paper.seebug.org/">see-bug</a></li>
  
  <li><a href="https://twitter.com/Concurr21486093">我的推特</a></li>
  
  <li><a href="https://pdai.tech/">pdai</a></li>
  
  <li><a href="https://nodejs.org/dist/">nodejs index of dist</a></li>
  
  <li><a href="#">公众号：小东方不败</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/Concurr21486093">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/Hilda">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/kirsten-1">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Hilda 2025
                    <br>
                    Powered by <a href="https://kirsten-1.github.io/">hilda Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
