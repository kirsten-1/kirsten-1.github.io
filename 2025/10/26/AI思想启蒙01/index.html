<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="这里是 Hilda 的个人博客，与你一起发现更大的世界 | 要做一个有 swag 的程序员">
    <meta name="keywords" content="Hilda">
    <meta name="theme-color" content="#000000">

    <!-- Open Graph -->
    <meta property="og:title"
        content="【AI思想启蒙01】人工智能概述和特征提取？做人工智能的第一步  - Hilda的博客 | Your genius girlfriend's blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="

">
    
    <meta property="article:published_time" content=" 2025-10-26T00:00:00Z">
    
    
    <meta property="article:author" content="Hilda">
    
    
    <meta property="article:tag" content="AI思想启蒙">
    
    
    <meta property="og:image" content="https://kirsten-1.github.io">
    <meta property="og:url" content="https://kirsten-1.github.io/2025/10/26/AI%E6%80%9D%E6%83%B3%E5%90%AF%E8%92%9901/">
    <meta property="og:site_name" content="Hilda的博客 | Your genius girlfriend's blog">

    <title>【AI思想启蒙01】人工智能概述和特征提取？做人工智能的第一步  - Hilda的博客 | Your genius girlfriend's blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://kirsten-1.github.io/2025/10/26/AI%E6%80%9D%E6%83%B3%E5%90%AF%E8%92%9901/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href=" /css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href=" /css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Google AdSense -->
    <script data-ad-client="ca-pub-6487568398225121" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Hilda</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-2015.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/post-bg-2015.jpg');
        background: ;
    }

    
</style>




<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=AI%E6%80%9D%E6%83%B3%E5%90%AF%E8%92%99" title="AI思想启蒙">AI思想启蒙</a>
                        
                    </div>
                    <h1>【AI思想启蒙01】人工智能概述和特征提取？做人工智能的第一步 </h1>
                    
                    <h2 class="subheading">RGB灰度转换依人眼对绿光敏感，词袋模型忽略语序语义，独热编码优于标签编码，特征工程需结合业务，深度学习用Embedding解决高维问题。</h2>
                    <span class="meta">Posted by Hilda on October 26, 2025</span>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG">
</script>

<h1 id="1灰度转换计算">1.灰度转换计算</h1>

<p><strong>ITU-R BT.709 标准加权系数</strong> 来对一个特定 RGB 颜色进行灰度转换计算</p>

<p><strong>标准加权系数:</strong></p>

<ul>
  <li>\(a_1\) (Red, 红色) \(\approx 0.2126\)</li>
  <li>\(a_2\) (Green, 绿色) \(\approx 0.7152\)</li>
  <li>\(a_3\) (Blue, 蓝色) \(\approx 0.0722\)</li>
  <li><strong>公式:</strong> \(\rho = 0.2126 \cdot R + 0.7152 \cdot G + 0.0722 \cdot B\)，四舍五入到最近的整数（在 $0 \sim 255$ 范围内）</li>
</ul>

<p>色权重在 RGB 到灰度转换公式中占比如此之高（通常在 70% 左右，如 BT.709 标准中的 $0.7152$），主要是由<strong>人类视觉系统的生理结构</strong>决定的。<strong>人类的眼睛对绿色光最敏感，对蓝色光最不敏感。</strong></p>

<p>转换公式的目的是让转换后的灰度值 (\(\rho\)) <strong>最准确地代表人类视觉系统所感知到的亮度 (Luminance)</strong>。</p>

<p>绿色权重高是<strong>科学事实</strong>，它反映了<strong>人眼在感知亮度时对绿色光最敏感</strong>这一生理特性。</p>

<hr />

<h1 id="2词袋到深度语义自然语言处理中的文本表示与局限性">2.词袋到深度语义：自然语言处理中的文本表示与局限性</h1>

<h2 id="21向量空间模型vsm的基础构建">2.1向量空间模型（VSM）的基础构建</h2>

<p><strong>向量空间模型 (Vector Space Model, VSM)</strong>， VSM 中的<strong>词频模型 (Term Frequency Model)</strong>中，统计文档 \(D\) 的向量 \(V_D\) 中的每个元素 \(V_D[i]\) 代表词汇表中的第 \(i\) 个词在文档 中出现的\(D\) 次数，记为 \(TF_{i, D}\)。</p>

<p>如果文档中 \(a\) 出现 5 次，\(b\) 出现 2 次，\(e\) 出现 1 次，\(f\) 出现 3 次，其余词汇未出现，那么文档向量为：</p>

\[V_{D} = ( \stackrel{5}{a}, \stackrel{2}{b}, \stackrel{0}{c}, \stackrel{0}{d}, \stackrel{1}{e}, \stackrel{3}{f}, \stackrel{0}{g}, \stackrel{0}{h}, \stackrel{0}{i}, \stackrel{0}{j} )\]

<blockquote>
  <p>词袋模型 (BoW) 是对整个文档的表示方法，而 One-Hot 编码是词袋模型建立过程中，对单个词汇进行编码的基础技术。</p>

  <p>可以说，<strong>One-Hot 编码提供了词汇到数字的映射基础，而词袋模型利用这种基础映射，将整个文本转化为一个特征向量</strong>。</p>
</blockquote>

<h2 id="22词袋模型的固有局限性">2.2词袋模型的固有局限性</h2>

<p>虽然词频模型比布尔模型有所改进，但它仍存在一个缺陷：它认为所有词汇的重要性都一样。但实际上，像“的”、“是”、“在”这样的<strong>常见词 (Stop Words)</strong> 即使频率很高，对文档主题的区分度却很低。</p>

<p>无论是布尔模型、纯词频 (TF) 模型，还是更高级的 TF-IDF 模型，它们都面临着一个共同的、主要的局限性，即：</p>

<p><strong>向量空间模型 (VSM) 的主要局限性：缺乏顺序和结构信息</strong></p>

<p>这种缺点被称为 <strong>“词袋模型” (Bag-of-Words, BoW) 的缺陷</strong>，因为这些模型将文档视为一个装满了词语的袋子，只关心袋子里面有什么词以及它们的数量，而完全<strong>忽略了词语出现的顺序和它们之间的语法结构</strong>。</p>

<p>比如“我借你钱” vs. “你借我钱”</p>

<p>在 TF 或 TF-IDF 模型中，这两个句子将产生<strong>完全相同的向量</strong>，因此在计算相似度时（例如通过余弦相似度），它们将被认为是<strong>完全相似</strong>的，但它们的<strong>语义是完全相反</strong>的。</p>

<p>再例如，“苹果”（Apple）可以指代手机品牌，也可以指代一种水果，这是自然语言处理中一个经典且核心的问题：歧义，即<strong>词义消歧 (Word Sense Disambiguation, WSD)</strong> 或更广义的<strong>多义性 (Polysemy)</strong> 问题。</p>

<p>在向量空间模型或词袋模型中，“苹果”这个词只有一个唯一的 ID 和一个向量维度。模型无法区分以下两种情况：</p>

<ul>
  <li>“我买了<strong>苹果</strong>公司的最新手机。” (科技公司)</li>
  <li>“我喜欢吃红色的<strong>苹果</strong>。” (水果)</li>
</ul>

<hr />

<h2 id="23解决顺序和语义缺陷的高级模型">2.3解决顺序和语义缺陷的高级模型</h2>

<p>为了克服这种<strong>顺序和结构</strong>的缺陷，信息检索和自然语言处理 (NLP) 领域发展出了更复杂的模型：</p>

<p>1.N-gram 模型 (部分解决语序)</p>

<ul>
  <li><strong>思路：</strong> 不将文档的基本单元视为单个词，而是视为<strong>连续的 $N$ 个词的序列</strong>（例如，2-gram 或 bigram 是两个连续的词，3-gram 是三个连续的词）。</li>
  <li><strong>示例：</strong> 句子 “我借你钱” 将被视为 “我借”、”借你”、”你钱” 三个 N-gram。
    <ul>
      <li>句子 “你借我钱” 将被视为 “你借”、”借我”、”我钱” 三个 N-gram。</li>
    </ul>
  </li>
  <li><strong>结果：</strong> 两个句子的 N-gram 集合<strong>不同</strong>，因此它们的向量也不同，相似度计算结果更合理。</li>
  <li><strong>缺点：</strong> 向量维度会爆炸式增长，计算和存储成本极高。</li>
</ul>

<p>2.句法/语义模型 (Semantic Models)</p>

<p>这是更高级的 NLP 方法，目标是理解词语的真正含义和它们在句子中的角色：</p>

<ul>
  <li><strong>Word Embeddings (词嵌入，如 Word2Vec, GloVe):</strong> 将词语映射到低维连续向量空间，使语义相似的词在向量空间中距离相近。</li>
  <li><strong>基于深度学习的模型 (如 RNN, LSTM, Transformer):</strong> 这些模型（尤其是 Transformer 及其衍生的 BERT, GPT 等）通过<strong>注意力机制</strong>和<strong>序列编码</strong>，能够完全理解词语的顺序和它们之间的远距离依赖关系，从而捕捉到“我借你钱”和“你借我钱”的本质区别。</li>
</ul>

<hr />

<h2 id="24解决词义歧义wsd的现代方法">2.4解决词义歧义（WSD）的现代方法</h2>

<p>解决多义性问题的方法</p>

<p>解决这种依赖于上下文的词义问题（歧义），需要模型能够理解词语所处的<strong>环境 (Context)</strong>。主要有以下几种方法：</p>

<p>1.基于知识库的方法 (Knowledge-Based Methods)</p>

<ul>
  <li><strong>使用同义词典/语义网络：</strong> 利用人工构建的语义资源库，如 <strong>WordNet</strong>。
    <ul>
      <li><strong>方法：</strong> 为每个词义定义其特征、同义词和上下文。当模型遇到“苹果”时，它会查看句子中其他词语（如“手机”、“吃”），然后根据预定义的语义关系选择最合适的词义。</li>
    </ul>
  </li>
</ul>

<p>2.基于上下文的方法 (Context-Based Methods)</p>

<p>这是现代 NLP 的主流方法，主要依赖于统计模型和机器学习：</p>

<ul>
  <li><strong>词嵌入 (Word Embeddings) 的局限性：</strong> 传统的 Word2Vec 或 GloVe 模型为“苹果”只生成一个静态向量，无法区分多义性。</li>
  <li><strong>语境化词嵌入 (Contextualized Word Embeddings) — 解决问题的关键：</strong>
    <ul>
      <li><strong>代表模型：</strong> <strong>BERT</strong>（来自 Google）、<strong>GPT</strong>（来自 OpenAI）等基于 Transformer 架构的模型。</li>
      <li><strong>思路：</strong> 这些模型为每个词生成的向量不再是固定的，而是<strong>动态的、随句子上下文变化的</strong>。</li>
      <li><strong>如何工作：</strong>
        <ul>
          <li>当输入 “我买了<strong>苹果</strong>手机” 时，BERT 会通过其内部的<strong>注意力机制</strong>，发现“苹果”与“手机”的关联性很高，从而生成一个倾向于<strong>“科技公司”</strong>的向量。</li>
          <li>当输入 “我吃了红<strong>苹果</strong>” 时，模型会发现“苹果”与“吃”、“红”的关联性更高，从而生成一个倾向于<strong>“水果”</strong>的向量。</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>通过这种方式，同一个词语“苹果”在不同的句子中会有两个截然不同的向量表示，从而在后续的相似度计算或分类任务中被正确地识别为两个不同的语义实体。</p>

<p>3.聚类方法 (Clustering Methods)</p>

<ul>
  <li><strong>思路：</strong> 将所有包含“苹果”的句子收集起来，然后利用机器学习算法根据周围的词语对其进行聚类。</li>
  <li><strong>结果：</strong> 句子可能会自然地分成两组：一组是关于科技和电子产品的，另一组是关于食物、农业和健康的。聚类中心就代表了“苹果”的两种不同词义。</li>
</ul>

<p>要解决“苹果”的多义性问题，现代方法已经超越了简单的词袋计数，而是通过<strong>复杂的深度学习模型</strong>（例如 Transformer 架构），让计算机学会<strong>关注上下文</strong>，从而为同一个词在不同语境下生成独特的<strong>语境化向量</strong>，实现精确的<strong>词义消歧</strong>。</p>

<h1 id="3分析与比较两种性别编码方法">3.分析与比较：两种性别编码方法</h1>

<p>用户画像（User Persona）<strong>构建中，对</strong>性别（Sex/Gender）<strong>这一特征进行</strong>数值化编码，有下面2种方法：</p>

<ul>
  <li>男 \([0] \quad\) 女 \([1]\)   —–&gt;标签编码 (Label Encoding)</li>
  <li>男 \([0, 1] \quad\) 女 \([1, 0]\)   —–&gt;独热编码 (One-Hot Encoding)</li>
</ul>

<p>这两种方法都属于将<strong>分类变量</strong>转化为<strong>数值变量</strong>的技术，以便输入到机器学习模型中进行训练和分析。</p>

<p>【标签编码】:<strong>引入了错误的序数关系（Order/Magnitude）：</strong> 机器会将 $[1]$ 识别为比 $[0]$ <strong>“更大”</strong>或<strong>“更高”</strong>的值。</p>

<p>对于像性别这样的<strong>名义变量 (Nominal Variable)</strong>（即没有大小、顺序或等级之分的分类），这种编码会使模型误认为 <strong>“女”</strong> 比 <strong>“男”</strong> 更重要、更优越，或者存在某种数值上的顺序关系。这会<strong>扭曲模型对特征权重的学习</strong>。</p>

<p>【独热编码】:每个类别都用一个独立的维度表示，所有维度都是二进制（0 或 1）。模型无法从数值大小上推断出“男”和“女”之间有任何顺序或大小关系。确保了模型将“男”和“女”视为两个<strong>独立的、平等的类别特征</strong>。对于只有两个类别的性别特征，维度从 1 增加到了 2。在特征类别非常多的情况下，会导致特征空间维度膨胀。</p>

<ul>
  <li>结论：方法 ② 更好</li>
</ul>

<p>在机器学习和数据分析中，对于<strong>名义分类变量</strong>（如性别、国家、职业类型等），<strong>方法 ② (独热编码)</strong> 是<strong>标准且更推荐</strong>的编码方法。</p>

<p><strong>原因总结：</strong></p>

<p><strong>方法 ② (独热编码)</strong> 能够正确地处理<strong>名义变量</strong>，避免了方法 ① <strong>错误引入数值上的序数关系</strong>，从而保证了机器学习模型能够更准确、无偏地学习该特征对预测目标的影响。</p>

<p>在您的例子中，虽然性别只有两种，用标签编码 (方法 ①) 也能跑通，但在处理<strong>多类别</strong>（如学历：小学、中学、大学、硕士）时，标签编码的问题会更加突出。独热编码是处理所有分类变量的安全做法。</p>

<blockquote>
  <p>用于减少维度的独热编码变体，即 <strong>虚拟编码（Dummy Coding）</strong></p>

  <p><strong>虚拟编码</strong>是<strong>独热编码 (One-Hot Encoding)</strong>的一种变体，主要目的是在不损失信息的前提下，<strong>避免多重共线性 (Multicollinearity)</strong> 问题。</p>

  <p>虚拟编码只使用 \(N-1\) 个特征维度来表示 $N$ 个类别。它<strong>省略了其中一个类别</strong>的维度，将这个被省略的类别作为<strong>基准 (Reference Category)</strong>。</p>

  <ul>
    <li>如果所有 \(N-1\) 个维度的值都是 $0$，就意味着这个样本属于被省略的那个基准类别。</li>
  </ul>

  <p>在统计回归模型中，如果特征之间存在精确的线性关系（例如：如果“男”是 \([1, 0]\)，“女”是 \([0, 1]\)，那么“女”就可以通过 \(1 - \text{“男”}\) 线性推导出来），这就会导致<strong>多重共线性</strong>，使得模型估计的系数不稳定。</p>

  <p>虚拟编码通过丢弃一个维度来打破这种完美的线性关系。</p>

  <p>假设我们仍有<strong>性别</strong>这一特征（\(N=2\) 个类别）。</p>

  <table>
    <thead>
      <tr>
        <th><strong>类别</strong></th>
        <th><strong>独热编码 (One-Hot)</strong></th>
        <th><strong>虚拟编码 (Dummy Coding)</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>男</td>
        <td>\([1, 0]\)</td>
        <td>\([0]\)</td>
      </tr>
      <tr>
        <td>女</td>
        <td>\([0, 1]\)</td>
        <td>\([1]\)</td>
      </tr>
      <tr>
        <td><strong>维度数</strong></td>
        <td>\(N=2\)</td>
        <td>\(N-1=1\)</td>
      </tr>
    </tbody>
  </table>

  <p>假设有三个学历类别：<strong>小学</strong>、<strong>中学</strong>、<strong>大学</strong>。我们将“小学”设为基准类别。</p>

  <table>
    <thead>
      <tr>
        <th><strong>类别</strong></th>
        <th><strong>独热编码 (One-Hot) (N=3 维)</strong></th>
        <th><strong>虚拟编码 (Dummy Coding) (N−1=2 维)</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>小学</strong></td>
        <td>\([1, 0, 0]\)</td>
        <td><strong>\([0, 0]\)</strong> (基准类别)</td>
      </tr>
      <tr>
        <td><strong>中学</strong></td>
        <td>\([0, 1, 0]\)</td>
        <td><strong>\([1, 0]\)</strong> (中学=1, 大学=0)</td>
      </tr>
      <tr>
        <td><strong>大学</strong></td>
        <td>\([0, 0, 1]\)</td>
        <td><strong>\([0, 1]\)</strong> (中学=0, 大学=1)</td>
      </tr>
    </tbody>
  </table>

  <p>虚拟编码在<strong>回归分析</strong>中特别常见，因为它能保持模型系数的可解释性（系数代表相对于基准类别的差异）。</p>
</blockquote>

<h1 id="4处理连续特征如年龄的表示">4.处理连续特征（如年龄）的表示</h1>

<p>在机器学习中，处理连续特征（如年龄）有多种表示方法，目标是提高模型的性能、稳定性和可解释性。</p>

<ul>
  <li>
    <p>对于卖一定产品的人群来说，比如中年30-50岁，这群年龄的人更容易消费，所以0-29和51-100更不重要了。</p>
  </li>
  <li>
    <p>其次，25岁和26岁，虽然只差一岁，但是没啥大的区别。</p>
  </li>
</ul>

<p>在电商场景中，往往利用<strong>离散化/分箱（Binning or Discretization）</strong>+ <strong>独热编码</strong>处理年龄。</p>

<p>比如：</p>

<ul>
  <li><strong>箱子 1：</strong> 0-18 岁（青少年） \(\rightarrow [1]\)</li>
  <li><strong>箱子 2：</strong> 19-35 岁（青年） \(\rightarrow [2]\)</li>
  <li><strong>箱子 3：</strong> 36-60 岁（中年） \(\rightarrow [3]\)</li>
  <li><strong>箱子 4：</strong> 61-100 岁（老年） \(\rightarrow [4]\)</li>
</ul>

<p>基于此：</p>

<ul>
  <li>0-18 岁 \(\rightarrow [1, 0, 0, 0]\)</li>
  <li>36-60 岁 \(\rightarrow [0, 0, 1, 0]\)</li>
</ul>

<p>这种分法，边节点的选择非常重要。</p>

<p>为了缓和震荡，也可以这么划分：</p>

<ul>
  <li>0-18</li>
  <li>15-35</li>
  <li>30-55</li>
  <li>50-100</li>
</ul>

<p>这种划分策略在特征工程中被称为<strong>重叠分箱 (Overlapping Binning)</strong>，主要目的是<strong>缓和分界点处的震荡和突变</strong>，提高模型的平滑度和鲁棒性。</p>

<h1 id="5二手车平台场景下的颜色编码问题">5.二手车平台场景下的颜色编码问题</h1>

<p>如果<strong>二手车平台</strong>要将汽车的<strong>颜色</strong>（如“绿”、“红”、“黑”）作为特征输入到机器学习模型中（例如，预测售价或用户偏好），\((0 \sim 255, 0 \sim 255, 0 \sim 255)\) 对应 \(R, G, B\),</p>

<p>这种基于 <strong>RGB 原始值比较</strong>的编码方法是<strong>不合适</strong>的。</p>

<p>原始 RGB 值是连续、感知且多维的，如果模型试图直接比较这些 <strong>RGB 向量</strong>，就会错误地引入<strong>数值上的大小关系</strong>。比如，在二手车交易中，“红色车”和“黑色车”只是两种不同的<strong>分类</strong>，它们之间<strong>没有数值大小、顺序或等级之分</strong>。模型可能会错误地认为 RGB 值高的车（例如，浅色或高亮度的车）在某些方面“更重要”或与目标变量有错误的数值关联，从而<strong>扭曲模型的学习</strong>。</p>

<p>对于“二手车颜色”这种<strong>名义分类变量</strong>（车的颜色其实就几种，没有特别多的类别），正确的机器学习表示方法应该是：<strong>独热编码</strong>，因为像之前讨论的性别编码一样，避免了在“绿”、“红”、“黑”之间引入错误的数值顺序或大小关系。</p>

<p><strong>所以在处理特征的时候，一定要强烈地理解业务场景。</strong></p>

<h1 id="6组合特征">6.组合特征</h1>

<p>电商场景下，2 位 (性别) + 4 位 (年龄)去刻画用户画像，考虑这样的场景，16-40岁的人购买力是10，对于女生购买力是15，但是年龄是16-40且女性，购买力飙升变成40。这就需要<strong>多个分类特征</strong>（性别和年龄）组合编码成一个向量，所以需要<strong>创建交叉特征 (Interaction Feature)</strong> 来捕捉特征组合的非线性效应。即引入第7位特征 \(X_{组合}\)。</p>

\[X_{组合} = \begin{cases} 1 &amp; \text{如果用户属于 “16-40 岁” 且为 “女性”} \\ 0 &amp; \text{否则} \end{cases}\]

<p>原来的 6 位向量会扩展为 7 位。</p>

<p>当模型学习时，它会为这个新的交叉特征 \(X_{组合}\)分配一个巨大的<strong>权重</strong> \(w_{组合}\)。</p>

\[\text{购买力} \approx w_{\text{基线}} + \sum w_i \cdot X_i + \dots + w_{\text{组合}} \cdot X_{\text{组合}}\]

<ul>
  <li>对于普通的16-40岁男性， \(X_{组合}=0\)，该权重项消失。</li>
  <li>对于16-40岁的女性， \(X_{组合}=1\)，模型会学习到一个很大的 值\(w_{组合}\)，从而将最终的购买力预测值推高到40左右。</li>
</ul>

<p>通过这种方式，成功地将两个特征的<strong>协同效应</strong>以线性项的方式引入到模型中，使模型能够<strong>精确地学习和预测特定用户群体的非线性高价值</strong>。</p>

<h1 id="7亿维特征问题">7.亿维特征问题</h1>

<p>这种方法也有缺点，一个在互联网和大数据领域（尤其是推荐系统、广告系统、用户画像构建）中非常现实且棘手的问题：<strong>亿维特征 (Billion-Scale Feature Dimensions)</strong></p>

<p><strong>独热编码 (One-Hot Encoding)*<em>和*</em>特征交叉</strong>是维度爆炸的直接原因。</p>

<p>当遇到<strong>高基数特征</strong>（High Cardinality Feature，即特征的可能取值非常多）时，使用独热编码会立即引发维度爆炸。如果用户 ID 有1亿个取值，广告 ID 有10万个取值，那么它们的交叉特征维度就是 \(10^8 \times 10^5 = 10^{13}\)（十万亿），这远远超出了实际计算的能力范围。</p>

<p>训练数据和模型参数需要巨大的存储空间和分布式计算集群。即使维度很高，对于单个样本而言，大部分特征值仍为 0（高度稀疏），导致计算资源浪费。许多交叉特征可能在训练集中只出现过一两次，导致模型无法进行有效学习和泛化。</p>

<p>解决亿维特征问题的关键是：<strong>将高维稀疏的特征空间，压缩到低维密集的语义空间。</strong></p>

<p>1.特征降维与嵌入（Embedding）—— 最核心的方法</p>

<p>这是现代推荐和广告系统中最常用的技术，灵感来源于词嵌入 (Word Embedding)。</p>

<ul>
  <li><strong>方法：</strong> 不再对高基数 ID（如用户 ID、商品 ID）使用 One-Hot 编码，而是将每个 ID 映射到一个<strong>低维、密集的向量</strong>中。
    <ul>
      <li><strong>示例：</strong> 一个1亿维的用户 ID 独热向量，被压缩成一个 <strong>64维或128维的密集向量（Embedding）</strong>。</li>
    </ul>
  </li>
  <li><strong>优势：</strong> 既保留了每个 ID 的语义信息（向量空间中的距离代表相似性），又解决了维度爆炸和稀疏性问题。</li>
</ul>

<p>2.特征哈希（Feature Hashing）</p>

<ul>
  <li><strong>方法：</strong> 使用哈希函数将原始的高维特征空间映射到一个<strong>预先指定维度</strong>的低维空间中。</li>
  <li><strong>示例：</strong> 无论用户 ID 是 1亿还是 100 亿，都将其哈希到 \(10^5\) 维的向量中。</li>
  <li><strong>优势：</strong> 不占用额外内存存储哈希表，效率高。</li>
  <li><strong>缺点：</strong> 存在<strong>哈希碰撞</strong>（不同的特征可能被映射到相同的维度），会轻微损失模型精度。</li>
</ul>

<p>3.自动化特征交叉（Factorization Machines &amp; Deep Learning）</p>

<p>对于交叉特征，不再手动创建所有 \(A \times B\) 的组合特征：</p>

<ul>
  <li><strong>因子分解机 (Factorization Machines, FM)：</strong> 自动学习任意两个特征之间的<strong>隐式交叉权重</strong>。</li>
  <li><strong>深度神经网络 (Deep Learning, 如 Wide &amp; Deep Model)：</strong> 利用神经网络的多层结构，<strong>自动学习</strong>高阶、非线性的特征组合，无需人工显式创建交叉特征。</li>
</ul>

<hr />

<p><strong>总结：</strong> 解决“亿维特征”问题的关键在于<strong>拥抱低维密集表示</strong>。通过 <strong>Embedding 技术</strong>处理高基数特征，结合 <strong>深度学习模型</strong> 或 <strong>FM</strong> 来实现特征的自动化交叉学习，是当前业界的主流解决方案。</p>

<h1 id="8复杂特征工程多模态数据与特征提取">8.复杂特征工程：多模态数据与特征提取</h1>

<p>多模态输入</p>

<ul>
  <li><strong>Video (视频)</strong></li>
  <li><strong>Img (图像)</strong></li>
  <li><strong>Text (文本)</strong></li>
</ul>

<p>【视频/图像特征提取】</p>

<p>完成率： 视频播放进度指标。</p>

<p>数量： 可能是图片数量、视频时长、帧率等。</p>

<p>敏感信息： 这是一个业务相关的视觉标签（可能是用于吸引用户点击或计算内容风险），通过图像识别或目标检测模型提取。</p>

<p>清晰度： 图像或视频的质量指标，用于评估用户体验。</p>

<p>【文本特征提取】</p>

<p>章长度： 文本的基础统计特征。</p>

<p>[ one-hot 关键词 ]： 使用独热编码 (One-Hot) 或 布尔向量 来表示文章中是否包含特定的关键词，即使用高维稀疏向量表示。</p>

<p>[ 文章类别 ]： 文章所属的分类标签，也常使用独热编码。</p>

<p>在现代系统中，<code class="language-plaintext highlighter-rouge">Video</code>, <code class="language-plaintext highlighter-rouge">Img</code>, <code class="language-plaintext highlighter-rouge">Text</code> 更常用 <strong>Embedding 向量</strong>（低维密集表示）来提取特征，而非完全依赖手动设计的统计特征或高维稀疏的 One-Hot 编码。</p>

<hr />

<p>这些特征提取的方案一般都是<strong>强业务绑定</strong>的</p>

<p><strong>特征工程不仅仅是数据处理，更是业务知识的数学化表达。</strong></p>

<p>所以透彻的理解业务是做好AI的关键。</p>

<hr />

<p>应用场景涵盖了<strong>电商、短视频、金融、医疗</strong>等众多领域。首先，我们需要<strong>结合领域知识 (Domain Knowledge)</strong>，与<strong>产品经理</strong>、<strong>业务分析师</strong>深度协作，将这些场景中复杂、多样的<strong>业务概念和用户行为</strong>，转化为机器可理解的<strong>数值特征</strong>。这个过程的最终目标是构建一个<strong>统一、标准化</strong>的特征向量（即<strong>‘屏蔽掉场景差异的向量’</strong>）。这个向量的核心是<strong>用低维、密集的语义表示</strong>（如 <strong>Embedding</strong>）来替代高维、稀疏的原始特征。最终，这个<strong>通用化的特征向量</strong>被送入模型进行训练。模型通过学习特征与目标变量之间的复杂关系，得出适用于<strong>跨场景或特定场景的预测结果</strong>（如推荐、风控评分或点击率）。</p>

<p>即，分成3个阶段：</p>

<ul>
  <li>特征工程阶段：涉及到<strong>人工特征工程 (Hand-crafted Features)</strong>，需要利用领域专家知识，定义具有高区分度的特征，并通过<strong>分箱、标准化、标签编码</strong>等方式将业务概念转化为数值。</li>
  <li>特征表示阶段：变成一个向量（一个屏蔽掉场景差异的向量），这个过程称为<strong>特征统一化</strong>或<strong>通用特征表示</strong>。关键是使用 <strong>Embedding 技术</strong>。即使是不同的场景，如果用户行为模式相似，其 Embedding 向量也会在语义空间中靠近，从而“屏蔽掉场景差异”。</li>
  <li>模型应用阶段：训练的目的是让模型学习特征向量中的<strong>权重和交互关系</strong>。最终结果是模型对目标变量（如 \(P(\text{Click})\)、LTV、违约风险）的<strong>概率或数值预测</strong>。</li>
</ul>

<p>以上是传统模型的AI的工作过程。</p>

<p>深度学习自动化了传统特征工程的一部分，但引入了新的、更抽象的特征工程任务。</p>

<p>在深度学习框架下，特征工程的任务转变为对<strong>模型输入和架构</strong>的设计</p>

<p>对于表格数据（如用户ID、年龄、地区），深度学习仍然需要：</p>

<ul>
  <li><strong>独热编码/分箱：</strong> 虽然最终会被嵌入层处理，但原始特征的<strong>离散化和规范化</strong>是必要的。</li>
  <li><strong>特征归一化/标准化：</strong> 对连续特征（如年龄、收入），标准化（如 Z-score）仍是提高模型收敛速度和稳定性的标准步骤。</li>
  <li><strong>创建 Embedding 特征：</strong> 这是深度学习特有的、最重要的“特征工程”。需要决定：
    <ul>
      <li><strong>哪些 ID 需要被 Embedding？</strong>（如 User ID, Item ID）</li>
      <li><strong>Embedding 的维度是多少？</strong>（如 64 维还是 128 维）</li>
      <li><strong>Embedding 是共享还是独立？</strong>（如所有商品的颜色特征共享一个 Embedding 矩阵）</li>
    </ul>
  </li>
</ul>

<p>虽然模型可以自动学习交互，但在模型架构设计中，<strong>显式地引入重要的交叉特征</strong>依然能提升性能（即 Wide &amp; Deep 模型中的 Wide 部分）。</p>

<p>在处理用户行为序列或时间序列时，特征工程尤为关键：</p>

<ul>
  <li><strong>序列截断/填充：</strong> 确定序列的最大长度，并进行填充（Padding）或截断（Truncation）。</li>
  <li><strong>位置编码 (Positional Encoding)：</strong> 在 Transformer 模型中，必须手动将位置信息编码为特征向量，以便模型理解词语的顺序。</li>
  <li><strong>时间特征：</strong> 将时间戳转化为机器可学习的特征，如 <strong>“星期几”、“小时”、“是否为周末”</strong> 等。</li>
</ul>

<p>深度学习要求工程师将精力投入到<strong>高层抽象、稀疏 ID 的 Embedding 化，以及模型结构的优化</strong>上。</p>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2025/10/08/%E7%AE%97%E6%B3%95%E4%BD%93%E7%B3%BB%E5%AD%A6%E4%B9%A0-11%E4%BA%8C%E5%8F%89%E6%A0%91%E9%A2%98%E7%9B%AE/" data-toggle="tooltip" data-placement="top" title="【体系学习011】二叉树题目">
                        Previous<br>
                        <span>【体系学习011】二叉树题目</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2025/10/27/AI%E6%80%9D%E6%83%B3%E5%90%AF%E8%92%9902/" data-toggle="tooltip" data-placement="top" title="【AI思想启蒙02】线性回归1第一个模型，用来进行数值预测 ">
                        Next<br>
                        <span>【AI思想启蒙02】线性回归1第一个模型，用来进行数值预测 </span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0175" 
                    href="/archive/?tag=%E4%B9%A6%E7%B1%8D%E9%98%85%E8%AF%BB"
                    title="书籍阅读"
                    rel="3">书籍阅读</a>
        
                <a data-sort="0137" 
                    href="/archive/?tag=%E7%AE%97%E6%B3%95"
                    title="算法"
                    rel="41">算法</a>
        
                <a data-sort="0160" 
                    href="/archive/?tag=%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BDAI%E5%9F%BA%E7%A1%80"
                    title="人工智能AI基础"
                    rel="18">人工智能AI基础</a>
        
                <a data-sort="0161" 
                    href="/archive/?tag=python%E5%9F%BA%E7%A1%80"
                    title="python基础"
                    rel="17">python基础</a>
        
                <a data-sort="0163" 
                    href="/archive/?tag=%E5%8A%9B%E6%89%A3"
                    title="力扣"
                    rel="15">力扣</a>
        
                <a data-sort="0165" 
                    href="/archive/?tag=numpy"
                    title="numpy"
                    rel="13">numpy</a>
        
                <a data-sort="0165" 
                    href="/archive/?tag=pandas"
                    title="pandas"
                    rel="13">pandas</a>
        
                <a data-sort="0166" 
                    href="/archive/?tag=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%90%B4%E6%81%A9%E8%BE%BE"
                    title="机器学习-吴恩达"
                    rel="12">机器学习-吴恩达</a>
        
                <a data-sort="0167" 
                    href="/archive/?tag=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95"
                    title="机器学习算法"
                    rel="11">机器学习算法</a>
        
                <a data-sort="0172" 
                    href="/archive/?tag=matplotlib"
                    title="matplotlib"
                    rel="6">matplotlib</a>
        
                <a data-sort="0175" 
                    href="/archive/?tag=spring6"
                    title="spring6"
                    rel="3">spring6</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=%E7%AE%97%E6%B3%95%E9%A2%98%E5%BA%93"
                    title="算法题库"
                    rel="2">算法题库</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=AI%E6%80%9D%E6%83%B3%E5%90%AF%E8%92%99"
                    title="AI思想启蒙"
                    rel="2">AI思想启蒙</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=Java%E5%9F%BA%E7%A1%80"
                    title="Java基础"
                    rel="2">Java基础</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=java%E9%9B%86%E5%90%88"
                    title="java集合"
                    rel="2">java集合</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=ollama%E5%B7%A5%E5%85%B7"
                    title="ollama工具"
                    rel="2">ollama工具</a>
        
                <a data-sort="0176" 
                    href="/archive/?tag=python%E7%88%AC%E8%99%AB"
                    title="python爬虫"
                    rel="2">python爬虫</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://m.freebuf.com/">freebuf</a></li>
  
  <li><a href="https://xz.aliyun.com/">先知</a></li>
  
  <li><a href="https://www.sec-in.com/All">sec-in</a></li>
  
  <li><a href="https://paper.seebug.org/">see-bug</a></li>
  
  <li><a href="https://twitter.com/Concurr21486093">我的推特</a></li>
  
  <li><a href="https://pdai.tech/">pdai</a></li>
  
  <li><a href="https://nodejs.org/dist/">nodejs index of dist</a></li>
  
  <li><a href="#">公众号：小东方不败</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/Concurr21486093">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://www.zhihu.com/people/Hilda">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa  fa-stack-1x fa-inverse">知</i>
      </span>
    </a>
  </li>
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/kirsten-1">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Hilda 2025
                    <br>
                    Powered by <a href="https://kirsten-1.github.io/">hilda Blog</a>
<!--                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"-->
<!--                        height="20px"-->
<!--                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">-->
<!--                    </iframe>-->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
